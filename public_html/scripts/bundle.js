/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={46:function(t,e,i){var n;n=function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=20)}([function(t,e){var n={};t.exports=n,function(){n._baseDelta=1e3/60,n._nextId=0,n._seed=0,n._nowStartTime=+new Date,n._warnedOnce={},n._decomp=null,n.extend=function(t,e){var i,o;"boolean"==typeof e?(i=2,o=e):(i=1,o=!0);for(var s=i;s<arguments.length;s++){var r=arguments[s];if(r)for(var a in r)o&&r[a]&&r[a].constructor===Object?t[a]&&t[a].constructor!==Object?t[a]=r[a]:(t[a]=t[a]||{},n.extend(t[a],o,r[a])):t[a]=r[a]}return t},n.clone=function(t,e){return n.extend({},e,t)},n.keys=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var i in t)e.push(i);return e},n.values=function(t){var e=[];if(Object.keys){for(var i=Object.keys(t),n=0;n<i.length;n++)e.push(t[i[n]]);return e}for(var o in t)e.push(t[o]);return e},n.get=function(t,e,i,n){e=e.split(".").slice(i,n);for(var o=0;o<e.length;o+=1)t=t[e[o]];return t},n.set=function(t,e,i,o,s){var r=e.split(".").slice(o,s);return n.get(t,e,0,-1)[r[r.length-1]]=i,i},n.shuffle=function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(n.random()*(e+1)),o=t[e];t[e]=t[i],t[i]=o}return t},n.choose=function(t){return t[Math.floor(n.random()*t.length)]},n.isElement=function(t){return"undefined"!=typeof HTMLElement?t instanceof HTMLElement:!!(t&&t.nodeType&&t.nodeName)},n.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},n.isFunction=function(t){return"function"==typeof t},n.isPlainObject=function(t){return"object"==typeof t&&t.constructor===Object},n.isString=function(t){return"[object String]"===toString.call(t)},n.clamp=function(t,e,i){return t<e?e:t>i?i:t},n.sign=function(t){return t<0?-1:1},n.now=function(){if("undefined"!=typeof window&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-n._nowStartTime},n.random=function(e,i){return i=void 0!==i?i:1,(e=void 0!==e?e:0)+t()*(i-e)};var t=function(){return n._seed=(9301*n._seed+49297)%233280,n._seed/233280};n.colorToNumber=function(t){return 3==(t=t.replace("#","")).length&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)),parseInt(t,16)},n.logLevel=1,n.log=function(){console&&n.logLevel>0&&n.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.info=function(){console&&n.logLevel>0&&n.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.warn=function(){console&&n.logLevel>0&&n.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.warnOnce=function(){var t=Array.prototype.slice.call(arguments).join(" ");n._warnedOnce[t]||(n.warn(t),n._warnedOnce[t]=!0)},n.deprecated=function(t,e,i){t[e]=n.chain((function(){n.warnOnce("ðŸ”… deprecated ðŸ”…",i)}),t[e])},n.nextId=function(){return n._nextId++},n.indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1},n.map=function(t,e){if(t.map)return t.map(e);for(var i=[],n=0;n<t.length;n+=1)i.push(e(t[n]));return i},n.topologicalSort=function(t){var e=[],i=[],o=[];for(var s in t)i[s]||o[s]||n._topologicalSort(s,i,o,t,e);return e},n._topologicalSort=function(t,e,i,o,s){var r=o[t]||[];i[t]=!0;for(var a=0;a<r.length;a+=1){var l=r[a];i[l]||e[l]||n._topologicalSort(l,e,i,o,s)}i[t]=!1,e[t]=!0,s.push(t)},n.chain=function(){for(var t=[],e=0;e<arguments.length;e+=1){var i=arguments[e];i._chained?t.push.apply(t,i._chained):t.push(i)}var n=function(){for(var e,i=new Array(arguments.length),n=0,o=arguments.length;n<o;n++)i[n]=arguments[n];for(n=0;n<t.length;n+=1){var s=t[n].apply(e,i);void 0!==s&&(e=s)}return e};return n._chained=t,n},n.chainPathBefore=function(t,e,i){return n.set(t,e,n.chain(i,n.get(t,e)))},n.chainPathAfter=function(t,e,i){return n.set(t,e,n.chain(n.get(t,e),i))},n.setDecomp=function(t){n._decomp=t},n.getDecomp=function(){var t=n._decomp;try{t||"undefined"==typeof window||(t=window.decomp),t||void 0===i.g||(t=i.g.decomp)}catch(e){t=null}return t}}()},function(t,e){var i={};t.exports=i,i.create=function(t){var e={min:{x:0,y:0},max:{x:0,y:0}};return t&&i.update(e,t),e},i.update=function(t,e,i){t.min.x=1/0,t.max.x=-1/0,t.min.y=1/0,t.max.y=-1/0;for(var n=0;n<e.length;n++){var o=e[n];o.x>t.max.x&&(t.max.x=o.x),o.x<t.min.x&&(t.min.x=o.x),o.y>t.max.y&&(t.max.y=o.y),o.y<t.min.y&&(t.min.y=o.y)}i&&(i.x>0?t.max.x+=i.x:t.min.x+=i.x,i.y>0?t.max.y+=i.y:t.min.y+=i.y)},i.contains=function(t,e){return e.x>=t.min.x&&e.x<=t.max.x&&e.y>=t.min.y&&e.y<=t.max.y},i.overlaps=function(t,e){return t.min.x<=e.max.x&&t.max.x>=e.min.x&&t.max.y>=e.min.y&&t.min.y<=e.max.y},i.translate=function(t,e){t.min.x+=e.x,t.max.x+=e.x,t.min.y+=e.y,t.max.y+=e.y},i.shift=function(t,e){var i=t.max.x-t.min.x,n=t.max.y-t.min.y;t.min.x=e.x,t.max.x=e.x+i,t.min.y=e.y,t.max.y=e.y+n}},function(t,e){var i={};t.exports=i,i.create=function(t,e){return{x:t||0,y:e||0}},i.clone=function(t){return{x:t.x,y:t.y}},i.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},i.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y},i.rotate=function(t,e,i){var n=Math.cos(e),o=Math.sin(e);i||(i={});var s=t.x*n-t.y*o;return i.y=t.x*o+t.y*n,i.x=s,i},i.rotateAbout=function(t,e,i,n){var o=Math.cos(e),s=Math.sin(e);n||(n={});var r=i.x+((t.x-i.x)*o-(t.y-i.y)*s);return n.y=i.y+((t.x-i.x)*s+(t.y-i.y)*o),n.x=r,n},i.normalise=function(t){var e=i.magnitude(t);return 0===e?{x:0,y:0}:{x:t.x/e,y:t.y/e}},i.dot=function(t,e){return t.x*e.x+t.y*e.y},i.cross=function(t,e){return t.x*e.y-t.y*e.x},i.cross3=function(t,e,i){return(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x)},i.add=function(t,e,i){return i||(i={}),i.x=t.x+e.x,i.y=t.y+e.y,i},i.sub=function(t,e,i){return i||(i={}),i.x=t.x-e.x,i.y=t.y-e.y,i},i.mult=function(t,e){return{x:t.x*e,y:t.y*e}},i.div=function(t,e){return{x:t.x/e,y:t.y/e}},i.perp=function(t,e){return{x:(e=!0===e?-1:1)*-t.y,y:e*t.x}},i.neg=function(t){return{x:-t.x,y:-t.y}},i.angle=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},i._temp=[i.create(),i.create(),i.create(),i.create(),i.create(),i.create()]},function(t,e,i){var n={};t.exports=n;var o=i(2),s=i(0);n.create=function(t,e){for(var i=[],n=0;n<t.length;n++){var o=t[n],s={x:o.x,y:o.y,index:n,body:e,isInternal:!1};i.push(s)}return i},n.fromPath=function(t,e){var i=[];return t.replace(/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/gi,(function(t,e,n){i.push({x:parseFloat(e),y:parseFloat(n)})})),n.create(i,e)},n.centre=function(t){for(var e,i,s,r=n.area(t,!0),a={x:0,y:0},l=0;l<t.length;l++)s=(l+1)%t.length,e=o.cross(t[l],t[s]),i=o.mult(o.add(t[l],t[s]),e),a=o.add(a,i);return o.div(a,6*r)},n.mean=function(t){for(var e={x:0,y:0},i=0;i<t.length;i++)e.x+=t[i].x,e.y+=t[i].y;return o.div(e,t.length)},n.area=function(t,e){for(var i=0,n=t.length-1,o=0;o<t.length;o++)i+=(t[n].x-t[o].x)*(t[n].y+t[o].y),n=o;return e?i/2:Math.abs(i)/2},n.inertia=function(t,e){for(var i,n,s=0,r=0,a=t,l=0;l<a.length;l++)n=(l+1)%a.length,s+=(i=Math.abs(o.cross(a[n],a[l])))*(o.dot(a[n],a[n])+o.dot(a[n],a[l])+o.dot(a[l],a[l])),r+=i;return e/6*(s/r)},n.translate=function(t,e,i){i=void 0!==i?i:1;var n,o=t.length,s=e.x*i,r=e.y*i;for(n=0;n<o;n++)t[n].x+=s,t[n].y+=r;return t},n.rotate=function(t,e,i){if(0!==e){var n,o,s,r,a=Math.cos(e),l=Math.sin(e),h=i.x,c=i.y,u=t.length;for(r=0;r<u;r++)o=(n=t[r]).x-h,s=n.y-c,n.x=h+(o*a-s*l),n.y=c+(o*l+s*a);return t}},n.contains=function(t,e){for(var i,n=e.x,o=e.y,s=t.length,r=t[s-1],a=0;a<s;a++){if(i=t[a],(n-r.x)*(i.y-r.y)+(o-r.y)*(r.x-i.x)>0)return!1;r=i}return!0},n.scale=function(t,e,i,s){if(1===e&&1===i)return t;var r,a;s=s||n.centre(t);for(var l=0;l<t.length;l++)r=t[l],a=o.sub(r,s),t[l].x=s.x+a.x*e,t[l].y=s.y+a.y*i;return t},n.chamfer=function(t,e,i,n,r){e="number"==typeof e?[e]:e||[8],i=void 0!==i?i:-1,n=n||2,r=r||14;for(var a=[],l=0;l<t.length;l++){var h=t[l-1>=0?l-1:t.length-1],c=t[l],u=t[(l+1)%t.length],d=e[l<e.length?l:e.length-1];if(0!==d){var p=o.normalise({x:c.y-h.y,y:h.x-c.x}),m=o.normalise({x:u.y-c.y,y:c.x-u.x}),g=Math.sqrt(2*Math.pow(d,2)),f=o.mult(s.clone(p),d),y=o.normalise(o.mult(o.add(p,m),.5)),_=o.sub(c,o.mult(y,g)),v=i;-1===i&&(v=1.75*Math.pow(d,.32)),(v=s.clamp(v,n,r))%2==1&&(v+=1);for(var b=Math.acos(o.dot(p,m))/v,x=0;x<v;x++)a.push(o.add(o.rotate(f,b*x),_))}else a.push(c)}return a},n.clockwiseSort=function(t){var e=n.mean(t);return t.sort((function(t,i){return o.angle(e,t)-o.angle(e,i)})),t},n.isConvex=function(t){var e,i,n,o,s=0,r=t.length;if(r<3)return null;for(e=0;e<r;e++)if(n=(e+2)%r,o=(t[i=(e+1)%r].x-t[e].x)*(t[n].y-t[i].y),(o-=(t[i].y-t[e].y)*(t[n].x-t[i].x))<0?s|=1:o>0&&(s|=2),3===s)return!1;return 0!==s||null},n.hull=function(t){var e,i,n=[],s=[];for((t=t.slice(0)).sort((function(t,e){var i=t.x-e.x;return 0!==i?i:t.y-e.y})),i=0;i<t.length;i+=1){for(e=t[i];s.length>=2&&o.cross3(s[s.length-2],s[s.length-1],e)<=0;)s.pop();s.push(e)}for(i=t.length-1;i>=0;i-=1){for(e=t[i];n.length>=2&&o.cross3(n[n.length-2],n[n.length-1],e)<=0;)n.pop();n.push(e)}return n.pop(),s.pop(),n.concat(s)}},function(t,e,i){var n={};t.exports=n;var o=i(3),s=i(2),r=i(7),a=i(0),l=i(1),h=i(11);!function(){n._timeCorrection=!0,n._inertiaScale=4,n._nextCollidingGroupId=1,n._nextNonCollidingGroupId=-1,n._nextCategory=1,n._baseDelta=1e3/60,n.create=function(e){var i={id:a.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:o.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:1e3/60,_original:null},n=a.extend(i,e);return t(n,e),n},n.nextGroup=function(t){return t?n._nextNonCollidingGroupId--:n._nextCollidingGroupId++},n.nextCategory=function(){return n._nextCategory=n._nextCategory<<1,n._nextCategory};var t=function(t,e){e=e||{},n.set(t,{bounds:t.bounds||l.create(t.vertices),positionPrev:t.positionPrev||s.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),o.rotate(t.vertices,t.angle,t.position),h.rotate(t.axes,t.angle),l.update(t.bounds,t.vertices,t.velocity),n.set(t,{axes:e.axes||t.axes,area:e.area||t.area,mass:e.mass||t.mass,inertia:e.inertia||t.inertia});var i=t.isStatic?"#14151f":a.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),r=t.isStatic?"#555":"#ccc",c=t.isStatic&&null===t.render.fillStyle?1:0;t.render.fillStyle=t.render.fillStyle||i,t.render.strokeStyle=t.render.strokeStyle||r,t.render.lineWidth=t.render.lineWidth||c,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};n.set=function(t,e,i){var o;for(o in"string"==typeof e&&(o=e,(e={})[o]=i),e)if(Object.prototype.hasOwnProperty.call(e,o))switch(i=e[o],o){case"isStatic":n.setStatic(t,i);break;case"isSleeping":r.set(t,i);break;case"mass":n.setMass(t,i);break;case"density":n.setDensity(t,i);break;case"inertia":n.setInertia(t,i);break;case"vertices":n.setVertices(t,i);break;case"position":n.setPosition(t,i);break;case"angle":n.setAngle(t,i);break;case"velocity":n.setVelocity(t,i);break;case"angularVelocity":n.setAngularVelocity(t,i);break;case"speed":n.setSpeed(t,i);break;case"angularSpeed":n.setAngularSpeed(t,i);break;case"parts":n.setParts(t,i);break;case"centre":n.setCentre(t,i);break;default:t[o]=i}},n.setStatic=function(t,e){for(var i=0;i<t.parts.length;i++){var n=t.parts[i];n.isStatic=e,e?(n._original={restitution:n.restitution,friction:n.friction,mass:n.mass,inertia:n.inertia,density:n.density,inverseMass:n.inverseMass,inverseInertia:n.inverseInertia},n.restitution=0,n.friction=1,n.mass=n.inertia=n.density=1/0,n.inverseMass=n.inverseInertia=0,n.positionPrev.x=n.position.x,n.positionPrev.y=n.position.y,n.anglePrev=n.angle,n.angularVelocity=0,n.speed=0,n.angularSpeed=0,n.motion=0):n._original&&(n.restitution=n._original.restitution,n.friction=n._original.friction,n.mass=n._original.mass,n.inertia=n._original.inertia,n.density=n._original.density,n.inverseMass=n._original.inverseMass,n.inverseInertia=n._original.inverseInertia,n._original=null)}},n.setMass=function(t,e){var i=t.inertia/(t.mass/6);t.inertia=i*(e/6),t.inverseInertia=1/t.inertia,t.mass=e,t.inverseMass=1/t.mass,t.density=t.mass/t.area},n.setDensity=function(t,e){n.setMass(t,e*t.area),t.density=e},n.setInertia=function(t,e){t.inertia=e,t.inverseInertia=1/t.inertia},n.setVertices=function(t,e){e[0].body===t?t.vertices=e:t.vertices=o.create(e,t),t.axes=h.fromVertices(t.vertices),t.area=o.area(t.vertices),n.setMass(t,t.density*t.area);var i=o.centre(t.vertices);o.translate(t.vertices,i,-1),n.setInertia(t,n._inertiaScale*o.inertia(t.vertices,t.mass)),o.translate(t.vertices,t.position),l.update(t.bounds,t.vertices,t.velocity)},n.setParts=function(t,e,i){var s;for(e=e.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,s=0;s<e.length;s++){var r=e[s];r!==t&&(r.parent=t,t.parts.push(r))}if(1!==t.parts.length){if(i=void 0===i||i){var a=[];for(s=0;s<e.length;s++)a=a.concat(e[s].vertices);o.clockwiseSort(a);var l=o.hull(a),h=o.centre(l);n.setVertices(t,l),o.translate(t.vertices,h)}var c=n._totalProperties(t);t.area=c.area,t.parent=t,t.position.x=c.centre.x,t.position.y=c.centre.y,t.positionPrev.x=c.centre.x,t.positionPrev.y=c.centre.y,n.setMass(t,c.mass),n.setInertia(t,c.inertia),n.setPosition(t,c.centre)}},n.setCentre=function(t,e,i){i?(t.positionPrev.x+=e.x,t.positionPrev.y+=e.y,t.position.x+=e.x,t.position.y+=e.y):(t.positionPrev.x=e.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=e.y-(t.position.y-t.positionPrev.y),t.position.x=e.x,t.position.y=e.y)},n.setPosition=function(t,e,i){var n=s.sub(e,t.position);i?(t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.velocity.x=n.x,t.velocity.y=n.y,t.speed=s.magnitude(n)):(t.positionPrev.x+=n.x,t.positionPrev.y+=n.y);for(var r=0;r<t.parts.length;r++){var a=t.parts[r];a.position.x+=n.x,a.position.y+=n.y,o.translate(a.vertices,n),l.update(a.bounds,a.vertices,t.velocity)}},n.setAngle=function(t,e,i){var n=e-t.angle;i?(t.anglePrev=t.angle,t.angularVelocity=n,t.angularSpeed=Math.abs(n)):t.anglePrev+=n;for(var r=0;r<t.parts.length;r++){var a=t.parts[r];a.angle+=n,o.rotate(a.vertices,n,t.position),h.rotate(a.axes,n),l.update(a.bounds,a.vertices,t.velocity),r>0&&s.rotateAbout(a.position,n,t.position,a.position)}},n.setVelocity=function(t,e){var i=t.deltaTime/n._baseDelta;t.positionPrev.x=t.position.x-e.x*i,t.positionPrev.y=t.position.y-e.y*i,t.velocity.x=(t.position.x-t.positionPrev.x)/i,t.velocity.y=(t.position.y-t.positionPrev.y)/i,t.speed=s.magnitude(t.velocity)},n.getVelocity=function(t){var e=n._baseDelta/t.deltaTime;return{x:(t.position.x-t.positionPrev.x)*e,y:(t.position.y-t.positionPrev.y)*e}},n.getSpeed=function(t){return s.magnitude(n.getVelocity(t))},n.setSpeed=function(t,e){n.setVelocity(t,s.mult(s.normalise(n.getVelocity(t)),e))},n.setAngularVelocity=function(t,e){var i=t.deltaTime/n._baseDelta;t.anglePrev=t.angle-e*i,t.angularVelocity=(t.angle-t.anglePrev)/i,t.angularSpeed=Math.abs(t.angularVelocity)},n.getAngularVelocity=function(t){return(t.angle-t.anglePrev)*n._baseDelta/t.deltaTime},n.getAngularSpeed=function(t){return Math.abs(n.getAngularVelocity(t))},n.setAngularSpeed=function(t,e){n.setAngularVelocity(t,a.sign(n.getAngularVelocity(t))*e)},n.translate=function(t,e,i){n.setPosition(t,s.add(t.position,e),i)},n.rotate=function(t,e,i,o){if(i){var s=Math.cos(e),r=Math.sin(e),a=t.position.x-i.x,l=t.position.y-i.y;n.setPosition(t,{x:i.x+(a*s-l*r),y:i.y+(a*r+l*s)},o),n.setAngle(t,t.angle+e,o)}else n.setAngle(t,t.angle+e,o)},n.scale=function(t,e,i,s){var r=0,a=0;s=s||t.position;for(var c=0;c<t.parts.length;c++){var u=t.parts[c];o.scale(u.vertices,e,i,s),u.axes=h.fromVertices(u.vertices),u.area=o.area(u.vertices),n.setMass(u,t.density*u.area),o.translate(u.vertices,{x:-u.position.x,y:-u.position.y}),n.setInertia(u,n._inertiaScale*o.inertia(u.vertices,u.mass)),o.translate(u.vertices,{x:u.position.x,y:u.position.y}),c>0&&(r+=u.area,a+=u.inertia),u.position.x=s.x+(u.position.x-s.x)*e,u.position.y=s.y+(u.position.y-s.y)*i,l.update(u.bounds,u.vertices,t.velocity)}t.parts.length>1&&(t.area=r,t.isStatic||(n.setMass(t,t.density*r),n.setInertia(t,a))),t.circleRadius&&(e===i?t.circleRadius*=e:t.circleRadius=null)},n.update=function(t,e){var i=(e=(void 0!==e?e:1e3/60)*t.timeScale)*e,r=n._timeCorrection?e/(t.deltaTime||e):1,c=1-t.frictionAir*(e/a._baseDelta),u=(t.position.x-t.positionPrev.x)*r,d=(t.position.y-t.positionPrev.y)*r;t.velocity.x=u*c+t.force.x/t.mass*i,t.velocity.y=d*c+t.force.y/t.mass*i,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.deltaTime=e,t.angularVelocity=(t.angle-t.anglePrev)*c*r+t.torque/t.inertia*i,t.anglePrev=t.angle,t.angle+=t.angularVelocity;for(var p=0;p<t.parts.length;p++){var m=t.parts[p];o.translate(m.vertices,t.velocity),p>0&&(m.position.x+=t.velocity.x,m.position.y+=t.velocity.y),0!==t.angularVelocity&&(o.rotate(m.vertices,t.angularVelocity,t.position),h.rotate(m.axes,t.angularVelocity),p>0&&s.rotateAbout(m.position,t.angularVelocity,t.position,m.position)),l.update(m.bounds,m.vertices,t.velocity)}},n.updateVelocities=function(t){var e=n._baseDelta/t.deltaTime,i=t.velocity;i.x=(t.position.x-t.positionPrev.x)*e,i.y=(t.position.y-t.positionPrev.y)*e,t.speed=Math.sqrt(i.x*i.x+i.y*i.y),t.angularVelocity=(t.angle-t.anglePrev)*e,t.angularSpeed=Math.abs(t.angularVelocity)},n.applyForce=function(t,e,i){var n=e.x-t.position.x,o=e.y-t.position.y;t.force.x+=i.x,t.force.y+=i.y,t.torque+=n*i.y-o*i.x},n._totalProperties=function(t){for(var e={mass:0,area:0,inertia:0,centre:{x:0,y:0}},i=1===t.parts.length?0:1;i<t.parts.length;i++){var n=t.parts[i],o=n.mass!==1/0?n.mass:1;e.mass+=o,e.area+=n.area,e.inertia+=n.inertia,e.centre=s.add(e.centre,s.mult(n.position,o))}return e.centre=s.div(e.centre,e.mass),e}}()},function(t,e,i){var n={};t.exports=n;var o=i(0);n.on=function(t,e,i){for(var n,o=e.split(" "),s=0;s<o.length;s++)n=o[s],t.events=t.events||{},t.events[n]=t.events[n]||[],t.events[n].push(i);return i},n.off=function(t,e,i){if(e){"function"==typeof e&&(i=e,e=o.keys(t.events).join(" "));for(var n=e.split(" "),s=0;s<n.length;s++){var r=t.events[n[s]],a=[];if(i&&r)for(var l=0;l<r.length;l++)r[l]!==i&&a.push(r[l]);t.events[n[s]]=a}}else t.events={}},n.trigger=function(t,e,i){var n,s,r,a,l=t.events;if(l&&o.keys(l).length>0){i||(i={}),n=e.split(" ");for(var h=0;h<n.length;h++)if(r=l[s=n[h]]){(a=o.clone(i,!1)).name=s,a.source=t;for(var c=0;c<r.length;c++)r[c].apply(t,[a])}}}},function(t,e,i){var n={};t.exports=n;var o=i(5),s=i(0),r=i(1),a=i(4);n.create=function(t){return s.extend({id:s.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},t)},n.setModified=function(t,e,i,o){if(t.isModified=e,e&&t.cache&&(t.cache.allBodies=null,t.cache.allConstraints=null,t.cache.allComposites=null),i&&t.parent&&n.setModified(t.parent,e,i,o),o)for(var s=0;s<t.composites.length;s++){var r=t.composites[s];n.setModified(r,e,i,o)}},n.add=function(t,e){var i=[].concat(e);o.trigger(t,"beforeAdd",{object:e});for(var r=0;r<i.length;r++){var a=i[r];switch(a.type){case"body":if(a.parent!==a){s.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}n.addBody(t,a);break;case"constraint":n.addConstraint(t,a);break;case"composite":n.addComposite(t,a);break;case"mouseConstraint":n.addConstraint(t,a.constraint)}}return o.trigger(t,"afterAdd",{object:e}),t},n.remove=function(t,e,i){var s=[].concat(e);o.trigger(t,"beforeRemove",{object:e});for(var r=0;r<s.length;r++){var a=s[r];switch(a.type){case"body":n.removeBody(t,a,i);break;case"constraint":n.removeConstraint(t,a,i);break;case"composite":n.removeComposite(t,a,i);break;case"mouseConstraint":n.removeConstraint(t,a.constraint)}}return o.trigger(t,"afterRemove",{object:e}),t},n.addComposite=function(t,e){return t.composites.push(e),e.parent=t,n.setModified(t,!0,!0,!1),t},n.removeComposite=function(t,e,i){var o=s.indexOf(t.composites,e);if(-1!==o&&n.removeCompositeAt(t,o),i)for(var r=0;r<t.composites.length;r++)n.removeComposite(t.composites[r],e,!0);return t},n.removeCompositeAt=function(t,e){return t.composites.splice(e,1),n.setModified(t,!0,!0,!1),t},n.addBody=function(t,e){return t.bodies.push(e),n.setModified(t,!0,!0,!1),t},n.removeBody=function(t,e,i){var o=s.indexOf(t.bodies,e);if(-1!==o&&n.removeBodyAt(t,o),i)for(var r=0;r<t.composites.length;r++)n.removeBody(t.composites[r],e,!0);return t},n.removeBodyAt=function(t,e){return t.bodies.splice(e,1),n.setModified(t,!0,!0,!1),t},n.addConstraint=function(t,e){return t.constraints.push(e),n.setModified(t,!0,!0,!1),t},n.removeConstraint=function(t,e,i){var o=s.indexOf(t.constraints,e);if(-1!==o&&n.removeConstraintAt(t,o),i)for(var r=0;r<t.composites.length;r++)n.removeConstraint(t.composites[r],e,!0);return t},n.removeConstraintAt=function(t,e){return t.constraints.splice(e,1),n.setModified(t,!0,!0,!1),t},n.clear=function(t,e,i){if(i)for(var o=0;o<t.composites.length;o++)n.clear(t.composites[o],e,!0);return e?t.bodies=t.bodies.filter((function(t){return t.isStatic})):t.bodies.length=0,t.constraints.length=0,t.composites.length=0,n.setModified(t,!0,!0,!1),t},n.allBodies=function(t){if(t.cache&&t.cache.allBodies)return t.cache.allBodies;for(var e=[].concat(t.bodies),i=0;i<t.composites.length;i++)e=e.concat(n.allBodies(t.composites[i]));return t.cache&&(t.cache.allBodies=e),e},n.allConstraints=function(t){if(t.cache&&t.cache.allConstraints)return t.cache.allConstraints;for(var e=[].concat(t.constraints),i=0;i<t.composites.length;i++)e=e.concat(n.allConstraints(t.composites[i]));return t.cache&&(t.cache.allConstraints=e),e},n.allComposites=function(t){if(t.cache&&t.cache.allComposites)return t.cache.allComposites;for(var e=[].concat(t.composites),i=0;i<t.composites.length;i++)e=e.concat(n.allComposites(t.composites[i]));return t.cache&&(t.cache.allComposites=e),e},n.get=function(t,e,i){var o,s;switch(i){case"body":o=n.allBodies(t);break;case"constraint":o=n.allConstraints(t);break;case"composite":o=n.allComposites(t).concat(t)}return o?0===(s=o.filter((function(t){return t.id.toString()===e.toString()}))).length?null:s[0]:null},n.move=function(t,e,i){return n.remove(t,e),n.add(i,e),t},n.rebase=function(t){for(var e=n.allBodies(t).concat(n.allConstraints(t)).concat(n.allComposites(t)),i=0;i<e.length;i++)e[i].id=s.nextId();return t},n.translate=function(t,e,i){for(var o=i?n.allBodies(t):t.bodies,s=0;s<o.length;s++)a.translate(o[s],e);return t},n.rotate=function(t,e,i,o){for(var s=Math.cos(e),r=Math.sin(e),l=o?n.allBodies(t):t.bodies,h=0;h<l.length;h++){var c=l[h],u=c.position.x-i.x,d=c.position.y-i.y;a.setPosition(c,{x:i.x+(u*s-d*r),y:i.y+(u*r+d*s)}),a.rotate(c,e)}return t},n.scale=function(t,e,i,o,s){for(var r=s?n.allBodies(t):t.bodies,l=0;l<r.length;l++){var h=r[l],c=h.position.x-o.x,u=h.position.y-o.y;a.setPosition(h,{x:o.x+c*e,y:o.y+u*i}),a.scale(h,e,i)}return t},n.bounds=function(t){for(var e=n.allBodies(t),i=[],o=0;o<e.length;o+=1){var s=e[o];i.push(s.bounds.min,s.bounds.max)}return r.create(i)}},function(t,e,i){var n={};t.exports=n;var o=i(4),s=i(5),r=i(0);n._motionWakeThreshold=.18,n._motionSleepThreshold=.08,n._minBias=.9,n.update=function(t,e){for(var i=e/r._baseDelta,s=n._motionSleepThreshold,a=0;a<t.length;a++){var l=t[a],h=o.getSpeed(l),c=o.getAngularSpeed(l),u=h*h+c*c;if(0===l.force.x&&0===l.force.y){var d=Math.min(l.motion,u),p=Math.max(l.motion,u);l.motion=n._minBias*d+(1-n._minBias)*p,l.sleepThreshold>0&&l.motion<s?(l.sleepCounter+=1,l.sleepCounter>=l.sleepThreshold/i&&n.set(l,!0)):l.sleepCounter>0&&(l.sleepCounter-=1)}else n.set(l,!1)}},n.afterCollisions=function(t){for(var e=n._motionSleepThreshold,i=0;i<t.length;i++){var o=t[i];if(o.isActive){var s=o.collision,r=s.bodyA.parent,a=s.bodyB.parent;if(!(r.isSleeping&&a.isSleeping||r.isStatic||a.isStatic)&&(r.isSleeping||a.isSleeping)){var l=r.isSleeping&&!r.isStatic?r:a,h=l===r?a:r;!l.isStatic&&h.motion>e&&n.set(l,!1)}}}},n.set=function(t,e){var i=t.isSleeping;e?(t.isSleeping=!0,t.sleepCounter=t.sleepThreshold,t.positionImpulse.x=0,t.positionImpulse.y=0,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.anglePrev=t.angle,t.speed=0,t.angularSpeed=0,t.motion=0,i||s.trigger(t,"sleepStart")):(t.isSleeping=!1,t.sleepCounter=0,i&&s.trigger(t,"sleepEnd"))}},function(t,e,i){var n={};t.exports=n;var o,s,r,a=i(3),l=i(9);o=[],s={overlap:0,axis:null},r={overlap:0,axis:null},n.create=function(t,e){return{pair:null,collided:!1,bodyA:t,bodyB:e,parentA:t.parent,parentB:e.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[]}},n.collides=function(t,e,i){if(n._overlapAxes(s,t.vertices,e.vertices,t.axes),s.overlap<=0)return null;if(n._overlapAxes(r,e.vertices,t.vertices,e.axes),r.overlap<=0)return null;var o,h,c=i&&i.table[l.id(t,e)];c?o=c.collision:((o=n.create(t,e)).collided=!0,o.bodyA=t.id<e.id?t:e,o.bodyB=t.id<e.id?e:t,o.parentA=o.bodyA.parent,o.parentB=o.bodyB.parent),t=o.bodyA,e=o.bodyB,h=s.overlap<r.overlap?s:r;var u=o.normal,d=o.supports,p=h.axis,m=p.x,g=p.y;m*(e.position.x-t.position.x)+g*(e.position.y-t.position.y)<0?(u.x=m,u.y=g):(u.x=-m,u.y=-g),o.tangent.x=-u.y,o.tangent.y=u.x,o.depth=h.overlap,o.penetration.x=u.x*o.depth,o.penetration.y=u.y*o.depth;var f=n._findSupports(t,e,u,1),y=0;if(a.contains(t.vertices,f[0])&&(d[y++]=f[0]),a.contains(t.vertices,f[1])&&(d[y++]=f[1]),y<2){var _=n._findSupports(e,t,u,-1);a.contains(e.vertices,_[0])&&(d[y++]=_[0]),y<2&&a.contains(e.vertices,_[1])&&(d[y++]=_[1])}return 0===y&&(d[y++]=f[0]),d.length=y,o},n._overlapAxes=function(t,e,i,n){var o,s,r,a,l,h,c=e.length,u=i.length,d=e[0].x,p=e[0].y,m=i[0].x,g=i[0].y,f=n.length,y=Number.MAX_VALUE,_=0;for(l=0;l<f;l++){var v=n[l],b=v.x,x=v.y,w=d*b+p*x,S=m*b+g*x,A=w,P=S;for(h=1;h<c;h+=1)(a=e[h].x*b+e[h].y*x)>A?A=a:a<w&&(w=a);for(h=1;h<u;h+=1)(a=i[h].x*b+i[h].y*x)>P?P=a:a<S&&(S=a);if((o=(s=A-S)<(r=P-w)?s:r)<y&&(y=o,_=l,o<=0))break}t.axis=n[_],t.overlap=y},n._projectToAxis=function(t,e,i){for(var n=e[0].x*i.x+e[0].y*i.y,o=n,s=1;s<e.length;s+=1){var r=e[s].x*i.x+e[s].y*i.y;r>o?o=r:r<n&&(n=r)}t.min=n,t.max=o},n._findSupports=function(t,e,i,n){var s,r,a,l,h,c=e.vertices,u=c.length,d=t.position.x,p=t.position.y,m=i.x*n,g=i.y*n,f=Number.MAX_VALUE;for(h=0;h<u;h+=1)(l=m*(d-(r=c[h]).x)+g*(p-r.y))<f&&(f=l,s=r);return f=m*(d-(a=c[(u+s.index-1)%u]).x)+g*(p-a.y),m*(d-(r=c[(s.index+1)%u]).x)+g*(p-r.y)<f?(o[0]=s,o[1]=r,o):(o[0]=s,o[1]=a,o)}},function(t,e,i){var n={};t.exports=n;var o=i(16);n.create=function(t,e){var i=t.bodyA,o=t.bodyB,s={id:n.id(i,o),bodyA:i,bodyB:o,collision:t,contacts:[],activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:i.isSensor||o.isSensor,timeCreated:e,timeUpdated:e,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return n.update(s,t,e),s},n.update=function(t,e,i){var n=t.contacts,s=e.supports,r=t.activeContacts,a=e.parentA,l=e.parentB,h=a.vertices.length;t.isActive=!0,t.timeUpdated=i,t.collision=e,t.separation=e.depth,t.inverseMass=a.inverseMass+l.inverseMass,t.friction=a.friction<l.friction?a.friction:l.friction,t.frictionStatic=a.frictionStatic>l.frictionStatic?a.frictionStatic:l.frictionStatic,t.restitution=a.restitution>l.restitution?a.restitution:l.restitution,t.slop=a.slop>l.slop?a.slop:l.slop,e.pair=t,r.length=0;for(var c=0;c<s.length;c++){var u=s[c],d=u.body===a?u.index:h+u.index,p=n[d];p?r.push(p):r.push(n[d]=o.create(u))}},n.setActive=function(t,e,i){e?(t.isActive=!0,t.timeUpdated=i):(t.isActive=!1,t.activeContacts.length=0)},n.id=function(t,e){return t.id<e.id?"A"+t.id+"B"+e.id:"A"+e.id+"B"+t.id}},function(t,e,i){var n={};t.exports=n;var o=i(3),s=i(2),r=i(7),a=i(1),l=i(11),h=i(0);n._warming=.4,n._torqueDampen=1,n._minLength=1e-6,n.create=function(t){var e=t;e.bodyA&&!e.pointA&&(e.pointA={x:0,y:0}),e.bodyB&&!e.pointB&&(e.pointB={x:0,y:0});var i=e.bodyA?s.add(e.bodyA.position,e.pointA):e.pointA,n=e.bodyB?s.add(e.bodyB.position,e.pointB):e.pointB,o=s.magnitude(s.sub(i,n));e.length=void 0!==e.length?e.length:o,e.id=e.id||h.nextId(),e.label=e.label||"Constraint",e.type="constraint",e.stiffness=e.stiffness||(e.length>0?1:.7),e.damping=e.damping||0,e.angularStiffness=e.angularStiffness||0,e.angleA=e.bodyA?e.bodyA.angle:e.angleA,e.angleB=e.bodyB?e.bodyB.angle:e.angleB,e.plugin={};var r={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===e.length&&e.stiffness>.1?(r.type="pin",r.anchors=!1):e.stiffness<.9&&(r.type="spring"),e.render=h.extend(r,e.render),e},n.preSolveAll=function(t){for(var e=0;e<t.length;e+=1){var i=t[e],n=i.constraintImpulse;i.isStatic||0===n.x&&0===n.y&&0===n.angle||(i.position.x+=n.x,i.position.y+=n.y,i.angle+=n.angle)}},n.solveAll=function(t,e){for(var i=h.clamp(e/h._baseDelta,0,1),o=0;o<t.length;o+=1){var s=t[o],r=!s.bodyA||s.bodyA&&s.bodyA.isStatic,a=!s.bodyB||s.bodyB&&s.bodyB.isStatic;(r||a)&&n.solve(t[o],i)}for(o=0;o<t.length;o+=1)r=!(s=t[o]).bodyA||s.bodyA&&s.bodyA.isStatic,a=!s.bodyB||s.bodyB&&s.bodyB.isStatic,r||a||n.solve(t[o],i)},n.solve=function(t,e){var i=t.bodyA,o=t.bodyB,r=t.pointA,a=t.pointB;if(i||o){i&&!i.isStatic&&(s.rotate(r,i.angle-t.angleA,r),t.angleA=i.angle),o&&!o.isStatic&&(s.rotate(a,o.angle-t.angleB,a),t.angleB=o.angle);var l=r,h=a;if(i&&(l=s.add(i.position,r)),o&&(h=s.add(o.position,a)),l&&h){var c=s.sub(l,h),u=s.magnitude(c);u<n._minLength&&(u=n._minLength);var d,p,m,g,f,y=(u-t.length)/u,_=t.stiffness>=1||0===t.length?t.stiffness*e:t.stiffness*e*e,v=t.damping*e,b=s.mult(c,y*_),x=(i?i.inverseMass:0)+(o?o.inverseMass:0),w=x+((i?i.inverseInertia:0)+(o?o.inverseInertia:0));if(v>0){var S=s.create();m=s.div(c,u),f=s.sub(o&&s.sub(o.position,o.positionPrev)||S,i&&s.sub(i.position,i.positionPrev)||S),g=s.dot(m,f)}i&&!i.isStatic&&(p=i.inverseMass/x,i.constraintImpulse.x-=b.x*p,i.constraintImpulse.y-=b.y*p,i.position.x-=b.x*p,i.position.y-=b.y*p,v>0&&(i.positionPrev.x-=v*m.x*g*p,i.positionPrev.y-=v*m.y*g*p),d=s.cross(r,b)/w*n._torqueDampen*i.inverseInertia*(1-t.angularStiffness),i.constraintImpulse.angle-=d,i.angle-=d),o&&!o.isStatic&&(p=o.inverseMass/x,o.constraintImpulse.x+=b.x*p,o.constraintImpulse.y+=b.y*p,o.position.x+=b.x*p,o.position.y+=b.y*p,v>0&&(o.positionPrev.x+=v*m.x*g*p,o.positionPrev.y+=v*m.y*g*p),d=s.cross(a,b)/w*n._torqueDampen*o.inverseInertia*(1-t.angularStiffness),o.constraintImpulse.angle+=d,o.angle+=d)}}},n.postSolveAll=function(t){for(var e=0;e<t.length;e++){var i=t[e],h=i.constraintImpulse;if(!(i.isStatic||0===h.x&&0===h.y&&0===h.angle)){r.set(i,!1);for(var c=0;c<i.parts.length;c++){var u=i.parts[c];o.translate(u.vertices,h),c>0&&(u.position.x+=h.x,u.position.y+=h.y),0!==h.angle&&(o.rotate(u.vertices,h.angle,i.position),l.rotate(u.axes,h.angle),c>0&&s.rotateAbout(u.position,h.angle,i.position,u.position)),a.update(u.bounds,u.vertices,i.velocity)}h.angle*=n._warming,h.x*=n._warming,h.y*=n._warming}}},n.pointAWorld=function(t){return{x:(t.bodyA?t.bodyA.position.x:0)+(t.pointA?t.pointA.x:0),y:(t.bodyA?t.bodyA.position.y:0)+(t.pointA?t.pointA.y:0)}},n.pointBWorld=function(t){return{x:(t.bodyB?t.bodyB.position.x:0)+(t.pointB?t.pointB.x:0),y:(t.bodyB?t.bodyB.position.y:0)+(t.pointB?t.pointB.y:0)}}},function(t,e,i){var n={};t.exports=n;var o=i(2),s=i(0);n.fromVertices=function(t){for(var e={},i=0;i<t.length;i++){var n=(i+1)%t.length,r=o.normalise({x:t[n].y-t[i].y,y:t[i].x-t[n].x}),a=0===r.y?1/0:r.x/r.y;e[a=a.toFixed(3).toString()]=r}return s.values(e)},n.rotate=function(t,e){if(0!==e)for(var i=Math.cos(e),n=Math.sin(e),o=0;o<t.length;o++){var s,r=t[o];s=r.x*i-r.y*n,r.y=r.x*n+r.y*i,r.x=s}}},function(t,e,i){var n={};t.exports=n;var o=i(3),s=i(0),r=i(4),a=i(1),l=i(2);n.rectangle=function(t,e,i,n,a){a=a||{};var l={label:"Rectangle Body",position:{x:t,y:e},vertices:o.fromPath("L 0 0 L "+i+" 0 L "+i+" "+n+" L 0 "+n)};if(a.chamfer){var h=a.chamfer;l.vertices=o.chamfer(l.vertices,h.radius,h.quality,h.qualityMin,h.qualityMax),delete a.chamfer}return r.create(s.extend({},l,a))},n.trapezoid=function(t,e,i,n,a,l){l=l||{};var h,c=i*(a*=.5),u=c+(1-2*a)*i,d=u+c;h=a<.5?"L 0 0 L "+c+" "+-n+" L "+u+" "+-n+" L "+d+" 0":"L 0 0 L "+u+" "+-n+" L "+d+" 0";var p={label:"Trapezoid Body",position:{x:t,y:e},vertices:o.fromPath(h)};if(l.chamfer){var m=l.chamfer;p.vertices=o.chamfer(p.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax),delete l.chamfer}return r.create(s.extend({},p,l))},n.circle=function(t,e,i,o,r){o=o||{};var a={label:"Circle Body",circleRadius:i};r=r||25;var l=Math.ceil(Math.max(10,Math.min(r,i)));return l%2==1&&(l+=1),n.polygon(t,e,l,i,s.extend({},a,o))},n.polygon=function(t,e,i,a,l){if(l=l||{},i<3)return n.circle(t,e,a,l);for(var h=2*Math.PI/i,c="",u=.5*h,d=0;d<i;d+=1){var p=u+d*h,m=Math.cos(p)*a,g=Math.sin(p)*a;c+="L "+m.toFixed(3)+" "+g.toFixed(3)+" "}var f={label:"Polygon Body",position:{x:t,y:e},vertices:o.fromPath(c)};if(l.chamfer){var y=l.chamfer;f.vertices=o.chamfer(f.vertices,y.radius,y.quality,y.qualityMin,y.qualityMax),delete l.chamfer}return r.create(s.extend({},f,l))},n.fromVertices=function(t,e,i,n,h,c,u,d){var p,m,g,f,y,_,v,b,x,w,S=s.getDecomp();for(p=Boolean(S&&S.quickDecomp),n=n||{},g=[],h=void 0!==h&&h,c=void 0!==c?c:.01,u=void 0!==u?u:10,d=void 0!==d?d:.01,s.isArray(i[0])||(i=[i]),x=0;x<i.length;x+=1)if(y=i[x],!(f=o.isConvex(y))&&!p&&s.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),f||!p)y=f?o.clockwiseSort(y):o.hull(y),g.push({position:{x:t,y:e},vertices:y});else{var A=y.map((function(t){return[t.x,t.y]}));S.makeCCW(A),!1!==c&&S.removeCollinearPoints(A,c),!1!==d&&S.removeDuplicatePoints&&S.removeDuplicatePoints(A,d);var P=S.quickDecomp(A);for(_=0;_<P.length;_++){var T=P[_].map((function(t){return{x:t[0],y:t[1]}}));u>0&&o.area(T)<u||g.push({position:o.centre(T),vertices:T})}}for(_=0;_<g.length;_++)g[_]=r.create(s.extend(g[_],n));if(h)for(_=0;_<g.length;_++){var B=g[_];for(v=_+1;v<g.length;v++){var C=g[v];if(a.overlaps(B.bounds,C.bounds)){var I=B.vertices,M=C.vertices;for(b=0;b<B.vertices.length;b++)for(w=0;w<C.vertices.length;w++){var L=l.magnitudeSquared(l.sub(I[(b+1)%I.length],M[w])),E=l.magnitudeSquared(l.sub(I[b],M[(w+1)%M.length]));L<5&&E<5&&(I[b].isInternal=!0,M[w].isInternal=!0)}}}}return g.length>1?(m=r.create(s.extend({parts:g.slice(0)},n)),r.setPosition(m,{x:t,y:e}),m):g[0]}},function(t,e,i){var n={};t.exports=n;var o=i(0),s=i(8);n.create=function(t){return o.extend({bodies:[],pairs:null},t)},n.setBodies=function(t,e){t.bodies=e.slice(0)},n.clear=function(t){t.bodies=[]},n.collisions=function(t){var e,i,o=[],r=t.pairs,a=t.bodies,l=a.length,h=n.canCollide,c=s.collides;for(a.sort(n._compareBoundsX),e=0;e<l;e++){var u=a[e],d=u.bounds,p=u.bounds.max.x,m=u.bounds.max.y,g=u.bounds.min.y,f=u.isStatic||u.isSleeping,y=u.parts.length,_=1===y;for(i=e+1;i<l;i++){var v=a[i];if((B=v.bounds).min.x>p)break;if(!(m<B.min.y||g>B.max.y)&&(!f||!v.isStatic&&!v.isSleeping)&&h(u.collisionFilter,v.collisionFilter)){var b=v.parts.length;if(_&&1===b)(P=c(u,v,r))&&o.push(P);else for(var x=b>1?1:0,w=y>1?1:0;w<y;w++)for(var S=u.parts[w],A=(d=S.bounds,x);A<b;A++){var P,T=v.parts[A],B=T.bounds;d.min.x>B.max.x||d.max.x<B.min.x||d.max.y<B.min.y||d.min.y>B.max.y||(P=c(S,T,r))&&o.push(P)}}}}return o},n.canCollide=function(t,e){return t.group===e.group&&0!==t.group?t.group>0:!!(t.mask&e.category)&&!!(e.mask&t.category)},n._compareBoundsX=function(t,e){return t.bounds.min.x-e.bounds.min.x}},function(t,e,i){var n={};t.exports=n;var o=i(0);n.create=function(t){var e={};return t||o.log("Mouse.create: element was undefined, defaulting to document.body","warn"),e.element=t||document.body,e.absolute={x:0,y:0},e.position={x:0,y:0},e.mousedownPosition={x:0,y:0},e.mouseupPosition={x:0,y:0},e.offset={x:0,y:0},e.scale={x:1,y:1},e.wheelDelta=0,e.button=-1,e.pixelRatio=parseInt(e.element.getAttribute("data-pixel-ratio"),10)||1,e.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},e.mousemove=function(t){var i=n._getRelativeMousePosition(t,e.element,e.pixelRatio);t.changedTouches&&(e.button=0,t.preventDefault()),e.absolute.x=i.x,e.absolute.y=i.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.sourceEvents.mousemove=t},e.mousedown=function(t){var i=n._getRelativeMousePosition(t,e.element,e.pixelRatio);t.changedTouches?(e.button=0,t.preventDefault()):e.button=t.button,e.absolute.x=i.x,e.absolute.y=i.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mousedownPosition.x=e.position.x,e.mousedownPosition.y=e.position.y,e.sourceEvents.mousedown=t},e.mouseup=function(t){var i=n._getRelativeMousePosition(t,e.element,e.pixelRatio);t.changedTouches&&t.preventDefault(),e.button=-1,e.absolute.x=i.x,e.absolute.y=i.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mouseupPosition.x=e.position.x,e.mouseupPosition.y=e.position.y,e.sourceEvents.mouseup=t},e.mousewheel=function(t){e.wheelDelta=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),t.preventDefault()},n.setElement(e,e.element),e},n.setElement=function(t,e){t.element=e,e.addEventListener("mousemove",t.mousemove),e.addEventListener("mousedown",t.mousedown),e.addEventListener("mouseup",t.mouseup),e.addEventListener("mousewheel",t.mousewheel),e.addEventListener("DOMMouseScroll",t.mousewheel),e.addEventListener("touchmove",t.mousemove),e.addEventListener("touchstart",t.mousedown),e.addEventListener("touchend",t.mouseup)},n.clearSourceEvents=function(t){t.sourceEvents.mousemove=null,t.sourceEvents.mousedown=null,t.sourceEvents.mouseup=null,t.sourceEvents.mousewheel=null,t.wheelDelta=0},n.setOffset=function(t,e){t.offset.x=e.x,t.offset.y=e.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y},n.setScale=function(t,e){t.scale.x=e.x,t.scale.y=e.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y},n._getRelativeMousePosition=function(t,e,i){var n,o,s=e.getBoundingClientRect(),r=document.documentElement||document.body.parentNode||document.body,a=void 0!==window.pageXOffset?window.pageXOffset:r.scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:r.scrollTop,h=t.changedTouches;return h?(n=h[0].pageX-s.left-a,o=h[0].pageY-s.top-l):(n=t.pageX-s.left-a,o=t.pageY-s.top-l),{x:n/(e.clientWidth/(e.width||e.clientWidth)*i),y:o/(e.clientHeight/(e.height||e.clientHeight)*i)}}},function(t,e,i){var n={};t.exports=n;var o=i(0);n._registry={},n.register=function(t){if(n.isPlugin(t)||o.warn("Plugin.register:",n.toString(t),"does not implement all required fields."),t.name in n._registry){var e=n._registry[t.name],i=n.versionParse(t.version).number,s=n.versionParse(e.version).number;i>s?(o.warn("Plugin.register:",n.toString(e),"was upgraded to",n.toString(t)),n._registry[t.name]=t):i<s?o.warn("Plugin.register:",n.toString(e),"can not be downgraded to",n.toString(t)):t!==e&&o.warn("Plugin.register:",n.toString(t),"is already registered to different plugin object")}else n._registry[t.name]=t;return t},n.resolve=function(t){return n._registry[n.dependencyParse(t).name]},n.toString=function(t){return"string"==typeof t?t:(t.name||"anonymous")+"@"+(t.version||t.range||"0.0.0")},n.isPlugin=function(t){return t&&t.name&&t.version&&t.install},n.isUsed=function(t,e){return t.used.indexOf(e)>-1},n.isFor=function(t,e){var i=t.for&&n.dependencyParse(t.for);return!t.for||e.name===i.name&&n.versionSatisfies(e.version,i.range)},n.use=function(t,e){if(t.uses=(t.uses||[]).concat(e||[]),0!==t.uses.length){for(var i=n.dependencies(t),s=o.topologicalSort(i),r=[],a=0;a<s.length;a+=1)if(s[a]!==t.name){var l=n.resolve(s[a]);l?n.isUsed(t,l.name)||(n.isFor(l,t)||(o.warn("Plugin.use:",n.toString(l),"is for",l.for,"but installed on",n.toString(t)+"."),l._warned=!0),l.install?l.install(t):(o.warn("Plugin.use:",n.toString(l),"does not specify an install function."),l._warned=!0),l._warned?(r.push("ðŸ”¶ "+n.toString(l)),delete l._warned):r.push("âœ… "+n.toString(l)),t.used.push(l.name)):r.push("âŒ "+s[a])}r.length>0&&o.info(r.join("  "))}else o.warn("Plugin.use:",n.toString(t),"does not specify any dependencies to install.")},n.dependencies=function(t,e){var i=n.dependencyParse(t),s=i.name;if(!(s in(e=e||{}))){t=n.resolve(t)||t,e[s]=o.map(t.uses||[],(function(e){n.isPlugin(e)&&n.register(e);var s=n.dependencyParse(e),r=n.resolve(e);return r&&!n.versionSatisfies(r.version,s.range)?(o.warn("Plugin.dependencies:",n.toString(r),"does not satisfy",n.toString(s),"used by",n.toString(i)+"."),r._warned=!0,t._warned=!0):r||(o.warn("Plugin.dependencies:",n.toString(e),"used by",n.toString(i),"could not be resolved."),t._warned=!0),s.name}));for(var r=0;r<e[s].length;r+=1)n.dependencies(e[s][r],e);return e}},n.dependencyParse=function(t){return o.isString(t)?(/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/.test(t)||o.warn("Plugin.dependencyParse:",t,"is not a valid dependency string."),{name:t.split("@")[0],range:t.split("@")[1]||"*"}):{name:t.name,range:t.range||t.version}},n.versionParse=function(t){var e=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;e.test(t)||o.warn("Plugin.versionParse:",t,"is not a valid version or range.");var i=e.exec(t),n=Number(i[4]),s=Number(i[5]),r=Number(i[6]);return{isRange:Boolean(i[1]||i[2]),version:i[3],range:t,operator:i[1]||i[2]||"",major:n,minor:s,patch:r,parts:[n,s,r],prerelease:i[7],number:1e8*n+1e4*s+r}},n.versionSatisfies=function(t,e){e=e||"*";var i=n.versionParse(e),o=n.versionParse(t);if(i.isRange){if("*"===i.operator||"*"===t)return!0;if(">"===i.operator)return o.number>i.number;if(">="===i.operator)return o.number>=i.number;if("~"===i.operator)return o.major===i.major&&o.minor===i.minor&&o.patch>=i.patch;if("^"===i.operator)return i.major>0?o.major===i.major&&o.number>=i.number:i.minor>0?o.minor===i.minor&&o.patch>=i.patch:o.patch===i.patch}return t===e||"*"===t}},function(t,e){var i={};t.exports=i,i.create=function(t){return{vertex:t,normalImpulse:0,tangentImpulse:0}}},function(t,e,i){var n={};t.exports=n;var o=i(7),s=i(18),r=i(13),a=i(19),l=i(5),h=i(6),c=i(10),u=i(0),d=i(4);n.create=function(t){t=t||{};var e=u.extend({positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},t);return e.world=t.world||h.create({label:"World"}),e.pairs=t.pairs||a.create(),e.detector=t.detector||r.create(),e.grid={buckets:[]},e.world.gravity=e.gravity,e.broadphase=e.grid,e.metrics={},e},n.update=function(t,e){var i,d=u.now(),p=t.world,m=t.detector,g=t.pairs,f=t.timing,y=f.timestamp;e=void 0!==e?e:u._baseDelta,e*=f.timeScale,f.timestamp+=e,f.lastDelta=e;var _={timestamp:f.timestamp,delta:e};l.trigger(t,"beforeUpdate",_);var v=h.allBodies(p),b=h.allConstraints(p);for(p.isModified&&(r.setBodies(m,v),h.setModified(p,!1,!1,!0)),t.enableSleeping&&o.update(v,e),n._bodiesApplyGravity(v,t.gravity),e>0&&n._bodiesUpdate(v,e),c.preSolveAll(v),i=0;i<t.constraintIterations;i++)c.solveAll(b,e);c.postSolveAll(v),m.pairs=t.pairs;var x=r.collisions(m);a.update(g,x,y),t.enableSleeping&&o.afterCollisions(g.list),g.collisionStart.length>0&&l.trigger(t,"collisionStart",{pairs:g.collisionStart});var w=u.clamp(20/t.positionIterations,0,1);for(s.preSolvePosition(g.list),i=0;i<t.positionIterations;i++)s.solvePosition(g.list,e,w);for(s.postSolvePosition(v),c.preSolveAll(v),i=0;i<t.constraintIterations;i++)c.solveAll(b,e);for(c.postSolveAll(v),s.preSolveVelocity(g.list),i=0;i<t.velocityIterations;i++)s.solveVelocity(g.list,e);return n._bodiesUpdateVelocities(v),g.collisionActive.length>0&&l.trigger(t,"collisionActive",{pairs:g.collisionActive}),g.collisionEnd.length>0&&l.trigger(t,"collisionEnd",{pairs:g.collisionEnd}),n._bodiesClearForces(v),l.trigger(t,"afterUpdate",_),t.timing.lastElapsed=u.now()-d,t},n.merge=function(t,e){if(u.extend(t,e),e.world){t.world=e.world,n.clear(t);for(var i=h.allBodies(t.world),s=0;s<i.length;s++){var r=i[s];o.set(r,!1),r.id=u.nextId()}}},n.clear=function(t){a.clear(t.pairs),r.clear(t.detector)},n._bodiesClearForces=function(t){for(var e=t.length,i=0;i<e;i++){var n=t[i];n.force.x=0,n.force.y=0,n.torque=0}},n._bodiesApplyGravity=function(t,e){var i=void 0!==e.scale?e.scale:.001,n=t.length;if((0!==e.x||0!==e.y)&&0!==i)for(var o=0;o<n;o++){var s=t[o];s.isStatic||s.isSleeping||(s.force.y+=s.mass*e.y*i,s.force.x+=s.mass*e.x*i)}},n._bodiesUpdate=function(t,e){for(var i=t.length,n=0;n<i;n++){var o=t[n];o.isStatic||o.isSleeping||d.update(o,e)}},n._bodiesUpdateVelocities=function(t){for(var e=t.length,i=0;i<e;i++)d.updateVelocities(t[i])}},function(t,e,i){var n={};t.exports=n;var o=i(3),s=i(0),r=i(1);n._restingThresh=2,n._restingThreshTangent=Math.sqrt(6),n._positionDampen=.9,n._positionWarming=.8,n._frictionNormalMultiplier=5,n._frictionMaxStatic=Number.MAX_VALUE,n.preSolvePosition=function(t){var e,i,n,o=t.length;for(e=0;e<o;e++)(i=t[e]).isActive&&(n=i.activeContacts.length,i.collision.parentA.totalContacts+=n,i.collision.parentB.totalContacts+=n)},n.solvePosition=function(t,e,i){var o,r,a,l,h,c,u,d,p=n._positionDampen*(i||1),m=s.clamp(e/s._baseDelta,0,1),g=t.length;for(o=0;o<g;o++)(r=t[o]).isActive&&!r.isSensor&&(l=(a=r.collision).parentA,h=a.parentB,c=a.normal,r.separation=c.x*(h.positionImpulse.x+a.penetration.x-l.positionImpulse.x)+c.y*(h.positionImpulse.y+a.penetration.y-l.positionImpulse.y));for(o=0;o<g;o++)(r=t[o]).isActive&&!r.isSensor&&(l=(a=r.collision).parentA,h=a.parentB,c=a.normal,d=r.separation-r.slop*m,(l.isStatic||h.isStatic)&&(d*=2),l.isStatic||l.isSleeping||(u=p/l.totalContacts,l.positionImpulse.x+=c.x*d*u,l.positionImpulse.y+=c.y*d*u),h.isStatic||h.isSleeping||(u=p/h.totalContacts,h.positionImpulse.x-=c.x*d*u,h.positionImpulse.y-=c.y*d*u))},n.postSolvePosition=function(t){for(var e=n._positionWarming,i=t.length,s=o.translate,a=r.update,l=0;l<i;l++){var h=t[l],c=h.positionImpulse,u=c.x,d=c.y,p=h.velocity;if(h.totalContacts=0,0!==u||0!==d){for(var m=0;m<h.parts.length;m++){var g=h.parts[m];s(g.vertices,c),a(g.bounds,g.vertices,p),g.position.x+=u,g.position.y+=d}h.positionPrev.x+=u,h.positionPrev.y+=d,u*p.x+d*p.y<0?(c.x=0,c.y=0):(c.x*=e,c.y*=e)}}},n.preSolveVelocity=function(t){var e,i,n=t.length;for(e=0;e<n;e++){var o=t[e];if(o.isActive&&!o.isSensor){var s=o.activeContacts,r=s.length,a=o.collision,l=a.parentA,h=a.parentB,c=a.normal,u=a.tangent;for(i=0;i<r;i++){var d=s[i],p=d.vertex,m=d.normalImpulse,g=d.tangentImpulse;if(0!==m||0!==g){var f=c.x*m+u.x*g,y=c.y*m+u.y*g;l.isStatic||l.isSleeping||(l.positionPrev.x+=f*l.inverseMass,l.positionPrev.y+=y*l.inverseMass,l.anglePrev+=l.inverseInertia*((p.x-l.position.x)*y-(p.y-l.position.y)*f)),h.isStatic||h.isSleeping||(h.positionPrev.x-=f*h.inverseMass,h.positionPrev.y-=y*h.inverseMass,h.anglePrev-=h.inverseInertia*((p.x-h.position.x)*y-(p.y-h.position.y)*f))}}}}},n.solveVelocity=function(t,e){var i,o,r,a,l=e/s._baseDelta,h=l*l*l,c=-n._restingThresh*l,u=n._restingThreshTangent,d=n._frictionNormalMultiplier*l,p=n._frictionMaxStatic,m=t.length;for(r=0;r<m;r++){var g=t[r];if(g.isActive&&!g.isSensor){var f=g.collision,y=f.parentA,_=f.parentB,v=y.velocity,b=_.velocity,x=f.normal.x,w=f.normal.y,S=f.tangent.x,A=f.tangent.y,P=g.activeContacts,T=P.length,B=1/T,C=y.inverseMass+_.inverseMass,I=g.friction*g.frictionStatic*d;for(v.x=y.position.x-y.positionPrev.x,v.y=y.position.y-y.positionPrev.y,b.x=_.position.x-_.positionPrev.x,b.y=_.position.y-_.positionPrev.y,y.angularVelocity=y.angle-y.anglePrev,_.angularVelocity=_.angle-_.anglePrev,a=0;a<T;a++){var M=P[a],L=M.vertex,E=L.x-y.position.x,R=L.y-y.position.y,D=L.x-_.position.x,O=L.y-_.position.y,F=v.x-R*y.angularVelocity,k=v.y+E*y.angularVelocity,H=F-(b.x-O*_.angularVelocity),V=k-(b.y+D*_.angularVelocity),N=x*H+w*V,W=S*H+A*V,G=g.separation+N,U=Math.min(G,1),q=(U=G<0?0:U)*I;W<-q||W>q?(o=W>0?W:-W,(i=g.friction*(W>0?1:-1)*h)<-o?i=-o:i>o&&(i=o)):(i=W,o=p);var z=E*w-R*x,$=D*w-O*x,j=B/(C+y.inverseInertia*z*z+_.inverseInertia*$*$),Y=(1+g.restitution)*N*j;if(i*=j,N<c)M.normalImpulse=0;else{var X=M.normalImpulse;M.normalImpulse+=Y,M.normalImpulse>0&&(M.normalImpulse=0),Y=M.normalImpulse-X}if(W<-u||W>u)M.tangentImpulse=0;else{var Z=M.tangentImpulse;M.tangentImpulse+=i,M.tangentImpulse<-o&&(M.tangentImpulse=-o),M.tangentImpulse>o&&(M.tangentImpulse=o),i=M.tangentImpulse-Z}var K=x*Y+S*i,Q=w*Y+A*i;y.isStatic||y.isSleeping||(y.positionPrev.x+=K*y.inverseMass,y.positionPrev.y+=Q*y.inverseMass,y.anglePrev+=(E*Q-R*K)*y.inverseInertia),_.isStatic||_.isSleeping||(_.positionPrev.x-=K*_.inverseMass,_.positionPrev.y-=Q*_.inverseMass,_.anglePrev-=(D*Q-O*K)*_.inverseInertia)}}}}},function(t,e,i){var n={};t.exports=n;var o=i(9),s=i(0);n.create=function(t){return s.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},t)},n.update=function(t,e,i){var n,s,r,a,l=t.list,h=l.length,c=t.table,u=e.length,d=t.collisionStart,p=t.collisionEnd,m=t.collisionActive;for(d.length=0,p.length=0,m.length=0,a=0;a<h;a++)l[a].confirmedActive=!1;for(a=0;a<u;a++)(r=(n=e[a]).pair)?(r.isActive?m.push(r):d.push(r),o.update(r,n,i),r.confirmedActive=!0):(c[(r=o.create(n,i)).id]=r,d.push(r),l.push(r));var g=[];for(h=l.length,a=0;a<h;a++)(r=l[a]).confirmedActive||(o.setActive(r,!1,i),p.push(r),r.collision.bodyA.isSleeping||r.collision.bodyB.isSleeping||g.push(a));for(a=0;a<g.length;a++)r=l[s=g[a]-a],l.splice(s,1),delete c[r.id]},n.clear=function(t){return t.table={},t.list.length=0,t.collisionStart.length=0,t.collisionActive.length=0,t.collisionEnd.length=0,t}},function(t,e,i){var n=t.exports=i(21);n.Axes=i(11),n.Bodies=i(12),n.Body=i(4),n.Bounds=i(1),n.Collision=i(8),n.Common=i(0),n.Composite=i(6),n.Composites=i(22),n.Constraint=i(10),n.Contact=i(16),n.Detector=i(13),n.Engine=i(17),n.Events=i(5),n.Grid=i(23),n.Mouse=i(14),n.MouseConstraint=i(24),n.Pair=i(9),n.Pairs=i(19),n.Plugin=i(15),n.Query=i(25),n.Render=i(26),n.Resolver=i(18),n.Runner=i(27),n.SAT=i(28),n.Sleeping=i(7),n.Svg=i(29),n.Vector=i(2),n.Vertices=i(3),n.World=i(30),n.Engine.run=n.Runner.run,n.Common.deprecated(n.Engine,"run","Engine.run âž¤ use Matter.Runner.run(engine) instead")},function(t,e,i){var n={};t.exports=n;var o=i(15),s=i(0);n.name="matter-js",n.version="0.19.0",n.uses=[],n.used=[],n.use=function(){o.use(n,Array.prototype.slice.call(arguments))},n.before=function(t,e){return t=t.replace(/^Matter./,""),s.chainPathBefore(n,t,e)},n.after=function(t,e){return t=t.replace(/^Matter./,""),s.chainPathAfter(n,t,e)}},function(t,e,i){var n={};t.exports=n;var o=i(6),s=i(10),r=i(0),a=i(4),l=i(12),h=r.deprecated;n.stack=function(t,e,i,n,s,r,l){for(var h,c=o.create({label:"Stack"}),u=t,d=e,p=0,m=0;m<n;m++){for(var g=0,f=0;f<i;f++){var y=l(u,d,f,m,h,p);if(y){var _=y.bounds.max.y-y.bounds.min.y,v=y.bounds.max.x-y.bounds.min.x;_>g&&(g=_),a.translate(y,{x:.5*v,y:.5*_}),u=y.bounds.max.x+s,o.addBody(c,y),h=y,p+=1}else u+=s}d+=g+r,u=t}return c},n.chain=function(t,e,i,n,a,l){for(var h=t.bodies,c=1;c<h.length;c++){var u=h[c-1],d=h[c],p=u.bounds.max.y-u.bounds.min.y,m=u.bounds.max.x-u.bounds.min.x,g=d.bounds.max.y-d.bounds.min.y,f={bodyA:u,pointA:{x:m*e,y:p*i},bodyB:d,pointB:{x:(d.bounds.max.x-d.bounds.min.x)*n,y:g*a}},y=r.extend(f,l);o.addConstraint(t,s.create(y))}return t.label+=" Chain",t},n.mesh=function(t,e,i,n,a){var l,h,c,u,d,p=t.bodies;for(l=0;l<i;l++){for(h=1;h<e;h++)c=p[h-1+l*e],u=p[h+l*e],o.addConstraint(t,s.create(r.extend({bodyA:c,bodyB:u},a)));if(l>0)for(h=0;h<e;h++)c=p[h+(l-1)*e],u=p[h+l*e],o.addConstraint(t,s.create(r.extend({bodyA:c,bodyB:u},a))),n&&h>0&&(d=p[h-1+(l-1)*e],o.addConstraint(t,s.create(r.extend({bodyA:d,bodyB:u},a)))),n&&h<e-1&&(d=p[h+1+(l-1)*e],o.addConstraint(t,s.create(r.extend({bodyA:d,bodyB:u},a))))}return t.label+=" Mesh",t},n.pyramid=function(t,e,i,o,s,r,l){return n.stack(t,e,i,o,s,r,(function(e,n,r,h,c,u){var d=Math.min(o,Math.ceil(i/2)),p=c?c.bounds.max.x-c.bounds.min.x:0;if(!(h>d||r<(h=d-h)||r>i-1-h))return 1===u&&a.translate(c,{x:(r+(i%2==1?1:-1))*p,y:0}),l(t+(c?r*p:0)+r*s,n,r,h,c,u)}))},n.newtonsCradle=function(t,e,i,n,r){for(var a=o.create({label:"Newtons Cradle"}),h=0;h<i;h++){var c=l.circle(t+h*(1.9*n),e+r,n,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),u=s.create({pointA:{x:t+h*(1.9*n),y:e},bodyB:c});o.addBody(a,c),o.addConstraint(a,u)}return a},h(n,"newtonsCradle","Composites.newtonsCradle âž¤ moved to newtonsCradle example"),n.car=function(t,e,i,n,r){var h=a.nextGroup(!0),c=.5*-i+20,u=.5*i-20,d=o.create({label:"Car"}),p=l.rectangle(t,e,i,n,{collisionFilter:{group:h},chamfer:{radius:.5*n},density:2e-4}),m=l.circle(t+c,e+0,r,{collisionFilter:{group:h},friction:.8}),g=l.circle(t+u,e+0,r,{collisionFilter:{group:h},friction:.8}),f=s.create({bodyB:p,pointB:{x:c,y:0},bodyA:m,stiffness:1,length:0}),y=s.create({bodyB:p,pointB:{x:u,y:0},bodyA:g,stiffness:1,length:0});return o.addBody(d,p),o.addBody(d,m),o.addBody(d,g),o.addConstraint(d,f),o.addConstraint(d,y),d},h(n,"car","Composites.car âž¤ moved to car example"),n.softBody=function(t,e,i,o,s,a,h,c,u,d){u=r.extend({inertia:1/0},u),d=r.extend({stiffness:.2,render:{type:"line",anchors:!1}},d);var p=n.stack(t,e,i,o,s,a,(function(t,e){return l.circle(t,e,c,u)}));return n.mesh(p,i,o,h,d),p.label="Soft Body",p},h(n,"softBody","Composites.softBody âž¤ moved to softBody and cloth examples")},function(t,e,i){var n={};t.exports=n;var o=i(9),s=i(0),r=s.deprecated;n.create=function(t){return s.extend({buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48},t)},n.update=function(t,e,i,o){var s,r,a,l,h,c=i.world,u=t.buckets,d=!1;for(s=0;s<e.length;s++){var p=e[s];if((!p.isSleeping||o)&&(!c.bounds||!(p.bounds.max.x<c.bounds.min.x||p.bounds.min.x>c.bounds.max.x||p.bounds.max.y<c.bounds.min.y||p.bounds.min.y>c.bounds.max.y))){var m=n._getRegion(t,p);if(!p.region||m.id!==p.region.id||o){p.region&&!o||(p.region=m);var g=n._regionUnion(m,p.region);for(r=g.startCol;r<=g.endCol;r++)for(a=g.startRow;a<=g.endRow;a++){l=u[h=n._getBucketId(r,a)];var f=r>=m.startCol&&r<=m.endCol&&a>=m.startRow&&a<=m.endRow,y=r>=p.region.startCol&&r<=p.region.endCol&&a>=p.region.startRow&&a<=p.region.endRow;!f&&y&&y&&l&&n._bucketRemoveBody(t,l,p),(p.region===m||f&&!y||o)&&(l||(l=n._createBucket(u,h)),n._bucketAddBody(t,l,p))}p.region=m,d=!0}}}d&&(t.pairsList=n._createActivePairsList(t))},r(n,"update","Grid.update âž¤ replaced by Matter.Detector"),n.clear=function(t){t.buckets={},t.pairs={},t.pairsList=[]},r(n,"clear","Grid.clear âž¤ replaced by Matter.Detector"),n._regionUnion=function(t,e){var i=Math.min(t.startCol,e.startCol),o=Math.max(t.endCol,e.endCol),s=Math.min(t.startRow,e.startRow),r=Math.max(t.endRow,e.endRow);return n._createRegion(i,o,s,r)},n._getRegion=function(t,e){var i=e.bounds,o=Math.floor(i.min.x/t.bucketWidth),s=Math.floor(i.max.x/t.bucketWidth),r=Math.floor(i.min.y/t.bucketHeight),a=Math.floor(i.max.y/t.bucketHeight);return n._createRegion(o,s,r,a)},n._createRegion=function(t,e,i,n){return{id:t+","+e+","+i+","+n,startCol:t,endCol:e,startRow:i,endRow:n}},n._getBucketId=function(t,e){return"C"+t+"R"+e},n._createBucket=function(t,e){return t[e]=[]},n._bucketAddBody=function(t,e,i){var n,s=t.pairs,r=o.id,a=e.length;for(n=0;n<a;n++){var l=e[n];if(!(i.id===l.id||i.isStatic&&l.isStatic)){var h=r(i,l),c=s[h];c?c[2]+=1:s[h]=[i,l,1]}}e.push(i)},n._bucketRemoveBody=function(t,e,i){var n,r=t.pairs,a=o.id;e.splice(s.indexOf(e,i),1);var l=e.length;for(n=0;n<l;n++){var h=r[a(i,e[n])];h&&(h[2]-=1)}},n._createActivePairsList=function(t){var e,i,n=t.pairs,o=s.keys(n),r=o.length,a=[];for(i=0;i<r;i++)(e=n[o[i]])[2]>0?a.push(e):delete n[o[i]];return a}},function(t,e,i){var n={};t.exports=n;var o=i(3),s=i(7),r=i(14),a=i(5),l=i(13),h=i(10),c=i(6),u=i(0),d=i(1);n.create=function(t,e){var i=(t?t.mouse:null)||(e?e.mouse:null);i||(t&&t.render&&t.render.canvas?i=r.create(t.render.canvas):e&&e.element?i=r.create(e.element):(i=r.create(),u.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var o={type:"mouseConstraint",mouse:i,element:null,body:null,constraint:h.create({label:"Mouse Constraint",pointA:i.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),collisionFilter:{category:1,mask:4294967295,group:0}},s=u.extend(o,e);return a.on(t,"beforeUpdate",(function(){var e=c.allBodies(t.world);n.update(s,e),n._triggerEvents(s)})),s},n.update=function(t,e){var i=t.mouse,n=t.constraint,r=t.body;if(0===i.button){if(n.bodyB)s.set(n.bodyB,!1),n.pointA=i.position;else for(var h=0;h<e.length;h++)if(r=e[h],d.contains(r.bounds,i.position)&&l.canCollide(r.collisionFilter,t.collisionFilter))for(var c=r.parts.length>1?1:0;c<r.parts.length;c++){var u=r.parts[c];if(o.contains(u.vertices,i.position)){n.pointA=i.position,n.bodyB=t.body=r,n.pointB={x:i.position.x-r.position.x,y:i.position.y-r.position.y},n.angleB=r.angle,s.set(r,!1),a.trigger(t,"startdrag",{mouse:i,body:r});break}}}else n.bodyB=t.body=null,n.pointB=null,r&&a.trigger(t,"enddrag",{mouse:i,body:r})},n._triggerEvents=function(t){var e=t.mouse,i=e.sourceEvents;i.mousemove&&a.trigger(t,"mousemove",{mouse:e}),i.mousedown&&a.trigger(t,"mousedown",{mouse:e}),i.mouseup&&a.trigger(t,"mouseup",{mouse:e}),r.clearSourceEvents(e)}},function(t,e,i){var n={};t.exports=n;var o=i(2),s=i(8),r=i(1),a=i(12),l=i(3);n.collides=function(t,e){for(var i=[],n=e.length,o=t.bounds,a=s.collides,l=r.overlaps,h=0;h<n;h++){var c=e[h],u=c.parts.length,d=1===u?0:1;if(l(c.bounds,o))for(var p=d;p<u;p++){var m=c.parts[p];if(l(m.bounds,o)){var g=a(m,t);if(g){i.push(g);break}}}}return i},n.ray=function(t,e,i,s){s=s||1e-100;for(var r=o.angle(e,i),l=o.magnitude(o.sub(e,i)),h=.5*(i.x+e.x),c=.5*(i.y+e.y),u=a.rectangle(h,c,l,s,{angle:r}),d=n.collides(u,t),p=0;p<d.length;p+=1){var m=d[p];m.body=m.bodyB=m.bodyA}return d},n.region=function(t,e,i){for(var n=[],o=0;o<t.length;o++){var s=t[o],a=r.overlaps(s.bounds,e);(a&&!i||!a&&i)&&n.push(s)}return n},n.point=function(t,e){for(var i=[],n=0;n<t.length;n++){var o=t[n];if(r.contains(o.bounds,e))for(var s=1===o.parts.length?0:1;s<o.parts.length;s++){var a=o.parts[s];if(r.contains(a.bounds,e)&&l.contains(a.vertices,e)){i.push(o);break}}}return i}},function(t,e,i){var n={};t.exports=n;var o=i(4),s=i(0),r=i(6),a=i(1),l=i(5),h=i(2),c=i(14);!function(){var t,e;"undefined"!=typeof window&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout((function(){t(s.now())}),1e3/60)},e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),n._goodFps=30,n._goodDelta=1e3/60,n.create=function(t){var e={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!t.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},i=s.extend(e,t);return i.canvas&&(i.canvas.width=i.options.width||i.canvas.width,i.canvas.height=i.options.height||i.canvas.height),i.mouse=t.mouse,i.engine=t.engine,i.canvas=i.canvas||d(i.options.width,i.options.height),i.context=i.canvas.getContext("2d"),i.textures={},i.bounds=i.bounds||{min:{x:0,y:0},max:{x:i.canvas.width,y:i.canvas.height}},i.controller=n,i.options.showBroadphase=!1,1!==i.options.pixelRatio&&n.setPixelRatio(i,i.options.pixelRatio),s.isElement(i.element)&&i.element.appendChild(i.canvas),i},n.run=function(e){!function o(s){e.frameRequestId=t(o),i(e,s),n.world(e,s),(e.options.showStats||e.options.showDebug)&&n.stats(e,e.context,s),(e.options.showPerformance||e.options.showDebug)&&n.performance(e,e.context,s)}()},n.stop=function(t){e(t.frameRequestId)},n.setPixelRatio=function(t,e){var i=t.options,n=t.canvas;"auto"===e&&(e=p(n)),i.pixelRatio=e,n.setAttribute("data-pixel-ratio",e),n.width=i.width*e,n.height=i.height*e,n.style.width=i.width+"px",n.style.height=i.height+"px"},n.lookAt=function(t,e,i,n){n=void 0===n||n,e=s.isArray(e)?e:[e],i=i||{x:0,y:0};for(var o={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},r=0;r<e.length;r+=1){var a=e[r],l=a.bounds?a.bounds.min:a.min||a.position||a,h=a.bounds?a.bounds.max:a.max||a.position||a;l&&h&&(l.x<o.min.x&&(o.min.x=l.x),h.x>o.max.x&&(o.max.x=h.x),l.y<o.min.y&&(o.min.y=l.y),h.y>o.max.y&&(o.max.y=h.y))}var u=o.max.x-o.min.x+2*i.x,d=o.max.y-o.min.y+2*i.y,p=t.canvas.height,m=t.canvas.width/p,g=u/d,f=1,y=1;g>m?y=g/m:f=m/g,t.options.hasBounds=!0,t.bounds.min.x=o.min.x,t.bounds.max.x=o.min.x+u*f,t.bounds.min.y=o.min.y,t.bounds.max.y=o.min.y+d*y,n&&(t.bounds.min.x+=.5*u-u*f*.5,t.bounds.max.x+=.5*u-u*f*.5,t.bounds.min.y+=.5*d-d*y*.5,t.bounds.max.y+=.5*d-d*y*.5),t.bounds.min.x-=i.x,t.bounds.max.x-=i.x,t.bounds.min.y-=i.y,t.bounds.max.y-=i.y,t.mouse&&(c.setScale(t.mouse,{x:(t.bounds.max.x-t.bounds.min.x)/t.canvas.width,y:(t.bounds.max.y-t.bounds.min.y)/t.canvas.height}),c.setOffset(t.mouse,t.bounds.min))},n.startViewTransform=function(t){var e=t.bounds.max.x-t.bounds.min.x,i=t.bounds.max.y-t.bounds.min.y,n=e/t.options.width,o=i/t.options.height;t.context.setTransform(t.options.pixelRatio/n,0,0,t.options.pixelRatio/o,0,0),t.context.translate(-t.bounds.min.x,-t.bounds.min.y)},n.endViewTransform=function(t){t.context.setTransform(t.options.pixelRatio,0,0,t.options.pixelRatio,0,0)},n.world=function(t,e){var i,o=s.now(),u=t.engine,d=u.world,p=t.canvas,m=t.context,f=t.options,y=t.timing,_=r.allBodies(d),v=r.allConstraints(d),b=f.wireframes?f.wireframeBackground:f.background,x=[],w=[],S={timestamp:u.timing.timestamp};if(l.trigger(t,"beforeRender",S),t.currentBackground!==b&&g(t,b),m.globalCompositeOperation="source-in",m.fillStyle="transparent",m.fillRect(0,0,p.width,p.height),m.globalCompositeOperation="source-over",f.hasBounds){for(i=0;i<_.length;i++){var A=_[i];a.overlaps(A.bounds,t.bounds)&&x.push(A)}for(i=0;i<v.length;i++){var P=v[i],T=P.bodyA,B=P.bodyB,C=P.pointA,I=P.pointB;T&&(C=h.add(T.position,P.pointA)),B&&(I=h.add(B.position,P.pointB)),C&&I&&(a.contains(t.bounds,C)||a.contains(t.bounds,I))&&w.push(P)}n.startViewTransform(t),t.mouse&&(c.setScale(t.mouse,{x:(t.bounds.max.x-t.bounds.min.x)/t.options.width,y:(t.bounds.max.y-t.bounds.min.y)/t.options.height}),c.setOffset(t.mouse,t.bounds.min))}else w=v,x=_,1!==t.options.pixelRatio&&t.context.setTransform(t.options.pixelRatio,0,0,t.options.pixelRatio,0,0);!f.wireframes||u.enableSleeping&&f.showSleeping?n.bodies(t,x,m):(f.showConvexHulls&&n.bodyConvexHulls(t,x,m),n.bodyWireframes(t,x,m)),f.showBounds&&n.bodyBounds(t,x,m),(f.showAxes||f.showAngleIndicator)&&n.bodyAxes(t,x,m),f.showPositions&&n.bodyPositions(t,x,m),f.showVelocity&&n.bodyVelocity(t,x,m),f.showIds&&n.bodyIds(t,x,m),f.showSeparations&&n.separations(t,u.pairs.list,m),f.showCollisions&&n.collisions(t,u.pairs.list,m),f.showVertexNumbers&&n.vertexNumbers(t,x,m),f.showMousePosition&&n.mousePosition(t,t.mouse,m),n.constraints(w,m),f.hasBounds&&n.endViewTransform(t),l.trigger(t,"afterRender",S),y.lastElapsed=s.now()-o},n.stats=function(t,e,i){for(var n=t.engine,o=n.world,s=r.allBodies(o),a=0,l=0,h=0;h<s.length;h+=1)a+=s[h].parts.length;var c={Part:a,Body:s.length,Cons:r.allConstraints(o).length,Comp:r.allComposites(o).length,Pair:n.pairs.list.length};for(var u in e.fillStyle="#0e0f19",e.fillRect(l,0,302.5,44),e.font="12px Arial",e.textBaseline="top",e.textAlign="right",c){var d=c[u];e.fillStyle="#aaa",e.fillText(u,l+55,8),e.fillStyle="#eee",e.fillText(d,l+55,26),l+=55}},n.performance=function(t,e){var i=t.engine,o=t.timing,s=o.deltaHistory,r=o.elapsedHistory,a=o.timestampElapsedHistory,l=o.engineDeltaHistory,h=o.engineElapsedHistory,c=i.timing.lastDelta,d=u(s),p=u(r),m=u(l),g=u(h),f=u(a)/d||0,y=1e3/d||0;e.fillStyle="#0e0f19",e.fillRect(0,50,370,34),n.status(e,10,69,60,4,s.length,Math.round(y)+" fps",y/n._goodFps,(function(t){return s[t]/d-1})),n.status(e,82,69,60,4,l.length,c.toFixed(2)+" dt",n._goodDelta/c,(function(t){return l[t]/m-1})),n.status(e,154,69,60,4,h.length,g.toFixed(2)+" ut",1-g/n._goodFps,(function(t){return h[t]/g-1})),n.status(e,226,69,60,4,r.length,p.toFixed(2)+" rt",1-p/n._goodFps,(function(t){return r[t]/p-1})),n.status(e,298,69,60,4,a.length,f.toFixed(2)+" x",f*f*f,(function(t){return(a[t]/s[t]/f||0)-1}))},n.status=function(t,e,i,n,o,r,a,l,h){t.strokeStyle="#888",t.fillStyle="#444",t.lineWidth=1,t.fillRect(e,i+7,n,1),t.beginPath(),t.moveTo(e,i+7-o*s.clamp(.4*h(0),-2,2));for(var c=0;c<n;c+=1)t.lineTo(e+c,i+7-(c<r?o*s.clamp(.4*h(c),-2,2):0));t.stroke(),t.fillStyle="hsl("+s.clamp(25+95*l,0,120)+",100%,60%)",t.fillRect(e,i-7,4,4),t.font="12px Arial",t.textBaseline="middle",t.textAlign="right",t.fillStyle="#eee",t.fillText(a,e+n,i-5)},n.constraints=function(t,e){for(var i=e,n=0;n<t.length;n++){var o=t[n];if(o.render.visible&&o.pointA&&o.pointB){var r,a,l=o.bodyA,c=o.bodyB;if(r=l?h.add(l.position,o.pointA):o.pointA,"pin"===o.render.type)i.beginPath(),i.arc(r.x,r.y,3,0,2*Math.PI),i.closePath();else{if(a=c?h.add(c.position,o.pointB):o.pointB,i.beginPath(),i.moveTo(r.x,r.y),"spring"===o.render.type)for(var u,d=h.sub(a,r),p=h.perp(h.normalise(d)),m=Math.ceil(s.clamp(o.length/5,12,20)),g=1;g<m;g+=1)u=g%2==0?1:-1,i.lineTo(r.x+d.x*(g/m)+p.x*u*4,r.y+d.y*(g/m)+p.y*u*4);i.lineTo(a.x,a.y)}o.render.lineWidth&&(i.lineWidth=o.render.lineWidth,i.strokeStyle=o.render.strokeStyle,i.stroke()),o.render.anchors&&(i.fillStyle=o.render.strokeStyle,i.beginPath(),i.arc(r.x,r.y,3,0,2*Math.PI),i.arc(a.x,a.y,3,0,2*Math.PI),i.closePath(),i.fill())}}},n.bodies=function(t,e,i){var n,o,s,r,a=i,l=(t.engine,t.options),h=l.showInternalEdges||!l.wireframes;for(s=0;s<e.length;s++)if((n=e[s]).render.visible)for(r=n.parts.length>1?1:0;r<n.parts.length;r++)if((o=n.parts[r]).render.visible){if(l.showSleeping&&n.isSleeping?a.globalAlpha=.5*o.render.opacity:1!==o.render.opacity&&(a.globalAlpha=o.render.opacity),o.render.sprite&&o.render.sprite.texture&&!l.wireframes){var c=o.render.sprite,u=m(t,c.texture);a.translate(o.position.x,o.position.y),a.rotate(o.angle),a.drawImage(u,u.width*-c.xOffset*c.xScale,u.height*-c.yOffset*c.yScale,u.width*c.xScale,u.height*c.yScale),a.rotate(-o.angle),a.translate(-o.position.x,-o.position.y)}else{if(o.circleRadius)a.beginPath(),a.arc(o.position.x,o.position.y,o.circleRadius,0,2*Math.PI);else{a.beginPath(),a.moveTo(o.vertices[0].x,o.vertices[0].y);for(var d=1;d<o.vertices.length;d++)!o.vertices[d-1].isInternal||h?a.lineTo(o.vertices[d].x,o.vertices[d].y):a.moveTo(o.vertices[d].x,o.vertices[d].y),o.vertices[d].isInternal&&!h&&a.moveTo(o.vertices[(d+1)%o.vertices.length].x,o.vertices[(d+1)%o.vertices.length].y);a.lineTo(o.vertices[0].x,o.vertices[0].y),a.closePath()}l.wireframes?(a.lineWidth=1,a.strokeStyle="#bbb",a.stroke()):(a.fillStyle=o.render.fillStyle,o.render.lineWidth&&(a.lineWidth=o.render.lineWidth,a.strokeStyle=o.render.strokeStyle,a.stroke()),a.fill())}a.globalAlpha=1}},n.bodyWireframes=function(t,e,i){var n,o,s,r,a,l=i,h=t.options.showInternalEdges;for(l.beginPath(),s=0;s<e.length;s++)if((n=e[s]).render.visible)for(a=n.parts.length>1?1:0;a<n.parts.length;a++){for(o=n.parts[a],l.moveTo(o.vertices[0].x,o.vertices[0].y),r=1;r<o.vertices.length;r++)!o.vertices[r-1].isInternal||h?l.lineTo(o.vertices[r].x,o.vertices[r].y):l.moveTo(o.vertices[r].x,o.vertices[r].y),o.vertices[r].isInternal&&!h&&l.moveTo(o.vertices[(r+1)%o.vertices.length].x,o.vertices[(r+1)%o.vertices.length].y);l.lineTo(o.vertices[0].x,o.vertices[0].y)}l.lineWidth=1,l.strokeStyle="#bbb",l.stroke()},n.bodyConvexHulls=function(t,e,i){var n,o,s,r=i;for(r.beginPath(),o=0;o<e.length;o++)if((n=e[o]).render.visible&&1!==n.parts.length){for(r.moveTo(n.vertices[0].x,n.vertices[0].y),s=1;s<n.vertices.length;s++)r.lineTo(n.vertices[s].x,n.vertices[s].y);r.lineTo(n.vertices[0].x,n.vertices[0].y)}r.lineWidth=1,r.strokeStyle="rgba(255,255,255,0.2)",r.stroke()},n.vertexNumbers=function(t,e,i){var n,o,s,r=i;for(n=0;n<e.length;n++){var a=e[n].parts;for(s=a.length>1?1:0;s<a.length;s++){var l=a[s];for(o=0;o<l.vertices.length;o++)r.fillStyle="rgba(255,255,255,0.2)",r.fillText(n+"_"+o,l.position.x+.8*(l.vertices[o].x-l.position.x),l.position.y+.8*(l.vertices[o].y-l.position.y))}}},n.mousePosition=function(t,e,i){var n=i;n.fillStyle="rgba(255,255,255,0.8)",n.fillText(e.position.x+"  "+e.position.y,e.position.x+5,e.position.y-5)},n.bodyBounds=function(t,e,i){var n=i,o=(t.engine,t.options);n.beginPath();for(var s=0;s<e.length;s++)if(e[s].render.visible)for(var r=e[s].parts,a=r.length>1?1:0;a<r.length;a++){var l=r[a];n.rect(l.bounds.min.x,l.bounds.min.y,l.bounds.max.x-l.bounds.min.x,l.bounds.max.y-l.bounds.min.y)}o.wireframes?n.strokeStyle="rgba(255,255,255,0.08)":n.strokeStyle="rgba(0,0,0,0.1)",n.lineWidth=1,n.stroke()},n.bodyAxes=function(t,e,i){var n,o,s,r,a=i,l=(t.engine,t.options);for(a.beginPath(),o=0;o<e.length;o++){var h=e[o],c=h.parts;if(h.render.visible)if(l.showAxes)for(s=c.length>1?1:0;s<c.length;s++)for(n=c[s],r=0;r<n.axes.length;r++){var u=n.axes[r];a.moveTo(n.position.x,n.position.y),a.lineTo(n.position.x+20*u.x,n.position.y+20*u.y)}else for(s=c.length>1?1:0;s<c.length;s++)for(n=c[s],r=0;r<n.axes.length;r++)a.moveTo(n.position.x,n.position.y),a.lineTo((n.vertices[0].x+n.vertices[n.vertices.length-1].x)/2,(n.vertices[0].y+n.vertices[n.vertices.length-1].y)/2)}l.wireframes?(a.strokeStyle="indianred",a.lineWidth=1):(a.strokeStyle="rgba(255, 255, 255, 0.4)",a.globalCompositeOperation="overlay",a.lineWidth=2),a.stroke(),a.globalCompositeOperation="source-over"},n.bodyPositions=function(t,e,i){var n,o,s,r,a=i,l=(t.engine,t.options);for(a.beginPath(),s=0;s<e.length;s++)if((n=e[s]).render.visible)for(r=0;r<n.parts.length;r++)o=n.parts[r],a.arc(o.position.x,o.position.y,3,0,2*Math.PI,!1),a.closePath();for(l.wireframes?a.fillStyle="indianred":a.fillStyle="rgba(0,0,0,0.5)",a.fill(),a.beginPath(),s=0;s<e.length;s++)(n=e[s]).render.visible&&(a.arc(n.positionPrev.x,n.positionPrev.y,2,0,2*Math.PI,!1),a.closePath());a.fillStyle="rgba(255,165,0,0.8)",a.fill()},n.bodyVelocity=function(t,e,i){var n=i;n.beginPath();for(var s=0;s<e.length;s++){var r=e[s];if(r.render.visible){var a=o.getVelocity(r);n.moveTo(r.position.x,r.position.y),n.lineTo(r.position.x+a.x,r.position.y+a.y)}}n.lineWidth=3,n.strokeStyle="cornflowerblue",n.stroke()},n.bodyIds=function(t,e,i){var n,o,s=i;for(n=0;n<e.length;n++)if(e[n].render.visible){var r=e[n].parts;for(o=r.length>1?1:0;o<r.length;o++){var a=r[o];s.font="12px Arial",s.fillStyle="rgba(255,255,255,0.5)",s.fillText(a.id,a.position.x+10,a.position.y-10)}}},n.collisions=function(t,e,i){var n,o,s,r,a=i,l=t.options;for(a.beginPath(),s=0;s<e.length;s++)if((n=e[s]).isActive)for(o=n.collision,r=0;r<n.activeContacts.length;r++){var h=n.activeContacts[r].vertex;a.rect(h.x-1.5,h.y-1.5,3.5,3.5)}for(l.wireframes?a.fillStyle="rgba(255,255,255,0.7)":a.fillStyle="orange",a.fill(),a.beginPath(),s=0;s<e.length;s++)if((n=e[s]).isActive&&(o=n.collision,n.activeContacts.length>0)){var c=n.activeContacts[0].vertex.x,u=n.activeContacts[0].vertex.y;2===n.activeContacts.length&&(c=(n.activeContacts[0].vertex.x+n.activeContacts[1].vertex.x)/2,u=(n.activeContacts[0].vertex.y+n.activeContacts[1].vertex.y)/2),o.bodyB===o.supports[0].body||!0===o.bodyA.isStatic?a.moveTo(c-8*o.normal.x,u-8*o.normal.y):a.moveTo(c+8*o.normal.x,u+8*o.normal.y),a.lineTo(c,u)}l.wireframes?a.strokeStyle="rgba(255,165,0,0.7)":a.strokeStyle="orange",a.lineWidth=1,a.stroke()},n.separations=function(t,e,i){var n,o,s,r,a,l=i,h=t.options;for(l.beginPath(),a=0;a<e.length;a++)if((n=e[a]).isActive){s=(o=n.collision).bodyA;var c=1;(r=o.bodyB).isStatic||s.isStatic||(c=.5),r.isStatic&&(c=0),l.moveTo(r.position.x,r.position.y),l.lineTo(r.position.x-o.penetration.x*c,r.position.y-o.penetration.y*c),c=1,r.isStatic||s.isStatic||(c=.5),s.isStatic&&(c=0),l.moveTo(s.position.x,s.position.y),l.lineTo(s.position.x+o.penetration.x*c,s.position.y+o.penetration.y*c)}h.wireframes?l.strokeStyle="rgba(255,165,0,0.5)":l.strokeStyle="orange",l.stroke()},n.inspector=function(t,e){t.engine;var i,n=t.selected,o=t.render,s=o.options;if(s.hasBounds){var r=o.bounds.max.x-o.bounds.min.x,a=o.bounds.max.y-o.bounds.min.y,l=r/o.options.width,h=a/o.options.height;e.scale(1/l,1/h),e.translate(-o.bounds.min.x,-o.bounds.min.y)}for(var c=0;c<n.length;c++){var u=n[c].data;switch(e.translate(.5,.5),e.lineWidth=1,e.strokeStyle="rgba(255,165,0,0.9)",e.setLineDash([1,2]),u.type){case"body":i=u.bounds,e.beginPath(),e.rect(Math.floor(i.min.x-3),Math.floor(i.min.y-3),Math.floor(i.max.x-i.min.x+6),Math.floor(i.max.y-i.min.y+6)),e.closePath(),e.stroke();break;case"constraint":var d=u.pointA;u.bodyA&&(d=u.pointB),e.beginPath(),e.arc(d.x,d.y,10,0,2*Math.PI),e.closePath(),e.stroke()}e.setLineDash([]),e.translate(-.5,-.5)}null!==t.selectStart&&(e.translate(.5,.5),e.lineWidth=1,e.strokeStyle="rgba(255,165,0,0.6)",e.fillStyle="rgba(255,165,0,0.1)",i=t.selectBounds,e.beginPath(),e.rect(Math.floor(i.min.x),Math.floor(i.min.y),Math.floor(i.max.x-i.min.x),Math.floor(i.max.y-i.min.y)),e.closePath(),e.stroke(),e.fill(),e.translate(-.5,-.5)),s.hasBounds&&e.setTransform(1,0,0,1,0,0)};var i=function(t,e){var i=t.engine,o=t.timing,s=o.historySize,r=i.timing.timestamp;o.delta=e-o.lastTime||n._goodDelta,o.lastTime=e,o.timestampElapsed=r-o.lastTimestamp||0,o.lastTimestamp=r,o.deltaHistory.unshift(o.delta),o.deltaHistory.length=Math.min(o.deltaHistory.length,s),o.engineDeltaHistory.unshift(i.timing.lastDelta),o.engineDeltaHistory.length=Math.min(o.engineDeltaHistory.length,s),o.timestampElapsedHistory.unshift(o.timestampElapsed),o.timestampElapsedHistory.length=Math.min(o.timestampElapsedHistory.length,s),o.engineElapsedHistory.unshift(i.timing.lastElapsed),o.engineElapsedHistory.length=Math.min(o.engineElapsedHistory.length,s),o.elapsedHistory.unshift(o.lastElapsed),o.elapsedHistory.length=Math.min(o.elapsedHistory.length,s)},u=function(t){for(var e=0,i=0;i<t.length;i+=1)e+=t[i];return e/t.length||0},d=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i.oncontextmenu=function(){return!1},i.onselectstart=function(){return!1},i},p=function(t){var e=t.getContext("2d");return(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)},m=function(t,e){var i=t.textures[e];return i||((i=t.textures[e]=new Image).src=e,i)},g=function(t,e){var i=e;/(jpg|gif|png)$/.test(e)&&(i="url("+e+")"),t.canvas.style.background=i,t.canvas.style.backgroundSize="contain",t.currentBackground=e}}()},function(t,e,i){var n={};t.exports=n;var o,s,r,a=i(5),l=i(17),h=i(0);"undefined"!=typeof window&&(o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,s=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),o||(o=function(t){r=setTimeout((function(){t(h.now())}),1e3/60)},s=function(){clearTimeout(r)}),n.create=function(t){var e=h.extend({fps:60,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,frameRequestId:null,isFixed:!1,enabled:!0},t);return e.delta=e.delta||1e3/e.fps,e.deltaMin=e.deltaMin||1e3/e.fps,e.deltaMax=e.deltaMax||1e3/(.5*e.fps),e.fps=1e3/e.delta,e},n.run=function(t,e){return void 0!==t.positionIterations&&(e=t,t=n.create()),function i(s){t.frameRequestId=o(i),s&&t.enabled&&n.tick(t,e,s)}(),t},n.tick=function(t,e,i){var n,o=e.timing;t.isFixed?n=t.delta:(n=i-t.timePrev||t.delta,t.timePrev=i,t.deltaHistory.push(n),t.deltaHistory=t.deltaHistory.slice(-t.deltaSampleSize),n=(n=(n=Math.min.apply(null,t.deltaHistory))<t.deltaMin?t.deltaMin:n)>t.deltaMax?t.deltaMax:n,t.delta=n);var s={timestamp:o.timestamp};a.trigger(t,"beforeTick",s),t.frameCounter+=1,i-t.counterTimestamp>=1e3&&(t.fps=t.frameCounter*((i-t.counterTimestamp)/1e3),t.counterTimestamp=i,t.frameCounter=0),a.trigger(t,"tick",s),a.trigger(t,"beforeUpdate",s),l.update(e,n),a.trigger(t,"afterUpdate",s),a.trigger(t,"afterTick",s)},n.stop=function(t){s(t.frameRequestId)},n.start=function(t,e){n.run(t,e)}},function(t,e,i){var n={};t.exports=n;var o=i(8),s=i(0).deprecated;n.collides=function(t,e){return o.collides(t,e)},s(n,"collides","SAT.collides âž¤ replaced by Collision.collides")},function(t,e,i){var n={};t.exports=n,i(1);var o=i(0);n.pathToVertices=function(t,e){"undefined"==typeof window||"SVGPathSeg"in window||o.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var i,s,r,a,l,h,c,u,d,p,m,g=[],f=0,y=0,_=0;e=e||15;var v=function(t,e,i){var n=i%2==1&&i>1;if(!d||t!=d.x||e!=d.y){d&&n?(p=d.x,m=d.y):(p=0,m=0);var o={x:p+t,y:m+e};!n&&d||(d=o),g.push(o),y=p+t,_=m+e}},b=function(t){var e=t.pathSegTypeAsLetter.toUpperCase();if("Z"!==e){switch(e){case"M":case"L":case"T":case"C":case"S":case"Q":y=t.x,_=t.y;break;case"H":y=t.x;break;case"V":_=t.y}v(y,_,t.pathSegType)}};for(n._svgPathToAbsolute(t),r=t.getTotalLength(),h=[],i=0;i<t.pathSegList.numberOfItems;i+=1)h.push(t.pathSegList.getItem(i));for(c=h.concat();f<r;){if((l=h[t.getPathSegAtLength(f)])!=u){for(;c.length&&c[0]!=l;)b(c.shift());u=l}switch(l.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":a=t.getPointAtLength(f),v(a.x,a.y,0)}f+=e}for(i=0,s=c.length;i<s;++i)b(c[i]);return g},n._svgPathToAbsolute=function(t){for(var e,i,n,o,s,r,a=t.pathSegList,l=0,h=0,c=a.numberOfItems,u=0;u<c;++u){var d=a.getItem(u),p=d.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(p))"x"in d&&(l=d.x),"y"in d&&(h=d.y);else switch("x1"in d&&(n=l+d.x1),"x2"in d&&(s=l+d.x2),"y1"in d&&(o=h+d.y1),"y2"in d&&(r=h+d.y2),"x"in d&&(l+=d.x),"y"in d&&(h+=d.y),p){case"m":a.replaceItem(t.createSVGPathSegMovetoAbs(l,h),u);break;case"l":a.replaceItem(t.createSVGPathSegLinetoAbs(l,h),u);break;case"h":a.replaceItem(t.createSVGPathSegLinetoHorizontalAbs(l),u);break;case"v":a.replaceItem(t.createSVGPathSegLinetoVerticalAbs(h),u);break;case"c":a.replaceItem(t.createSVGPathSegCurvetoCubicAbs(l,h,n,o,s,r),u);break;case"s":a.replaceItem(t.createSVGPathSegCurvetoCubicSmoothAbs(l,h,s,r),u);break;case"q":a.replaceItem(t.createSVGPathSegCurvetoQuadraticAbs(l,h,n,o),u);break;case"t":a.replaceItem(t.createSVGPathSegCurvetoQuadraticSmoothAbs(l,h),u);break;case"a":a.replaceItem(t.createSVGPathSegArcAbs(l,h,d.r1,d.r2,d.angle,d.largeArcFlag,d.sweepFlag),u);break;case"z":case"Z":l=e,h=i}"M"!=p&&"m"!=p||(e=l,i=h)}}},function(t,e,i){var n={};t.exports=n;var o=i(6);i(0),n.create=o.create,n.add=o.add,n.remove=o.remove,n.clear=o.clear,n.addComposite=o.addComposite,n.addBody=o.addBody,n.addConstraint=o.addConstraint}])},t.exports=n()},371:t=>{function e(t,e,i){i=i||0;var n,o,s,r,a,l,h,c=[0,0];return n=t[1][1]-t[0][1],o=t[0][0]-t[1][0],s=n*t[0][0]+o*t[0][1],r=e[1][1]-e[0][1],a=e[0][0]-e[1][0],l=r*e[0][0]+a*e[0][1],S(h=n*a-r*o,0,i)||(c[0]=(a*s-o*l)/h,c[1]=(n*l-r*s)/h),c}function i(t,e,i,n){var o=e[0]-t[0],s=e[1]-t[1],r=n[0]-i[0],a=n[1]-i[1];if(r*s-a*o==0)return!1;var l=(o*(i[1]-t[1])+s*(t[0]-i[0]))/(r*s-a*o),h=(r*(t[1]-i[1])+a*(i[0]-t[0]))/(a*o-r*s);return l>=0&&l<=1&&h>=0&&h<=1}function n(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])}function o(t,e,i){return n(t,e,i)>0}function s(t,e,i){return n(t,e,i)>=0}function r(t,e,i){return n(t,e,i)<0}function a(t,e,i){return n(t,e,i)<=0}t.exports={decomp:function(t){var e=b(t);return e.length>0?x(t,e):[t]},quickDecomp:function t(e,i,n,l,h,c,g){c=c||100,g=g||0,h=h||25,i=void 0!==i?i:[],n=n||[],l=l||[];var f=[0,0],y=[0,0],v=[0,0],b=0,x=0,S=0,A=0,P=0,T=0,B=0,C=[],I=[],M=e,L=e;if(L.length<3)return i;if(++g>c)return console.warn("quickDecomp: max level ("+c+") reached."),i;for(var E=0;E<e.length;++E)if(m(M,E)){n.push(M[E]),b=x=Number.MAX_VALUE;for(var R=0;R<e.length;++R)o(d(M,E-1),d(M,E),d(M,R))&&a(d(M,E-1),d(M,E),d(M,R-1))&&(v=w(d(M,E-1),d(M,E),d(M,R),d(M,R-1)),r(d(M,E+1),d(M,E),v)&&(S=u(M[E],v))<x&&(x=S,y=v,T=R)),o(d(M,E+1),d(M,E),d(M,R+1))&&a(d(M,E+1),d(M,E),d(M,R))&&(v=w(d(M,E+1),d(M,E),d(M,R),d(M,R+1)),o(d(M,E-1),d(M,E),v)&&(S=u(M[E],v))<b&&(b=S,f=v,P=R));if(T===(P+1)%e.length)v[0]=(y[0]+f[0])/2,v[1]=(y[1]+f[1])/2,l.push(v),E<P?(p(C,M,E,P+1),C.push(v),I.push(v),0!==T&&p(I,M,T,M.length),p(I,M,0,E+1)):(0!==E&&p(C,M,E,M.length),p(C,M,0,P+1),C.push(v),I.push(v),p(I,M,T,E+1));else{if(T>P&&(P+=e.length),A=Number.MAX_VALUE,P<T)return i;for(R=T;R<=P;++R)s(d(M,E-1),d(M,E),d(M,R))&&a(d(M,E+1),d(M,E),d(M,R))&&(S=u(d(M,E),d(M,R)))<A&&_(M,E,R)&&(A=S,B=R%e.length);E<B?(p(C,M,E,B+1),0!==B&&p(I,M,B,L.length),p(I,M,0,E+1)):(0!==E&&p(C,M,E,L.length),p(C,M,0,B+1),p(I,M,B,E+1))}return C.length<I.length?(t(C,i,n,l,h,c,g),t(I,i,n,l,h,c,g)):(t(I,i,n,l,h,c,g),t(C,i,n,l,h,c,g)),i}return i.push(e),i},isSimple:function(t){var e,n=t;for(e=0;e<n.length-1;e++)for(var o=0;o<e-1;o++)if(i(n[e],n[e+1],n[o],n[o+1]))return!1;for(e=1;e<n.length-2;e++)if(i(n[0],n[n.length-1],n[e],n[e+1]))return!1;return!0},removeCollinearPoints:function(t,e){for(var i=0,n=t.length-1;t.length>3&&n>=0;--n)c(d(t,n-1),d(t,n),d(t,n+1),e)&&(t.splice(n%t.length,1),i++);return i},removeDuplicatePoints:function(t,e){for(var i=t.length-1;i>=1;--i)for(var n=t[i],o=i-1;o>=0;--o)A(n,t[o],e)&&t.splice(i,1)},makeCCW:function(t){for(var e=0,i=t,n=1;n<t.length;++n)(i[n][1]<i[e][1]||i[n][1]===i[e][1]&&i[n][0]>i[e][0])&&(e=n);return!o(d(t,e-1),d(t,e),d(t,e+1))&&(function(t){for(var e=[],i=t.length,n=0;n!==i;n++)e.push(t.pop());for(n=0;n!==i;n++)t[n]=e[n]}(t),!0)}};var l=[],h=[];function c(t,e,i,o){if(o){var s=l,r=h;s[0]=e[0]-t[0],s[1]=e[1]-t[1],r[0]=i[0]-e[0],r[1]=i[1]-e[1];var a=s[0]*r[0]+s[1]*r[1],c=Math.sqrt(s[0]*s[0]+s[1]*s[1]),u=Math.sqrt(r[0]*r[0]+r[1]*r[1]);return Math.acos(a/(c*u))<o}return 0===n(t,e,i)}function u(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}function d(t,e){var i=t.length;return t[e<0?e%i+i:e%i]}function p(t,e,i,n){for(var o=i;o<n;o++)t.push(e[o])}function m(t,e){return r(d(t,e-1),d(t,e),d(t,e+1))}var g=[],f=[];function y(t,i,n){var o,r,l=g,h=f;if(s(d(t,i+1),d(t,i),d(t,n))&&a(d(t,i-1),d(t,i),d(t,n)))return!1;r=u(d(t,i),d(t,n));for(var c=0;c!==t.length;++c)if((c+1)%t.length!==i&&c!==i&&s(d(t,i),d(t,n),d(t,c+1))&&a(d(t,i),d(t,n),d(t,c))&&(l[0]=d(t,i),l[1]=d(t,n),h[0]=d(t,c),h[1]=d(t,c+1),o=e(l,h),u(d(t,i),o)<r))return!1;return!0}function _(t,e,n){for(var o=0;o!==t.length;++o)if(o!==e&&o!==n&&(o+1)%t.length!==e&&(o+1)%t.length!==n&&i(d(t,e),d(t,n),d(t,o),d(t,o+1)))return!1;return!0}function v(t,e,i,n){var o=n||[];if(function(t){t.length=0}(o),e<i)for(var s=e;s<=i;s++)o.push(t[s]);else{for(s=0;s<=i;s++)o.push(t[s]);for(s=e;s<t.length;s++)o.push(t[s])}return o}function b(t){for(var e=[],i=[],n=[],o=[],s=Number.MAX_VALUE,r=0;r<t.length;++r)if(m(t,r))for(var a=0;a<t.length;++a)if(y(t,r,a)){i=b(v(t,r,a,o)),n=b(v(t,a,r,o));for(var l=0;l<n.length;l++)i.push(n[l]);i.length<s&&(e=i,s=i.length,e.push([d(t,r),d(t,a)]))}return e}function x(t,e){if(0===e.length)return[t];if(e instanceof Array&&e.length&&e[0]instanceof Array&&2===e[0].length&&e[0][0]instanceof Array){for(var i=[t],n=0;n<e.length;n++)for(var o=e[n],s=0;s<i.length;s++){var r=x(i[s],o);if(r){i.splice(s,1),i.push(r[0],r[1]);break}}return i}return o=e,n=t.indexOf(o[0]),s=t.indexOf(o[1]),-1!==n&&-1!==s&&[v(t,n,s),v(t,s,n)]}function w(t,e,i,n,o){o=o||0;var s=e[1]-t[1],r=t[0]-e[0],a=s*t[0]+r*t[1],l=n[1]-i[1],h=i[0]-n[0],c=l*i[0]+h*i[1],u=s*h-l*r;return S(u,0,o)?[0,0]:[(h*a-r*c)/u,(s*c-l*a)/u]}function S(t,e,i){return i=i||0,Math.abs(t-e)<=i}function A(t,e,i){return S(t[0],e[0],i)&&S(t[1],e[1],i)}},692:function(t,e,i){var n;n=function(t){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/libs",i(i.s=1)}([function(e,i){e.exports=t},function(t,e,i){"use strict";var n=i(0),o={name:"matter-attractors",version:"0.1.4",for:"matter-js@^0.12.0",install:function(t){t.after("Body.create",(function(){o.Body.init(this)})),t.before("Engine.update",(function(t){o.Engine.update(t)}))},Body:{init:function(t){t.plugin.attractors=t.plugin.attractors||[]}},Engine:{update:function(t){for(var e=t.world,i=n.Composite.allBodies(e),o=0;o<i.length;o+=1){var s=i[o],r=s.plugin.attractors;if(r&&r.length>0)for(var a=o+1;a<i.length;a+=1)for(var l=i[a],h=0;h<r.length;h+=1){var c=r[h],u=c;n.Common.isFunction(c)&&(u=c(s,l)),u&&n.Body.applyForce(l,l.position,u)}}}},Attractors:{gravityConstant:.001,gravity:function(t,e){var i=n.Vector.sub(e.position,t.position),s=n.Vector.magnitudeSquared(i)||1e-4,r=n.Vector.normalise(i),a=-o.Attractors.gravityConstant*(t.mass*e.mass/s),l=n.Vector.mult(r,a);n.Body.applyForce(t,t.position,n.Vector.neg(l)),n.Body.applyForce(e,e.position,l)}}};n.Plugin.register(o),t.exports=o}])},t.exports=n(i(46))}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var s=e[n]={exports:{}};return t[n].call(s.exports,s,s.exports,i),s.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t,e;!function(t){t.None="",t.Loading="loading-page",t.Introduction="introduction-page",t.Game="game-page",t.Finished="finished-page"}(t||(t={}));class n{}e=n,n.FRAME_RATE=60,n.BALL_SIZE=40,n.GRAVITY=.75,n.FLIPPER_FORCE=.002666666*e.GRAVITY,n.MAX_SPEED=50*e.GRAVITY,n.LAUNCHER_SPACE=60,n.MIN_LAUNCH_SPEED=10*e.GRAVITY,n.MAX_LAUNCH_SPEED=50*e.GRAVITY,n.LAUNCH_PULL_TIME=1e3,n.MAX_BUMPS=3,n.BUMP_IMPULSE=4,n.BUMP_TIMEOUT=2e3,n.BALLS_PER_GAME=3,n.RETRY_TIMEOUT=4800,n.WINDMILL_DURATION=2500,n.MESSAGE_DURATION=2e3,n.TRIGGER_EXPIRY=5e3,n.SEQUENCE_REPEAT_WINDOW=3e3,n.IMAGES_PATH="./images",n.SOUNDS_PATH="./sounds";const o=new class{constructor(){this.m_loadingCount=0,this.m_loadedCount=0,this.BACKGROUND=this.loadImage(`${n.IMAGES_PATH}/background.png`),this.BALL=this.loadImage(`${n.IMAGES_PATH}/ball.png`),this.BATTERY_OFF=this.loadImage(`${n.IMAGES_PATH}/battery_off.png`),this.BATTERY_ON=this.loadImage(`${n.IMAGES_PATH}/battery_on.png`),this.BLUE_ARROW_OFF=this.loadImage(`${n.IMAGES_PATH}/blue_arrow_off.png`),this.BLUE_ARROW_ON=this.loadImage(`${n.IMAGES_PATH}/blue_arrow_on.png`),this.BOTTOM_LIGHT_OFF=this.loadImage(`${n.IMAGES_PATH}/bottom_light_off.png`),this.BOTTOM_LIGHT_ON=this.loadImage(`${n.IMAGES_PATH}/bottom_light_on.png`),this.BOTTOM_OVERLAY=this.loadImage(`${n.IMAGES_PATH}/bottom_overlay.png`),this.CAMERA_OFF=this.loadImage(`${n.IMAGES_PATH}/camera_off.png`),this.CAMERA_ON=this.loadImage(`${n.IMAGES_PATH}/camera_on.png`),this.FLAT_LEFT_OFF=this.loadImage(`${n.IMAGES_PATH}/flat_left_off.png`),this.FLAT_LEFT_ON=this.loadImage(`${n.IMAGES_PATH}/flat_left_on.png`),this.FLAT_RIGHT_OFF=this.loadImage(`${n.IMAGES_PATH}/flat_right_off.png`),this.FLAT_RIGHT_ON=this.loadImage(`${n.IMAGES_PATH}/flat_right_on.png`),this.HELMET_OFF=this.loadImage(`${n.IMAGES_PATH}/helmet_off.png`),this.HELMET_ON=this.loadImage(`${n.IMAGES_PATH}/helmet_on.png`),this.LAUNCHER=this.loadImage(`${n.IMAGES_PATH}/launcher.png`),this.LAUNCHER_TOP=this.loadImage(`${n.IMAGES_PATH}/launcher_top.png`),this.LEFT_BOTTOM_FLIPPER=this.loadImage(`${n.IMAGES_PATH}/left_bottom_flipper.png`),this.LEFT_TOP_FLIPPER=this.loadImage(`${n.IMAGES_PATH}/left_top_flipper.png`),this.POINTS_100_OFF=this.loadImage(`${n.IMAGES_PATH}/points_100_off.png`),this.POINTS_100_ON=this.loadImage(`${n.IMAGES_PATH}/points_100_on.png`),this.POINTS_50_OFF=this.loadImage(`${n.IMAGES_PATH}/points_50_off.png`),this.POINTS_50_ON=this.loadImage(`${n.IMAGES_PATH}/points_50_on.png`),this.POINTS_300_OFF=this.loadImage(`${n.IMAGES_PATH}/points_300_off.png`),this.POINTS_300_ON=this.loadImage(`${n.IMAGES_PATH}/points_300_on.png`),this.RIGHT_BOTTOM_FLIPPER=this.loadImage(`${n.IMAGES_PATH}/right_bottom_flipper.png`),this.RIGHT_TOP_FLIPPER=this.loadImage(`${n.IMAGES_PATH}/right_top_flipper.png`),this.TOP_LEFT_BUMPER_OFF=this.loadImage(`${n.IMAGES_PATH}/top_left_bumper_off.png`),this.TOP_LEFT_BUMPER_ON=this.loadImage(`${n.IMAGES_PATH}/top_left_bumper_on.png`),this.TOP_RIGHT_BUMPER_OFF=this.loadImage(`${n.IMAGES_PATH}/top_right_bumper_off.png`),this.TOP_RIGHT_BUMPER_ON=this.loadImage(`${n.IMAGES_PATH}/top_right_bumper_on.png`),this.TOWERS_OFF=this.loadImage(`${n.IMAGES_PATH}/towers_off.png`),this.TOWERS_ON=this.loadImage(`${n.IMAGES_PATH}/towers_on.png`),this.TUNNEL_TOP=this.loadImage(`${n.IMAGES_PATH}/tunnel_top.png`),this.WINDMILLS=this.loadImage(`${n.IMAGES_PATH}/windmills.png`),this.WINDMILLS_TOP=this.loadImage(`${n.IMAGES_PATH}/windmills_top.png`),this.YELLOW_ARROW_OFF=this.loadImage(`${n.IMAGES_PATH}/yellow_arrow_off.png`),this.YELLOW_ARROW_ON=this.loadImage(`${n.IMAGES_PATH}/yellow_arrow_on.png`),this.SPRITE_SHEET_10FPS=this.loadImage(`${n.IMAGES_PATH}/sprite_sheet_10fps.png`),this.SPRITE_SHEET_15FPS=this.loadImage(`${n.IMAGES_PATH}/sprite_sheet_15fps.png`)}doneLoading(){return this.m_loadedCount>=this.m_loadingCount}loadImage(t){const e=new Image;return this.m_loadingCount++,e.addEventListener("load",(()=>this.m_loadedCount++)),e.src=t,e}};var s;class r{constructor(){}static delay(t){return e=this,i=void 0,o=function*(){return new Promise((e=>setTimeout(e,t)))},new((n=void 0)||(n=Promise))((function(t,s){function r(t){try{l(o.next(t))}catch(t){s(t)}}function a(t){try{l(o.throw(t))}catch(t){s(t)}}function l(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(r,a)}l((o=o.apply(e,i||[])).next())}));var e,i,n,o}}!function(t){t[t.BallOut=0]="BallOut",t[t.Bump=1]="Bump",t[t.Bumper=2]="Bumper",t[t.Event=3]="Event",t[t.Flipper=4]="Flipper",t[t.Popper=5]="Popper",t[t.Trigger=6]="Trigger",t[t.Hit=7]="Hit",t[t.HitAlt=8]="HitAlt",t[t.Shoot=9]="Shoot",t[t.HitElectricity=10]="HitElectricity",t[t.Windmills=11]="Windmills",t[t.Lane=12]="Lane"}(s||(s={}));const a=new Map;function l(t){return t.replace(/[?!]/g,"")}function h(t){const e=t.toString();if(a.has(e))return a.get(e);const i="string"==typeof t?e:function(t){if(t.startsWith("class ")&&!t.startsWith("class =>"))return l(t.substring(6,t.indexOf(" {")));if(t.includes("=>"))return l(t.substring(t.indexOf(".")+1));const e=t.match(/function\s*\(\w+\)\s*\{[\r\n\s]*return\s+\w+\.((\w+\.)*(\w+))/i);if(e)return e[1];if(t.startsWith("function "))return l(t.substring(9,t.indexOf("(")));throw new Error("ts-simple-nameof: Invalid function.")}(e);return a.set(e,i),i}var c;!function(t){t[t.Android=0]="Android",t[t.iOS=1]="iOS",t[t.Other=2]="Other"}(c||(c={}));class u{static hasRoundRect(){try{const t=navigator.userAgent.toLowerCase();if(t.indexOf("safari")<0)return!1;const e=t.match(/version\/([0-9]+)\./)[1];return parseInt(e.split(".")[0])>=16}catch(t){return!1}}static getMobileOs(){const t=navigator.userAgent;return/android/i.test(t)?c.Android:/iPad|iPhone|iPod/.test(t)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1?c.iOS:c.Other}}const d=new Map([[s.BallOut,"sfx_ball_out.mp3"],[s.Flipper,"sfx_flipper.mp3"],[s.Hit,"sfx_hit.mp3"],[s.HitAlt,"sfx_hit_alt.mp3"],[s.Shoot,"sfx_shoot.mp3"],[s.HitElectricity,"sfx_hit_electricity.mp3"],[s.Windmills,"sfx_windmills.mp3"],[s.Lane,"sfx_lane.mp3"]]);class p{constructor(t){this.m_soundMap=new Map,this.m_mainData=t,u.getMobileOs()!=c.iOS&&this.m_mainData.addPropertyChangeListener(h((t=>t.muteSounds)),(()=>this.handleMuteSoundsChanges()))}initialize(){u.getMobileOs()!=c.iOS&&(this.m_audioContext||(this.setupWebAudioAPI(),this.load()))}play(t){if(u.getMobileOs()==c.iOS)return;if(this.m_mainData.muteSounds)return;if(!this.m_soundMap.has(t))return;const e=this.m_soundMap.get(t);e&&this.playAudioElement(e)}handleMuteSoundsChanges(){this.m_mainData.muteSounds||this.load()}setupWebAudioAPI(){const t=window.AudioContext||window.webkitAudioContext;void 0!==t&&(this.m_audioContext=new t,this.m_masterBus=this.m_audioContext.createGain(),this.m_masterBus.connect(this.m_audioContext.destination))}createAudioElement(t,e=!1,i){const n=document.createElement("audio");return n.crossOrigin="anonymous",n.setAttribute("src",t),e&&n.setAttribute("loop","loop"),i&&this.m_audioContext.createMediaElementSource(n).connect(i),n}load(){this.m_soundMap.size>0||d.forEach(((t,e)=>{this.m_soundMap.set(e,this.createAudioElement(`${n.SOUNDS_PATH}/${t}`,!1,this.m_masterBus))}))}playAudioElement(t){t.currentTime>0&&!t.ended||(t.currentTime=0,!t.paused||t.currentTime?t.currentTime=0:t.play().then((()=>{})).catch((()=>{})))}}var m;!function(t){t[t.None=0]="None",t[t.TopBumper=1]="TopBumper",t[t.TopLeftBumper=2]="TopLeftBumper",t[t.TopRightBumper=3]="TopRightBumper",t[t.BatteryBumper=4]="BatteryBumper",t[t.HelmetBumper=5]="HelmetBumper",t[t.Windmills=6]="Windmills",t[t.TopLane=7]="TopLane",t[t.InnerLane=8]="InnerLane",t[t.OuterLane=9]="OuterLane"}(m||(m={}));var g=function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))};class f{constructor(){this.m_score=0}loadHighscore(){return g(this,void 0,void 0,(function*(){return this.m_score}))}saveScore(t){return g(this,void 0,void 0,(function*(){return this.m_score=Math.max(t,this.m_score),this.m_score}))}processResponse(t){return g(this,void 0,void 0,(function*(){const e=yield t.json();return e.success?e.highscore:(console.error("Error loading highscore: "+e.message),0)}))}}const y=new Map([[m.BatteryBumper,100],[m.HelmetBumper,100],[m.Windmills,300],[m.TopLeftBumper,50],[m.TopRightBumper,50],[m.TopBumper,10],[m.TopLane,10],[m.InnerLane,10],[m.OuterLane,25]]);class _{constructor(t){this.m_mainData=t,this.m_soundService=new p(t),this.m_scoreService=new f}start(){return e=this,i=void 0,s=function*(){for(;!o.doneLoading();)yield r.delay(100);this.m_mainData.highscore=yield this.m_scoreService.loadHighscore(),this.m_mainData.page=t.Introduction},new((n=void 0)||(n=Promise))((function(t,o){function r(t){try{l(s.next(t))}catch(t){o(t)}}function a(t){try{l(s.throw(t))}catch(t){o(t)}}function l(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(r,a)}l((s=s.apply(e,i||[])).next())}));var e,i,n,s}startGame(){this.m_mainData.lock(),this.m_mainData.page=t.Game,this.m_mainData.score=0,this.m_mainData.ballCount=n.BALLS_PER_GAME,this.m_mainData.unlock(),this.m_soundService.initialize()}showMessage(t){this.m_mainData.message=t}setPaused(t){this.m_mainData.paused=t}setOutlines(t){this.m_mainData.outlines=t}setWindmills(t){this.m_mainData.windmills=t}gameOver(){this.m_mainData.score>this.m_mainData.highscore&&(this.m_mainData.highscore=this.m_mainData.score),this.m_mainData.page=t.Introduction}playSound(t){this.m_soundService.play(t)}toggleSound(){this.m_mainData.muteSounds=!this.m_mainData.muteSounds}addScore(t){switch(this.m_mainData.lock(),this.m_mainData.score+=y.get(t),t){case m.BatteryBumper:this.m_mainData.batteryScoreCount++;break;case m.Windmills:this.m_mainData.windmillScoreCount++;break;case m.HelmetBumper:this.m_mainData.helmetScoreCount++;break;case m.TopLeftBumper:this.m_mainData.topLeftBumperScoreCount++;break;case m.TopRightBumper:this.m_mainData.topRightBumperScoreCount++}this.m_mainData.unlock()}setFreeBall(t){this.m_mainData.freeBall=t}setUsedFreeBall(t){this.m_mainData.lock(),this.m_mainData.usedFreeBall=t,this.m_mainData.freeBall=!t,this.m_mainData.unlock()}decreaseBallCount(){this.m_mainData.ballCount>0&&this.m_mainData.ballCount--}}var v;!function(t){t[t.None=0]="None",t[t.Multiplier=1]="Multiplier",t[t.MultiBall=2]="MultiBall",t[t.Loop=3]="Loop",t[t.GroupComplete=4]="GroupComplete",t[t.TrickShot=5]="TrickShot",t[t.EscapeBonus=6]="EscapeBonus",t[t.GotLucky=7]="GotLucky",t[t.TryAgain=8]="TryAgain",t[t.Tilt=9]="Tilt"}(v||(v={}));const b=[0,31,28,31,30,31,30,31,31,30,31,30,31],x=/\d+/;class w{constructor(){}static isNonEmptyText(t){return!!t&&t.toString().trim().length>0}static isNumber(t){return!isNaN(t)}static isInteger(t){return/^\s*(\+|-)?\d+\s*$/.test(t.toString())}static isEmail(t){return/(\w|[_.\-])+@((\w|-)+\.)+\w{2,32}/.test(t.toString())}static isZipCodeDutch(t){return/\d\d\d\d\s?[A-Za-z][A-Za-z]/.test(t.toString())}static isCityName(t){return/[A-Za-z\-\s'"\.]+/.test(t.toString())}static isArray(t){return Array.isArray(t)}static createRegExp(t){return e=>t.test(e.toString())}createTextLength(t,e=Number.MAX_VALUE){return i=>{const n=i.toString().length;return n>=t&&n<=e}}createNumberRange(t,e=Number.MAX_VALUE){return i=>{if(!w.isNumber(i))return!1;const n=parseFloat(i+"");return n>=t&&n<=e}}createIntegerRange(t,e=Number.MAX_VALUE){return i=>{if(!w.isInteger(i))return!1;const n=parseInt(i+"",10);return n>=t&&n<=e}}createArrayRange(t,e=Number.MAX_VALUE){return i=>!!w.isArray(i)&&i.length>=t&&i.length<=e}static createBoolean(t){return e=>e===t}static createAnotherProperty(t,e){return()=>e.isValidPropertyValue(t,e.getPropertyValue(t))}static createEqualToProperty(t,e){return i=>i===e.getPropertyValue(t)}static createOptional(t){return e=>!e||!e.toString().length||w.isValidValue(e,t)}createDay(t,e,i){return n=>{const o=n+"";if(!x.test(o))return!1;const s=parseInt(o,10);if(s<1||s>31)return!1;let r=31;const a=i.getPropertyValue(e).toString(),l=i.getPropertyValue(t).toString();if(x.test(l)&&x.test(a)){const t=parseInt(a,10),e=parseInt(l,10);e>1&&e<13&&(r=b[e],2===e&&(t%400==0||t%100!=0&&t%4==0)&&(r=29))}return s<=r}}static isValidValue(t,e){return"function"==typeof e?e(t):!e.hasOwnProperty("isValidValue")||"function"!=typeof e.isValidValue||e.isValidValue(t)}static isValidProperty(t,e,i,n){return void 0===n&&(n=t.getPropertyValue(e)),"function"==typeof i?i(n):i.hasOwnProperty("isValidPropertyValue")&&"function"==typeof i.isValidPropertyValue?i.isValidPropertyValue(e,t,n):"function"!=typeof i.isValidValue||i.isValidValue(n)}}class S{constructor(){this.m_map=new Map}add(t,e){this.m_map.has(t)||this.m_map.set(t,new Set),this.m_map.get(t).add(e)}remove(t,e){if(this.m_map.has(t)){const i=this.m_map.get(t);i.delete(e),0===i.size&&this.m_map.delete(t)}}removeValue(t){const e=this.findKey(t);e&&this.remove(e,t)}clear(){this.m_map.clear()}get(t){if(this.m_map.has(t)){const e=this.m_map.get(t);return Array.from(e)}return[]}getKeys(){return Array.from(this.m_map.keys())}has(t){return this.m_map.has(t)}hasValue(t,e){return this.m_map.has(t)&&this.m_map.get(t).has(e)}isEmpty(){return 0===this.m_map.size}findKey(t){for(const e of this.m_map.keys())if(this.hasValue(e,t))return e;return null}get keyCount(){return this.m_map.size}get valueTotalCount(){let t=0;return this.m_map.forEach((e=>t+=e.size)),t}}class A{constructor(){this.validators=[]}}class P{constructor(){this.m_lockCount=0,this.m_changedList=new Set,this.m_dirtyList=new Set,this.m_listeners=new Set,this.m_propertyMetaData={},this.m_propertyListeners=new S}lock(){return this.m_lockCount++,this.m_lockCount}unlock(){if(this.m_lockCount--,0===this.m_lockCount&&this.m_changedList.size>0){const t=Array.from(this.m_changedList);this.m_changedList.clear(),this.onPropertiesChanged(t)}return this.m_lockCount}addChangeListener(t){return this.m_listeners.add(t),()=>this.removeChangeListener(t)}removeChangeListener(t){this.m_listeners.delete(t)}addPropertyChangeListener(t,e){return this.m_propertyListeners.add(t,e),()=>this.removePropertyChangeListener(t,e)}removePropertyChangeListener(t,e){this.m_propertyListeners.remove(t,e)}hasChanged(){return this.m_changedList.size>0}isDirty(){return this.m_dirtyList.size>0}getDirtyProperties(){return Array.from(this.m_dirtyList)}clearDirty(){this.m_dirtyList.clear()}isValidPropertyValue(t,e){return!this.hasPropertyMetaData(t)||this.getPropertyMetaData(t).validators.every((i=>w.isValidProperty(this,t,i,e)))}getPropertyValue(t){return"function"==typeof this[t]?this[t]():this[t]}setPropertyValue(t,e){"function"==typeof this[t]?this[t](e):this[t]!==e&&(this.lock(),this[t]=e,this.changed(t),this.unlock())}processPropertyValue(t,e,i,n,o,s){return void 0===i||(o&&(i=o(i)),s?s(e,i):e===i)?e:(n(i),this.changed(t),i)}addValidation(t,e){this.getPropertyMetaData(t).validators.push(e)}changed(...t){t.forEach((t=>this.m_dirtyList.add(t))),this.m_lockCount>0?t.forEach((t=>this.m_changedList.add(t))):this.onPropertiesChanged(t)}onPropertiesChanged(t){[...this.m_listeners].forEach((e=>e(this,t))),t.forEach((t=>this.callPropertyListeners(t)))}getPropertyMetaData(t){const e=this.m_propertyMetaData[t]||new A;return this.m_propertyMetaData[t]=e,e}hasPropertyMetaData(t){return this.m_propertyMetaData.hasOwnProperty(t)}callPropertyListeners(t){this.m_propertyListeners.get(t).forEach((e=>e(this,t)))}}class T extends P{setValueInStorage(t,e){window.localStorage.setItem(t,e)}getValueFromStorage(t,e){var i;return null!==(i=window.localStorage.getItem(t))&&void 0!==i?i:e}setStoredStringProperty(t,e,i){this.processPropertyValue(t,this.getValueFromStorage(e,""),i,(t=>this.setValueInStorage(e,i)))}getStoredStringProperty(t,e){return this.getValueFromStorage(t,e)}setStoredBoolProperty(t,e,i){this.setStoredStringProperty(t,e,i?"1":"0")}getStoredBoolProperty(t,e){return"1"===this.getStoredStringProperty(t,e?"1":"0")}setStoredIntegerProperty(t,e,i){this.setStoredStringProperty(t,e,i.toString())}getStoredIntegerProperty(t,e){return parseInt(this.getStoredStringProperty(t,e.toString()))}setStoredFloatProperty(t,e,i){this.setStoredStringProperty(t,e,i.toString())}getStoredFloatProperty(t,e){return parseFloat(this.getStoredStringProperty(t,e.toString()))}}const B="pinball_mute_sounds";class C extends T{constructor(){super(...arguments),this.m_page=t.None,this.m_ballCount=n.BALLS_PER_GAME,this.m_score=0,this.m_multiplier=1,this.m_message=v.None,this.m_paused=!1,this.m_outlines=!1,this.m_windmills=!1,this.m_windmillScoreCount=0,this.m_topLeftBumperScoreCount=0,this.m_topRightBumperScoreCount=0,this.m_batteryScoreCount=0,this.m_helmetScoreCount=0,this.m_freeBall=!0,this.m_usedFreeBall=!1,this.m_highscore=0}get page(){return this.m_page}set page(t){this.processPropertyValue(h((t=>t.page)),this.m_page,t,(t=>this.m_page=t))}get message(){return this.m_message}set message(t){this.processPropertyValue(h((t=>t.message)),this.m_message,t,(t=>this.m_message=t))}get score(){return this.m_score}set score(t){this.processPropertyValue(h((t=>t.score)),this.m_score,t,(t=>this.m_score=t))}get highscore(){return this.m_highscore}set highscore(t){this.processPropertyValue(h((t=>t.highscore)),this.m_highscore,t,(t=>this.m_highscore=t))}get multiplier(){return this.m_multiplier}set multiplier(t){this.processPropertyValue(h((t=>t.multiplier)),this.m_multiplier,t,(t=>this.m_multiplier=t))}get ballCount(){return this.m_ballCount}set ballCount(t){this.processPropertyValue(h((t=>t.ballCount)),this.m_ballCount,t,(t=>this.m_ballCount=t))}get paused(){return this.m_paused}set paused(t){this.processPropertyValue(h((t=>t.paused)),this.m_paused,t,(t=>this.m_paused=t))}get outlines(){return this.m_outlines}set outlines(t){this.processPropertyValue(h((t=>t.outlines)),this.m_outlines,t,(t=>this.m_outlines=t))}get windmills(){return this.m_windmills}set windmills(t){this.processPropertyValue(h((t=>t.windmills)),this.m_windmills,t,(t=>this.m_windmills=t))}get muteSounds(){return this.getStoredBoolProperty(B,!1)}set muteSounds(t){this.setStoredBoolProperty(h((t=>t.muteSounds)),B,t)}get windmillScoreCount(){return this.m_windmillScoreCount}set windmillScoreCount(t){this.processPropertyValue(h((t=>t.windmillScoreCount)),this.m_windmillScoreCount,t,(t=>this.m_windmillScoreCount=t))}get topLeftBumperScoreCount(){return this.m_topLeftBumperScoreCount}set topLeftBumperScoreCount(t){this.processPropertyValue(h((t=>t.topLeftBumperScoreCount)),this.m_topLeftBumperScoreCount,t,(t=>this.m_topLeftBumperScoreCount=t))}get topRightBumperScoreCount(){return this.m_topRightBumperScoreCount}set topRightBumperScoreCount(t){this.processPropertyValue(h((t=>t.topRightBumperScoreCount)),this.m_topRightBumperScoreCount,t,(t=>this.m_topRightBumperScoreCount=t))}get batteryScoreCount(){return this.m_batteryScoreCount}set batteryScoreCount(t){this.processPropertyValue(h((t=>t.batteryScoreCount)),this.m_batteryScoreCount,t,(t=>this.m_batteryScoreCount=t))}get helmetScoreCount(){return this.m_helmetScoreCount}set helmetScoreCount(t){this.processPropertyValue(h((t=>t.helmetScoreCount)),this.m_helmetScoreCount,t,(t=>this.m_helmetScoreCount=t))}get freeBall(){return this.m_freeBall}set freeBall(t){this.processPropertyValue(h((t=>t.freeBall)),this.m_freeBall,t,(t=>this.m_freeBall=t))}get usedFreeBall(){return this.m_usedFreeBall}set usedFreeBall(t){this.processPropertyValue(h((t=>t.usedFreeBall)),this.m_usedFreeBall,t,(t=>this.m_usedFreeBall=t))}}const I="page--is-visible";class M{constructor(t){this.m_id=t,this.m_element=document.getElementById(t)}show(){return t=this,e=void 0,n=function*(){return this.m_element.classList.add(I),Promise.resolve()},new((i=void 0)||(i=Promise))((function(o,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}));var t,e,i,n}hide(){this.m_element.classList.remove(I)}get visible(){return this.m_element.classList.contains(I)}get id(){return this.m_id}}class L extends M{constructor(){super(t.Loading)}}function E(){this._eventMappings=[],this._disposed=!1}const R=E;E.prototype.add=function(t,e,i){return!this.has(t,e)&&(t.addEventListener(e,i,!1),this._eventMappings.push({element:t,type:e,listener:i}),!0)},E.prototype.has=function(t,e){let i=this._eventMappings.length;for(;i--;){const n=this._eventMappings[i];if(n.element===t&&n.type==e)return!0}return!1},E.prototype.remove=function(t,e){let i=this._eventMappings.length;for(;i--;){const n=this._eventMappings[i];if(n.element===t&&n.type===e)return t.removeEventListener(e,n.listener,!1),this._eventMappings.splice(i,1),!0}return!1},E.prototype.dispose=function(){if(this._disposed)return;this._disposed=!0;let t=this._eventMappings.length;for(;t--;){const e=this._eventMappings[t];this.remove(e.element,e.type)}this._eventMappings=null};const D={extend(t,e){function i(){}i.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.super=function(t,i,n){const o=new Array(arguments.length-2);for(let t=2;t<arguments.length;t++)o[t-2]=arguments[t];return e.prototype[i].apply(t,o)},t.extend=function(e){D.extend(e,t)}}},O=D,{min:F,max:k,round:H}=Math;function V({width:t=300,height:e=300,fps:i=60,scale:n=1,backgroundColor:o=null,animate:s=!1,smoothing:r=!0,stretchToFit:a=!1,viewport:l=null,handler:h=null,preventEventBubbling:c=!1,parentElement:u=null,debug:d=!1,onUpdate:p=null}={}){if(t<=0||e<=0)throw new Error("cannot construct a zCanvas without valid dimensions");this.DEBUG=d,this._smoothing=r,this._updateHandler=p,this._renderHandler=this.render.bind(this),this._lastRender=0,this._renderId=0,this._renderPending=!1,this._disposed=!1,this._scale={x:n,y:n},this._handler=h,this._activeTouches=[],this._children=[],this._coords=null,this._width=0,this._height=0,this.setFrameRate(i),this.setAnimatable(s),this._element=document.createElement("canvas"),this._canvasContext=this._element.getContext("2d"),o&&this.setBackgroundColor(o);const m=this._canvasContext,g=window.devicePixelRatio||1,f=m.webkitBackingStorePixelRatio||m.mozBackingStorePixelRatio||m.msBackingStorePixelRatio||m.oBackingStorePixelRatio||m.backingStorePixelRatio||1,y=g/f;this._HDPIscaleRatio=g!==f?y:1,this.setDimensions(t,e,!0,!0),l&&this.setViewport(l.width,l.height),1!==n&&this.scale(n,n),a&&this.stretchToFit(!0),u instanceof Element&&this.insertInPage(u),this.setSmoothing(r),this.preventEventBubbling(c),this.addListeners(),this._animate&&this.render()}const N=V;function W(t){const e=t._HDPIscaleRatio,i=t._viewport;let n,o;if(t._enqueuedSize&&(({width:n,height:o}=t._enqueuedSize),t._enqueuedSize=null,t._width=n,t._height=o),i){const e=t._width,s=t._height;n=F(i.width,e),o=F(i.height,s)}if(n&&o){const i=t._element;i.width=n*e,i.height=o*e,i.style.width=`${n}px`,i.style.height=`${o}px`}t._canvasContext.scale(e,e),!1===t._smoothing&&t.setSmoothing(!1),t._coords=null}V.extend=function(t){O.extend(t,V)},V.prototype.insertInPage=function(t){if(this._element.parentNode)throw new Error("Canvas already present in DOM");t.appendChild(this._element)},V.prototype.getElement=function(){return this._element},V.prototype.getCanvasContext=function(){return this._canvasContext},V.prototype.preventEventBubbling=function(t){this._preventDefaults=t},V.prototype.addChild=function(t){if(this.contains(t))return this;const e=this._children.length;return e>0&&(t.last=this._children[e-1],t.last.next=t),t.next=null,t.setCanvas(this),t.setParent(this),this._children.push(t),this.invalidate(),this},V.prototype.removeChild=function(t){t.setParent(null),t.setCanvas(null);const e=this._children.indexOf(t);-1!==e&&this._children.splice(e,1);const i=t.last,n=t.next;return i&&(i.next=n),n&&(n.last=i),t.last=t.next=null,this.invalidate(),t},V.prototype.getChildAt=function(t){return this._children[t]},V.prototype.removeChildAt=function(t){return this.removeChild(this.getChildAt(t))},V.prototype.numChildren=function(){return this._children.length},V.prototype.getChildren=function(){return this._children},V.prototype.contains=function(t){return t._parent===this},V.prototype.invalidate=function(){this._animate||this._renderPending||(this._renderPending=!0,this._renderId=window.requestAnimationFrame(this._renderHandler))},V.prototype.getFrameRate=function(){return this._fps},V.prototype.setFrameRate=function(t){this._fps=t,this._aFps=t,this._renderInterval=1e3/t},V.prototype.getActualFrameRate=function(){return this._aFps},V.prototype.getRenderInterval=function(){return this._renderInterval},V.prototype.getSmoothing=function(){return this._smoothing},V.prototype.setSmoothing=function(t){this._smoothing=t;const e=this._element.style,i=this._canvasContext;["imageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","webkitImageSmoothingEnabled"].forEach((e=>{void 0!==i[e]&&(i[e]=t)})),["-moz-crisp-edges","-webkit-crisp-edges","pixelated","crisp-edges"].forEach((i=>{e["image-rendering"]=t?void 0:i})),this.invalidate()},V.prototype.getWidth=function(){return this._enqueuedSize?this._enqueuedSize.width:this._width},V.prototype.getHeight=function(){return this._enqueuedSize?this._enqueuedSize.height:this._height},V.prototype.setDimensions=function(t,e,i=!0,n=!1){this._enqueuedSize={width:t,height:e},!0===i&&(this._preferredWidth=t,this._preferredHeight=e),!0===n&&W(this),this.invalidate()},V.prototype.getViewport=function(){return this._viewport},V.prototype.setViewport=function(t,e){this._viewport={width:t,height:e},this.panViewport(0,0),W(this)},V.prototype.panViewport=function(t,e,i=!1){const n=this._viewport;n.left=k(0,F(t,this._width-n.width)),n.right=n.left+n.width,n.top=k(0,F(e,this._height-n.height)),n.bottom=n.top+n.height,this.invalidate(),i&&this._handler?.({type:"panned",value:n})},V.prototype.setBackgroundColor=function(t){this._bgColor=t},V.prototype.setAnimatable=function(t){this._animate,this._animate=t,this._lastRaf=window.performance?.now()||Date.now(),t&&!this._renderPending&&this._renderHandler(this._lastRaf)},V.prototype.isAnimatable=function(){return this._animate},V.prototype.drawImage=function(t,e,i,n,o,s,r,a,l){if(e=.5+e|0,i=.5+i|0,o=.5+o|0,(n=.5+n|0)<=0||o<=0)return;const h=this._canvasContext;if("number"==typeof s){const c=(n=F(h.canvas.width,n))/a,u=(o=F(h.canvas.height,o))/l;s+a>t.width&&(n-=c*(s+a-t.width),a-=s+a-t.width),r+l>t.height&&(o-=u*(r+l-t.height),l-=r+l-t.height),h.drawImage(t,s,r,a,l,e,i,n,o)}else h.drawImage(t,e,i,n,o)},V.prototype.scale=function(t,e=t){this._scale={x:t,y:e};const i=1===t&&1===e?"":`scale(${t}, ${e})`,{style:n}=this._element;n["-webkit-transform-origin"]=n["transform-origin"]="0 0",n["-webkit-transform"]=n.transform=i,this.invalidate()},V.prototype.stretchToFit=function(t){this._stretchToFit=t;const{innerWidth:e,innerHeight:i}=window;let n=this._preferredWidth,o=this._preferredHeight,s=1,r=1;i>e?(o=t?i/e*n:o,s=e/n,r=i/o):(n=t?e/i*o:n,s=e/n,r=i/o),this.setDimensions(H(n),H(o),!1,!0),this.scale(s,r)},V.prototype.dispose=function(){if(this._disposed)return;this._animate=!1,window.cancelAnimationFrame(this._renderId),this.removeListeners();let t=this.numChildren();for(;t--;)this._children[t].dispose();this._children=[],this._element.parentNode&&this._element.parentNode.removeChild(this._element),this._disposed=!0},V.prototype.handleInteraction=function(t){const e=this._children.length,i=this._viewport;let n;if(e>0)switch(n=this._children[e-1],t.type){default:let o=0,s=0;const r=t.changedTouches;let a=0,l=r.length;if(l>0){let{x:h,y:c}=this.getCoordinate();for(i&&(h-=i.left,c-=i.top),a=0;a<l;++a){const i=r[a],{identifier:l}=i;if(o=i.pageX-h,s=i.pageY-c,"touchstart"===t.type){for(;n;){if(!this._activeTouches.includes(n)&&n.handleInteraction(o,s,t)){this._activeTouches[l]=n;break}n=n.last}n=this._children[e-1]}else n=this._activeTouches[l],n?.handleInteraction(o,s,t)&&"touchmove"!==t.type&&(this._activeTouches[l]=null)}}break;case"mousedown":case"mousemove":case"mouseup":let{offsetX:h,offsetY:c}=t;for(i&&(h+=i.left,c+=i.top);n&&!n.handleInteraction(h,c,t);)n=n.last;break;case"wheel":const{deltaX:u,deltaY:d}=t,p=20,m=0===u?0:u>0?p:-p,g=0===d?0:d>0?p:-p;this.panViewport(i.left+m,i.top+g,!0)}this._preventDefaults&&(t.stopPropagation(),t.preventDefault()),this._animate||this.invalidate()},V.prototype.render=function(t=0){this._renderPending=!1;const e=t-this._lastRender;if(this._animate&&e/this._renderInterval<.999)return this._renderId=window.requestAnimationFrame(this._renderHandler),void(this._lastRaf=t);let i;this._aFps=1e3/(t-this._lastRaf),i=this._fps>60?this._fps/this._aFps:60===this._fps&&this._aFps>63?1:1/(this._fps/this._aFps),this._lastRaf=t,this._lastRender=t-e%this._renderInterval,this._enqueuedSize&&W(this);const n=this._canvasContext;let o;if(n){const e=this._width,s=this._height;this._bgColor?(n.fillStyle=this._bgColor,n.fillRect(0,0,e,s)):n.clearRect(0,0,e,s);const r="function"==typeof this._updateHandler;for(r&&this._updateHandler(t,i),o=this._children[0];o;)r||o.update(t,i),o.draw(n,this._viewport),o=o.next}!this._disposed&&this._animate&&(this._renderPending=!0,this._renderId=window.requestAnimationFrame(this._renderHandler))},V.prototype.addListeners=function(){this._eventHandler||(this._eventHandler=new R);const t=this._eventHandler,e=this.handleInteraction.bind(this),i=this._element;"ontouchstart"in window&&["start","move","end","cancel"].forEach((n=>{t.add(i,`touch${n}`,e)})),["down","move"].forEach((n=>{t.add(i,`mouse${n}`,e)})),t.add(window,"mouseup",e),this._viewport&&t.add(i,"wheel",e),this._stretchToFit&&t.add(window,"resize",(()=>{this.stretchToFit(this._stretchToFit)}))},V.prototype.removeListeners=function(){this._eventHandler&&this._eventHandler.dispose(),this._eventHandler=null},V.prototype.getCoordinate=function(){return null===this._coords&&(this._coords=this._element.getBoundingClientRect()),this._coords};const G={loadImage:(t,e=null)=>new Promise(((i,n)=>{const o=e||new window.Image,s=function(t){const e=("string"==typeof t?t:t.src).substr(0,5);return"data:"===e||"blob:"===e}(t),r=new R;var a;s||(a=o,function(t){const{location:e}=window;return!(!t.startsWith("./")&&!t.startsWith(`${e.protocol}//${e.host}`)&&/^http[s]?:/.test(t))}(t)||(a.crossOrigin="Anonymous"),r.add(o,"load",(()=>{r.dispose(),G.onReady(o).then((t=>i(q(o)))).catch(n)})),r.add(o,"error",(t=>{r.dispose(),n(t)}))),o.src=t,s&&G.onReady(o).then((t=>i(q(o)))).catch(n)})),isReady:t=>!0===t.complete&&"number"==typeof t.naturalWidth&&t.naturalWidth>0,onReady:t=>new Promise(((e,i)=>{let n=0;!function o(){G.isReady(t)?e():60==++n?i(new Error("Image could not be resolved. This shouldn't occur.")):window.requestAnimationFrame(o)}()}))},U=G;function q(t){const e={image:t,size:null};return t instanceof window.HTMLImageElement&&(e.size=function(t){return{width:t.width||t.naturalWidth,height:t.height||t.naturalHeight}}(t)),e}const z=(t,e)=>{const{left:i,top:n}=t;return i+t.width>=e.left&&i<=e.right&&n+t.height>=e.top&&n<=e.bottom},{min:$,max:j}=Math,Y=.5;function X({width:t,height:e,x:i=0,y:n=0,bitmap:o=null,collidable:s=!1,interactive:r=!1,mask:a=!1,sheet:l=[],sheetTileWidth:h=0,sheetTileHeight:c=0}={}){if(t<=0||e<=0)throw new Error("cannot construct a zSprite without valid dimensions");if(this._children=[],this._disposed=!1,this.collidable=s,this.hover=!1,this._mask=a,this._bounds={left:0,top:0,width:t,height:e},this._parent=null,this.last=null,this.next=null,this.canvas=null,this._bitmap,this._bitmapReady=!1,this._draggable=!1,this._keepInBounds=!1,this.isDragging=!1,this.setX(i),this.setY(n),this.setInteractive(r),o&&this.setBitmap(o),Array.isArray(l)&&l.length>0){if(!o)throw new Error("cannot use a spritesheet without a valid Bitmap");this.setSheet(l,h,c)}}const Z=X;X.extend=function(t){O.extend(t,X)},X.prototype.getDraggable=function(){return this._draggable},X.prototype.setDraggable=function(t,e=!1){this._draggable=t,this._keepInBounds=!!this._constraint||e,t&&!this._interactive&&this.setInteractive(!0)},X.prototype.getX=function(){return this._bounds.left},X.prototype.setX=function(t){const e=t-this._bounds.left;this._bounds.left=this._constraint?t+this._constraint.left:t;let i=this._children[0];for(;i;)i.isDragging||i.setX(i._bounds.left+e),i=i.next},X.prototype.getY=function(){return this._bounds.top},X.prototype.setY=function(t){const e=t-this._bounds.top;this._bounds.top=this._constraint?t+this._constraint.top:t;let i=this._children[0];for(;i;)i.isDragging||i.setY(i._bounds.top+e),i=i.next},X.prototype.getWidth=function(){return this._bounds.width},X.prototype.setWidth=function(t){const e=this._bounds.width||0;this._bounds.width=t,0!==e&&(this._bounds.left-=t*Y-e*Y),this.invalidate()},X.prototype.getHeight=function(){return this._bounds.height},X.prototype.setHeight=function(t){const e=this._bounds.height||0;this._bounds.height=t,0!==e&&(this._bounds.top-=t*Y-e*Y),this.invalidate()},X.prototype.setBounds=function(t,e,i,n){if(this._constraint)t-=this._constraint.left,e-=this._constraint.top;else if(!this.canvas)throw new Error("cannot update position of a Sprite that has no constraint or is not added to a canvas");"number"==typeof i&&(this._bounds.width=i),"number"==typeof n&&(this._bounds.height=n);const o=this._bounds.width,s=this._bounds.height,r=this._constraint?this._constraint.width:this.canvas.width,a=this._constraint?this._constraint.height:this.canvas.height;if(this._keepInBounds){const i=$(0,-(o-r)),n=$(0,-(s-a)),l=a-s;t=$(r-o,j(t,i)),e=$(l,j(e,n))}else t>r&&(t+=o*Y),e>a&&(e+=s*Y);this.setX(t),this.setY(e)},X.prototype.getBounds=function(){return this._bounds},X.prototype.getInteractive=function(){return this._interactive},X.prototype.setInteractive=function(t){this._interactive=t},X.prototype.update=function(t,e){let i=this._children[0];for(;i;)i.update(t),i=i.next;this._animation&&this.updateAnimation(e)},X.prototype.draw=function(t,e=null){if(!this.canvas)return;const i=this._bounds;let n=this._bitmapReady;if(n&&e&&(n=z(i,e)),t.save(),this._mask&&(t.globalCompositeOperation="destination-in"),n){const n=this._animation;let{left:o,top:s,width:r,height:a}=i;if(n){const i=n.tileWidth?n.tileWidth:Y+r|0,l=n.tileHeight?n.tileHeight:Y+a|0;e&&(o-=e.left,s-=e.top),t.drawImage(this._bitmap,n.col*i,n.type.row*l,i,l,Y+o|0,Y+s|0,Y+r|0,Y+a|0)}else if(e){const{src:n,dest:o}=((t,e)=>{let{left:i,top:n,width:o,height:s}=t;const{left:r,top:a,width:l,height:h}=e;return o=i>r?Math.min(o,l-(i-r)):Math.min(l,o-(r-i)),s=n>a?Math.min(s,h-(n-a)):Math.min(h,s-(a-n)),{src:{left:i>r?0:r-i,top:n>a?0:a-n,width:o,height:s},dest:{left:i>r?i-r:0,top:n>a?n-a:0,width:o,height:s}}})(i,e);t.drawImage(this._bitmap,Y+n.left|0,Y+n.top|0,Y+n.width|0,Y+n.height|0,Y+o.left|0,Y+o.top|0,Y+o.width|0,Y+o.height|0)}else t.drawImage(this._bitmap,Y+o|0,Y+s|0,Y+r|0,Y+a|0)}let o=this._children[0];for(;o;)o.draw(t,e),o=o.next;this._mask&&(t.globalCompositeOperation="source-over"),t.restore(),this.canvas.DEBUG&&this.drawOutline(t)},X.prototype.insideBounds=function(t,e){const{left:i,top:n,width:o,height:s}=this._bounds;return t>=i&&t<=i+o&&e>=n&&e<=n+s},X.prototype.collidesWith=function(t){if(t===this)return!1;const e=this._bounds,i=t.getBounds();return!(e.top+e.height<i.top||e.top>i.top+i.height||e.left+e.width<i.left||e.left>i.left+i.width)},X.prototype.getIntersection=function(t){if(this.collidesWith(t)){const e=this._bounds,i=t.getBounds(),n=j(e.left,i.left),o=j(e.top,i.top);return{left:n,top:o,width:$(e.left+e.width,i.width+i.height)-n,height:$(e.top+e.height,i.top+i.height)-o}}return null},X.prototype.collidesWithEdge=function(t,e){if(t===this)return!1;if(isNaN(e)||e<0||e>3)throw new Error("invalid argument for edge");switch(e){case 0:return this.getX()<=t.getX()+t.getWidth();case 1:return this.getY()<=t.getY()+t.getHeight();case 2:return this.getX()+this.getWidth()<=t.getX();case 3:return this.getY()+this.getHeight()>=t.getY()}return!1},X.prototype.getBitmap=function(){return this._bitmap},X.prototype.setBitmap=function(t,e,i){const n=t instanceof window.HTMLCanvasElement,o=t instanceof window.HTMLImageElement;if(t&&!n&&!o&&"string"!=typeof t)throw new Error(`expected HTMLImageElement, HTMLCanvasElement or String for Image source, got "${t}" instead`);return new Promise(((s,r)=>{if(this._bitmap!==t&&(this._bitmapReady=!1),!t)return void(this._bitmap=null);const a="number"==typeof e,l="number"==typeof i;if(a&&this.setWidth(e),l&&this.setHeight(i),this._keepInBounds&&this.canvas&&(a||l)){const t=-(this._bounds.width-this.canvas.getWidth()),e=-(this._bounds.height-this.canvas.getHeight());this._bounds.left>0?this._bounds.left=0:this._bounds.left<t&&(this._bounds.left=t),this._bounds.top>0?this._bounds.top=0:this._bounds.top<e&&(this._bounds.top=e)}if(n)return this._bitmap=t,this._bitmapReady=!0,s();U.loadImage(o?t.src:t,o?t:null).then((({size:t,image:e})=>{this._bitmap=e,this._bitmapReady=!0,this._bitmapWidth=t.width,this._bitmapHeight=t.height,this.invalidate(),s()})).catch((t=>{r(new Error(`zSprite.setBitmap() "${t?.message}" occurred.`))}))}))},X.prototype.setSheet=function(t,e,i){this._sheet=t,t?(this._animation={type:null,col:0,maxCol:0,fpt:0,counter:0},"number"==typeof e&&(this._animation.tileWidth=e),"number"==typeof i&&(this._animation.tileHeight=i),this.switchAnimation(0)):this._animation=null},X.prototype.switchAnimation=function(t){const e=this._animation,i=this._sheet[t];e.type=i,e.fpt=i.fpt,e.maxCol=i.col+(i.amount-1),e.col=i.col,e.counter=0,e.onComplete=i.onComplete},X.prototype.setParent=function(t){this._parent=t},X.prototype.getParent=function(){return this._parent},X.prototype.setCanvas=function(t){this.canvas=t,this._children.forEach((e=>{e.setCanvas(t)}))},X.prototype.setConstraint=function(t,e,i,n){return this._constraint={left:t,top:e,width:i,height:n},this._bounds.left=j(t,this._bounds.left),this._bounds.top=j(e,this._bounds.top),this._keepInBounds=!0,this.getConstraint()},X.prototype.getConstraint=function(){return this._constraint},X.prototype.addChild=function(t){if(this.contains(t))return this;const e=this._children.length;return e>0&&(t.last=this._children[e-1],t.last.next=t,t.next=null),t.setCanvas(this.canvas),t.setParent(this),this._children.push(t),this.invalidate(),this},X.prototype.removeChild=function(t){t.setParent(null),t.setCanvas(null);const e=this._children.indexOf(t);-1!==e&&this._children.splice(e,1);const i=t.last,n=t.next;return i&&(i.next=n),n&&(n.last=i),t.last=t.next=null,this.invalidate(),t},X.prototype.getChildAt=function(t){return this._children[t]},X.prototype.removeChildAt=function(t){return this.removeChild(this.getChildAt(t))},X.prototype.numChildren=function(){return this._children.length},X.prototype.getChildren=function(){return this._children},X.prototype.contains=function(t){return t._parent===this},X.prototype.dispose=function(){if(this._disposed)return;this._disposed=!0,this._parent&&this._parent.removeChild(this);let t=this._children.length;for(;t--;){const e=this._children[t];e.dispose(),e.next=null,e.last=null}this._children=[]},X.prototype.handlePress=function(t,e,i){},X.prototype.handleRelease=function(t,e,i){},X.prototype.handleClick=function(){},X.prototype.handleMove=function(t,e,i){const n=this._dragStartOffset.x+(t-this._dragStartEventCoordinates.x),o=this._dragStartOffset.y+(e-this._dragStartEventCoordinates.y);this.setBounds(n,o,this._bounds.width,this._bounds.height)},X.prototype.handleInteraction=function(t,e,i){let n,o=!1;const s=this._children.length;if(s>0)for(n=this._children[s-1];n;){if(o=n.handleInteraction(t,e,i),o)return!0;n=n.last}if(!this._interactive)return!1;const{type:r}=i;if(this._pressed&&("touchend"===r||"mouseup"===r))return this._pressed=!1,this.isDragging&&(this.isDragging=!1),Date.now()-this._pressTime<250&&this.handleClick(),this.handleRelease(t,e,i),!0;if(this.insideBounds(t,e)){if(this.hover=!0,"touchstart"===r||"mousedown"===r)return this._pressTime=Date.now(),this._pressed=!0,this._draggable&&(this.isDragging=!0,this._dragStartOffset={x:this._bounds.left,y:this._bounds.top},this._dragStartEventCoordinates={x:t,y:e}),this.handlePress(t,e,i),"touchstart"===r&&(i.stopPropagation(),i.preventDefault()),!0}else this.hover=!1;return!!this.isDragging&&(this.handleMove(t,e,i),!0)},X.prototype.invalidate=function(){this.canvas&&this.canvas.invalidate()},X.prototype.updateAnimation=function(t=1){const e=this._animation;e.counter+=t,e.counter>=e.fpt&&(++e.col,e.counter=e.counter%e.fpt),e.col>e.maxCol&&(e.col=e.type.col,"function"==typeof e.onComplete&&e.onComplete(this))},X.prototype.drawOutline=function(t){t.lineWidth=1,t.strokeStyle="#FF0000",t.strokeRect(this.getX(),this.getY(),this.getWidth(),this.getHeight())},new Map;const K=z;var Q,J,tt,et;!function(t){t[t.Circular=0]="Circular",t[t.Rectangular=1]="Rectangular",t[t.LeftFlipper=2]="LeftFlipper",t[t.RightFlipper=3]="RightFlipper",t[t.Trigger=4]="Trigger"}(Q||(Q={})),function(t){t[t.Multiplier=0]="Multiplier",t[t.SequenceCompletion=1]="SequenceCompletion",t[t.Teleport=2]="Teleport",t[t.Windmills=3]="Windmills",t[t.Launched=4]="Launched",t[t.Lane=5]="Lane"}(J||(J={})),function(t){t[t.Bool=0]="Bool",t[t.Series=1]="Series"}(tt||(tt={})),function(t){t[t.Launcher=0]="Launcher",t[t.Bumper=1]="Bumper"}(et||(et={}));const it={width:800,height:1579,backgroundHeight:1521,playHeight:1470,background:o.BACKGROUND,body:{source:`${n.IMAGES_PATH}/shape.svg`,left:-14,top:-275,width:800,height:1579},poppers:[{left:741,top:1372,width:54,height:20,forceX:0,forceY:-60,popperType:et.Launcher,sensor:!1},{left:158,top:1003,width:8,height:155,angle:-26,forceX:6,forceY:-5,popperType:et.Bumper},{left:493,top:1003,width:8,height:155,angle:26,forceX:-6,forceY:-5,popperType:et.Bumper},{left:140,top:410,width:8,height:60,angle:10,forceX:8,forceY:1,scoreType:m.TopLeftBumper,popperType:et.Bumper},{left:142,top:470,width:8,height:56,angle:-15,forceX:8,forceY:-3,scoreType:m.TopLeftBumper,popperType:et.Bumper},{left:624,top:410,width:8,height:60,angle:-1,forceX:-8,forceY:1,scoreType:m.TopRightBumper,popperType:et.Bumper},{left:606,top:470,width:8,height:56,angle:20,forceX:-8,forceY:-3,scoreType:m.TopRightBumper,popperType:et.Bumper}],flippers:[{type:Q.LeftFlipper,left:214,top:629,angle:2},{type:Q.RightFlipper,left:440,top:629,angle:-4},{type:Q.LeftFlipper,left:214,top:1259,angle:2},{type:Q.RightFlipper,left:376,top:1259,angle:-4}],reflectors:[],rectangles:[{left:0,top:0,width:2,height:1579},{left:798,top:0,width:2,height:1579},{left:350,top:145,width:30,height:102},{left:436,top:145,width:30,height:102},{left:140,top:394,width:20,height:4,angle:25},{left:624,top:394,width:20,height:4,angle:-25},{left:741,top:1364,width:20,height:4,angle:20},{left:775,top:1364,width:20,height:4,angle:-20}],bumpers:[{left:223,top:289,width:130,height:112,type:Q.Circular,idleBitmap:o.FLAT_LEFT_OFF,hitBitmap:o.FLAT_LEFT_ON,bitmapWidth:134,bitmapHeight:112,frames:5,radius:44,scoreType:m.TopBumper},{left:401,top:286,width:130,height:112,type:Q.Circular,idleBitmap:o.FLAT_RIGHT_OFF,hitBitmap:o.FLAT_RIGHT_ON,bitmapWidth:134,bitmapHeight:112,frames:5,radius:44,scoreType:m.TopBumper},{left:307,top:448,width:114,height:92,type:Q.Circular,idleBitmap:o.TOWERS_OFF,hitBitmap:o.TOWERS_ON,bitmapWidth:134,bitmapHeight:112,frames:5,radius:44,scoreType:m.TopBumper},{left:641,top:795,width:70,height:59,type:Q.Circular,idleBitmap:o.HELMET_OFF,hitBitmap:o.HELMET_ON,frames:15,radius:26,bitmapDeltaX:-4,bitmapWidth:70,bitmapHeight:59,scoreType:m.HelmetBumper},{left:640,top:875,width:50,height:81,type:Q.Circular,idleBitmap:o.CAMERA_OFF,hitBitmap:o.CAMERA_ON,frames:15,radius:26,bitmapDeltaY:-10,bitmapWidth:50,bitmapHeight:81,scoreType:m.HelmetBumper},{left:71,top:761,width:60,height:91,type:Q.Rectangular,idleBitmap:o.BATTERY_OFF,hitBitmap:o.BATTERY_ON,frames:15,scoreType:m.BatteryBumper,gameSound:s.HitElectricity},{left:20,top:829,width:60,height:91,type:Q.Rectangular,idleBitmap:o.BATTERY_OFF,hitBitmap:o.BATTERY_ON,frames:15,scoreType:m.BatteryBumper,gameSound:s.HitElectricity}],triggerGroups:[{target:J.Windmills,type:tt.Bool,triggers:[{left:610.5,top:540,width:78,height:78}]},{target:J.Launched,type:tt.Bool,triggers:[{left:412,top:25,width:130,height:130,sensor:!0}]},{target:J.Lane,type:tt.Bool,scoreType:m.TopLane,triggers:[{left:309,top:163,width:26,height:66,sensor:!0,type:Q.Rectangular}]},{target:J.Lane,type:tt.Bool,scoreType:m.TopLane,triggers:[{left:395,top:163,width:26,height:66,sensor:!0,type:Q.Rectangular}]},{target:J.Lane,type:tt.Bool,scoreType:m.TopLane,triggers:[{left:483,top:163,width:26,height:66,sensor:!0,type:Q.Rectangular}]},{target:J.Lane,type:tt.Bool,scoreType:m.InnerLane,triggers:[{left:85,top:1043,width:26,height:66,sensor:!0,type:Q.Rectangular}]},{target:J.Lane,type:tt.Bool,scoreType:m.InnerLane,triggers:[{left:614,top:1043,width:26,height:66,sensor:!0,type:Q.Rectangular}]},{target:J.Lane,type:tt.Bool,scoreType:m.OuterLane,triggers:[{left:17,top:1132,width:26,height:66,sensor:!0,type:Q.Rectangular}]},{target:J.Lane,type:tt.Bool,scoreType:m.OuterLane,triggers:[{left:682,top:1132,width:26,height:66,sensor:!0,type:Q.Rectangular}]}],topLayer:[{width:216,height:580,left:0,top:116,bitmap:o.TUNNEL_TOP},{left:619,top:587,width:87,height:192,bitmap:o.WINDMILLS_TOP},{left:298,top:1442,width:141,height:97,bitmap:o.BOTTOM_OVERLAY},{left:740,top:1391,width:57,height:131,bitmap:o.LAUNCHER_TOP}]};class nt{static isProduction(){return!0}static isDevelopment(){return!this.isProduction()}}var ot;!function(t){t.Ball="ball",t.Flipper="flipper",t.Popper="popper",t.Bumper="bumper",t.Trigger="trigger",t.TriggerGroup="trigger-group"}(ot||(ot={}));const{floor:st,cos:rt,sin:at,max:lt,min:ht}=Math,ct=180/Math.PI,ut=Math.PI/180,dt=.5;class pt{static fastRound(t){return t>0?t+.5|0:0|t}static radToDeg(t){return(t*ct+360)%360}static degToRad(t){return t*ut}static clamp(t,e,i){return lt(e,ht(i,t))}static rectangleToRotatedPolygon(t,e=0,i,n){const o=this.rectangleToPolygon(t),s=[],r="number"==typeof i?i:t.left+t.width*dt,a="number"==typeof n?n:t.top+t.height*dt;for(let t=0;t<8;t+=2){const i=o[t]-r,n=o[t+1]-a;s.push(r+st(i*rt(e)-n*at(e))),s.push(a+st(n*rt(e)+i*at(e)))}return s}static rectangleToPolygon(t){const{left:e,top:i}=t;return[e,i,e+t.width,i,e+t.width,i+t.height,e,i+t.height]}static rotateRectangle(t,e=0,i=!1){if(0===e)return t;const{left:n,top:o,width:s,height:r}=t,a=-s*dt,l=s*dt,h=s*dt,c=-s*dt,u=r*dt,d=r*dt,p=-r*dt,m=-r*dt,g=Math.cos(e),f=Math.sin(e),y=a*g+u*f,_=-a*f+u*g,v=l*g+d*f,b=-l*f+d*g,x=h*g+p*f,w=-h*f+p*g,S=c*g+m*f,A=-c*f+m*g,P=Math.min(y,v,x,S),T=Math.max(y,v,x,S),B=Math.min(_,b,w,A),C={width:T-P,height:Math.max(_,b,w,A)-B,left:0,top:0};return C.left=n-(C.width/2-s/2),C.top=o-(C.height/2-r/2),i&&(C.left=this.fastRound(C.left),C.top=this.fastRound(C.top),C.width=this.fastRound(C.width),C.height=this.fastRound(C.height)),C}static isInsideViewport(t,e){const{left:i,top:n}=t;return i+t.width>=e.left&&i<=e.right&&n+t.height>=e.top&&n<=e.bottom}}let mt=1;class gt{static generateId(){return mt++}}class ft{constructor({left:t=0,top:e=0,width:i=1,height:n=1,angle:o=0,radius:s=0,fixed:r=!0,sensor:a=!1,visible:l=!0,type:h=Q.Rectangular}={},c,u,d){this.m_engine=c,this.m_canvas=u,this.m_id=gt.generateId(),this.m_fixed=r,this.m_sensor=a,this.m_angle=pt.degToRad(o),this.m_radius=s,this.m_type=h,this.m_visible=l,this.m_halfWidth=i/2,this.m_halfHeight=n/2,this.m_mainData=d,this.m_bodyBounds={left:t+this.m_halfWidth,top:e+this.m_halfHeight,width:i,height:n},this.m_pivot={x:0,y:0},0!==this.m_angle&&(this.m_rotatedBounds=pt.rotateRectangle(this.m_bodyBounds,this.m_angle),this.m_bodyBounds.left-=(i-this.m_rotatedBounds.width)/2,this.m_bodyBounds.top-=(n-this.m_rotatedBounds.height)/2),this.m_outline=[],this.register(),this.m_body&&this.updateBodyBounds(),this.m_cached=this.m_fixed}dispose(){var t;this.engine.removeBody(this.m_body),null===(t=this.m_renderer)||void 0===t||t.dispose(),this.m_renderer=null}isInsideViewport(t){return K(0!==this.m_angle?this.m_rotatedBounds:this.m_bodyBounds,t)}update(t){this.m_angle=this.m_body.angle,this.updateBodyBounds()}get body(){return this.m_body}get type(){return this.m_type}get engine(){return this.m_engine}get canvas(){return this.m_canvas}get outline(){return this.m_outline}set outline(t){this.m_outline=t}get bounds(){return this.m_bodyBounds}get halfWidth(){return this.m_halfWidth}get halfHeight(){return this.m_halfHeight}get angle(){return this.m_angle}get pivot(){return this.m_pivot}get visible(){return this.m_visible}get radius(){return this.m_radius}set radius(t){this.m_radius=t}get fixed(){return this.m_fixed}get sensor(){return this.m_sensor}get mainData(){return this.m_mainData}get cached(){return this.m_cached}getRenderer(){return null}getLabel(){return`actor-${this.m_id}`}register(){this.m_body=this.engine.addBody(this,this.getLabel()),this.m_renderer=this.getRenderer(),this.m_renderer&&this.canvas.addChild(this.m_renderer)}updateBodyBounds(){return this.m_cached||(this.m_bodyBounds.left=this.m_body.position.x-this.m_halfWidth,this.m_bodyBounds.top=this.m_body.position.y-this.m_halfHeight,0!==this.m_angle&&(this.m_rotatedBounds=pt.rotateRectangle(this.m_bodyBounds,this.m_angle)),nt.isDevelopment()&&(this.m_outline=pt.rectangleToPolygon(this.m_bodyBounds))),this.m_bodyBounds}}class yt extends Z{constructor(t,e){super(e),this.m_actor=t}get actor(){return this.m_actor}drawActorOutline(t,e){if(nt.isDevelopment()&&this.actor.mainData.outlines){t.save();const i=this.actor.outline;t.translate(-e.left,-e.top),t.strokeStyle="red",t.beginPath(),t.moveTo(i[0],i[1]);for(let e=2;e<i.length;e+=2)t.lineTo(i[e],i[e+1]);t.closePath(),t.stroke(),t.restore()}}}class _t extends yt{constructor(t){super(t,{width:t.bounds.width,height:t.bounds.height}),t.radius=u.hasRoundRect()?t.radius:0}draw(t,e){e&&this.actor.isInsideViewport(e)&&this.drawActorOutline(t,e)}}var vt=i(46),bt=i.n(vt);class xt{static setupTableBody(t){return nt.isDevelopment()&&console.debug({body:t}),t.friction=0,t.restitution=0,t}static renderBodies(t,e=800,i=600){const n=bt().Render.create({element:document.body,engine:t,options:{width:e,height:i,showAngleIndicator:!0,showCollisions:!0,showVelocity:!0}}),o=window.innerHeight/i;return Object.assign(n.canvas.style,{position:"absolute",zIndex:1,top:"50%",left:"50%",opacity:.75,transform:`scale(${o}) translate(-50%, -50%)`,"transform-origin":"0 0"}),bt().Render.run(n),n}}class wt extends ft{constructor(t,e,i,n){var o,s;super(Object.assign(Object.assign({},t),{type:null!==(o=t.type)&&void 0!==o?o:Q.Rectangular,fixed:null===(s=t.fixed)||void 0===s||s}),e,i,n),this.type===Q.Rectangular&&xt.setupTableBody(this.body),this.updateBodyBounds()}updateBodyBounds(){if(this.cached)return this.bounds;const{left:t,top:e}=super.updateBodyBounds();return this.pivot.x=t+this.halfWidth,this.pivot.y=e+this.halfHeight,nt.isDevelopment()&&(0===this.angle?this.outline=pt.rectangleToPolygon(this.bounds):this.outline=pt.rectangleToRotatedPolygon(this.bounds,this.angle,this.pivot.x,this.pivot.y)),this.bounds}getRenderer(){return this.visible?new _t(this):null}}class St extends wt{constructor(t,e,i,o){var s,r,a;super(Object.assign(Object.assign({},t),{fixed:!0,sensor:null===(s=t.sensor)||void 0===s||s}),e,i,o),this.m_once=null!==(r=t.once)&&void 0!==r&&r,this.m_impulse={x:t.forceX*n.GRAVITY,y:t.forceY*n.GRAVITY},this.m_scoreType=null!==(a=t.scoreType)&&void 0!==a?a:m.None,this.m_popperType=t.popperType}getImpulse(){return this.m_impulse}get once(){return this.m_once}get scoreType(){return this.m_scoreType}get popperType(){return this.m_popperType}getLabel(){return ot.Popper}getRenderer(){return nt.isDevelopment()?new _t(this):null}}class At{static asImage(t){return t}}class Pt extends yt{constructor(t){super(t,{width:t.bounds.width,height:t.bounds.height,bitmap:At.asImage(t.idleBitmap)}),this.m_collisionAnimation=!1,this.m_collisionIterations=0}draw(t,e){if(!e||!this.actor.isInsideViewport(e))return;let{left:i,top:n,width:o,height:s}=this.actor.bounds;this.actor.collided&&(this.m_collisionAnimation?0==--this.m_collisionIterations&&(this.m_collisionAnimation=!1,this.actor.collided=!1):(this.m_collisionAnimation=!0,this.m_collisionIterations=this.actor.frames)),t.drawImage(this.actor.collided?this.actor.hitBitmap:this.actor.idleBitmap,0,0,this.actor.bitmapWidth,this.actor.bitmapHeight,i-e.left+this.actor.bitmapDeltaX,n-e.top+this.actor.bitmapDeltaY,this.actor.bitmapWidth,this.actor.bitmapHeight),nt.isDevelopment()&&this.actor.mainData.outlines&&(this.actor.type===Q.Circular?(t.save(),t.strokeStyle="#00AEEF",t.lineWidth=2,t.beginPath(),t.arc(i-e.left+this.actor.radius,n-e.top+this.actor.radius,this.actor.radius,0,2*Math.PI),t.fillStyle="transparent",t.stroke(),t.restore()):this.drawActorOutline(t,e))}}class Tt extends ft{constructor(t,e,i,n){var o,s,r,a,l,h,c;super(Object.assign(Object.assign({},t),{type:null!==(o=t.type)&&void 0!==o?o:Q.Circular,radius:null!==(s=t.radius)&&void 0!==s?s:t.width/2,fixed:!0}),e,i,n),this.m_collided=!1,this.body.restitution=1,this.m_idleBitmap=t.idleBitmap,this.m_hitBitmap=t.hitBitmap,this.m_frames=t.frames,this.m_bitmapDeltaX=null!==(r=t.bitmapDeltaX)&&void 0!==r?r:0,this.m_bitmapDeltaY=null!==(a=t.bitmapDeltaY)&&void 0!==a?a:0,this.m_bitmapHeight=null!==(l=t.bitmapHeight)&&void 0!==l?l:t.height,this.m_bitmapWidth=null!==(h=t.bitmapWidth)&&void 0!==h?h:t.width,this.m_scoreType=t.scoreType,this.m_gameSound=null!==(c=t.gameSound)&&void 0!==c?c:null}get collided(){return this.m_collided}set collided(t){this.m_collided=t}get idleBitmap(){return this.m_idleBitmap}get hitBitmap(){return this.m_hitBitmap}get frames(){return this.m_frames}get bitmapDeltaX(){return this.m_bitmapDeltaX}get bitmapDeltaY(){return this.m_bitmapDeltaY}get bitmapWidth(){return this.m_bitmapWidth}get bitmapHeight(){return this.m_bitmapHeight}get scoreType(){return this.m_scoreType}get gameSound(){return this.m_gameSound}getRenderer(){return new Pt(this)}getLabel(){return ot.Bumper}}class Bt extends yt{constructor(t){super(t,{width:t.bounds.width,height:t.bounds.height})}draw(t,e){if(!e||!this.actor.isInsideViewport(e))return;const{left:i,top:n,width:o,height:s}=this.actor.bounds,{radius:r}=this.actor;nt.isDevelopment()&&this.actor.mainData.outlines&&this.actor.type===Q.Circular&&(t.save(),t.beginPath(),t.arc(i-e.left+r,n-e.top+r,r,0,2*Math.PI),t.strokeStyle=this.actor.active?"#FFF":"#00AEEF",t.lineWidth=2,t.stroke(),t.restore()),this.drawActorOutline(t,e)}}class Ct extends ft{constructor(t,e,i,n){var o,s;super(Object.assign(Object.assign({},t),{type:null!==(o=t.type)&&void 0!==o?o:Q.Circular,radius:null!==(s=t.radius)&&void 0!==s?s:t.width/2,fixed:!0}),e,i,n),this.m_active=!1}get active(){return this.m_active}set active(t){this.m_active=t}getRenderer(){return this.visible?new Bt(this):null}getLabel(){return ot.Trigger}}class It extends ft{constructor(t,e,i,n){var o,s;super({fixed:!0},e,i,n),this.m_completions=0,this.m_activeTriggers=new Set,this.m_triggerTimeoutStart=0,this.m_triggerTarget=t.target,this.m_triggerType=t.type,this.m_completeMessage=t.message,this.m_roundRobin=null!==(o=t.roundRobin)&&void 0!==o&&o,this.m_triggerDefinitions=t.triggers,this.m_scoreType=null!==(s=t.scoreType)&&void 0!==s?s:m.None,this.m_triggers=this.m_triggerDefinitions.map((t=>new Ct(t,this.engine,this.canvas,n)))}get triggerTarget(){return this.m_triggerTarget}get triggerType(){return this.m_triggerType}get triggers(){return this.m_triggers}get completeMessage(){return this.m_completeMessage}get scoreType(){return this.m_scoreType}get completions(){return this.m_completions}dispose(){for(const t of this.triggers)t.dispose();this.triggers.length=0}trigger(t){const e=this.triggers.find((e=>e.body.id===t));if(void 0===e)return!1;this.m_activeTriggers.add(t),e.active=!0;const i=this.m_activeTriggers.size===this.triggers.length;return i&&this.m_completions++,i}moveTriggersLeft(){if(!this.m_roundRobin||0===this.m_activeTriggers.size)return;const t=this.triggers.map((t=>t.active)),e=t.shift();t.push(e),this.updateTriggers(t)}moveTriggersRight(){if(!this.m_roundRobin||0===this.m_activeTriggers.size)return;const t=this.triggers.map((t=>t.active)),e=t.pop();t.unshift(e),this.updateTriggers(t)}unsetTriggers(){for(const t of this.triggers)t.active=!1;this.m_activeTriggers.clear()}update(t){0!==this.m_activeTriggers.size&&this.triggerType===tt.Series&&(0===this.m_triggerTimeoutStart?this.m_triggerTimeoutStart=t:(this.triggerTarget===J.SequenceCompletion&&t-this.m_triggerTimeoutStart>=n.SEQUENCE_REPEAT_WINDOW&&(this.m_completions=0),t-this.m_triggerTimeoutStart>=n.TRIGGER_EXPIRY&&(this.unsetTriggers(),this.m_triggerTimeoutStart=0,this.m_completions=0)))}register(){}getLabel(){return ot.TriggerGroup}updateTriggers(t){this.m_activeTriggers.clear();for(let e=0,i=this.triggers.length;e<i;++e){const i=this.triggers[e],n=t[e];i.active=n,n&&this.m_activeTriggers.add(i.body.id)}}}class Mt extends yt{constructor(t){super(t,{bitmap:o.BALL,width:n.BALL_SIZE,height:n.BALL_SIZE})}draw(t,e){if(!e||!this._bitmapReady||!this.actor.isInsideViewport(e))return;const{left:i,top:n,width:o,height:s}=this.actor.bounds;t.save(),t.drawImage(this._bitmap,0,0,o,s,i-e.left,n-e.top,o,s),t.restore(),this.drawActorOutline(t,e)}}class Lt extends ft{constructor(t,e,i,n){var o;super(Object.assign(Object.assign({},t),{type:Q.Circular,fixed:!1,radius:null!==(o=t.radius)&&void 0!==o?o:t.width/2}),e,i,n),this.body.friction=.05,this.body.frictionAir=.001,this.body.frictionStatic=.1,this.body.restitution=0,this.body.slop=.001}getRenderer(){return new Mt(this)}getLabel(){return ot.Ball}}var Et,Rt=i(692),Dt=i.n(Rt);!function(t){t[t.Up=0]="Up",t[t.Down=1]="Down"}(Et||(Et={}));var Ot=i(371),Ft=i.n(Ot),kt=function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))};bt().Common.setDecomp(Ft());const Ht=new Map;class Vt{static loadVertices(t){return kt(this,void 0,void 0,(function*(){if(Ht.has(t))return Ht.get(t);const e=function(t){return Array.prototype.slice.call(t.querySelectorAll("path"))}(yield function(t){return kt(this,void 0,void 0,(function*(){let e=yield fetch(t),i=yield e.text();return(new window.DOMParser).parseFromString(i,"image/svg+xml")}))}(t)).map((t=>bt().Svg.pathToVertices(t,30)));return Ht.set(t,e),e}))}}var Nt=function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))};bt().use(Dt());class Wt{constructor(t,e,i,o){this.m_render=null,this.m_vertices=[],this.m_handleCollision=i,this.m_handleBeforeUpdate=e,this.m_mainData=o,this.m_engine=bt().Engine.create(),this.m_table=t,this.m_leftFlipperUp=!1,this.m_rightFlipperUp=!1;const{width:s,height:r}=t;this.m_engine.positionIterations=100,this.m_engine.velocityIterations=16,this.m_engine.world.gravity.y=n.GRAVITY,this.m_engine.world.bounds={min:{x:0,y:0},max:{x:s,y:r}},bt().Events.on(this.m_engine,"collisionStart",this.m_handleCollision),bt().Events.on(this.m_engine,"beforeUpdate",this.m_handleBeforeUpdate),this.m_ignoreGroup=bt().Body.nextGroup(!0)}static create(t,e,i,n){return Nt(this,void 0,void 0,(function*(){const o=new Wt(t,e,i,n);return yield o.addTableBody(),yield o.addTableReflectors(),o}))}get engine(){return this.m_engine}get vertices(){return this.m_vertices}update(t){bt().Engine.update(this.m_engine,t)}addBody(t,e){switch(t.type){default:case Q.Rectangular:return this.addRectangleBody(t,e);case Q.Circular:return this.addCircularBody(t,e);case Q.LeftFlipper:case Q.RightFlipper:return this.addFlipperBody(t,e)}}removeBody(t){bt().World.remove(this.m_engine.world,t)}updateBodyPosition(t,e){bt().Body.setPosition(t,e)}launchBall(t,e){bt().Body.setVelocity(t,e)}triggerFlipper(t,e){t===Q.LeftFlipper?this.m_leftFlipperUp=e:this.m_rightFlipperUp=e}capSpeed(t){bt().Body.setVelocity(t,{x:Math.max(Math.min(t.velocity.x,n.MAX_SPEED),-n.MAX_SPEED),y:Math.max(Math.min(t.velocity.y,n.MAX_SPEED),-n.MAX_SPEED)})}destroy(){bt().Events.off(this.m_engine,"collisionStart",this.m_handleCollision),bt().Events.off(this.m_engine,"beforeUpdate",this.m_handleBeforeUpdate),this.stopRender(),bt().World.clear(this.m_engine.world,!1,!0),bt().Engine.clear(this.m_engine)}stopRender(){this.m_render&&(bt().Render.stop(this.m_render),this.m_render.canvas.remove(),this.m_render.canvas=null,this.m_render.context=null,this.m_render.textures={},this.m_render=null)}startRender(){nt.isDevelopment()&&!this.m_render&&(this.m_render=xt.renderBodies(this.engine,this.m_table.width,this.m_table.height))}createIgnorable(t,e,i,n){return bt().Bodies.circle(t,e,i,{isStatic:!0,collisionFilter:{group:this.m_ignoreGroup},plugin:n})}addVertices(t,e,i){this.m_vertices.push(i.map((i=>vt.Vector.create(i.x+t,i.y+e))))}addMultipleVertices(t,e,i){i.forEach((i=>this.addVertices(t,e,i)))}addTableBody(){return Nt(this,void 0,void 0,(function*(){const t=yield Vt.loadVertices(this.m_table.body.source),e=this.m_table.body.left+this.m_table.body.width/2,i=this.m_table.body.top+this.m_table.body.height/2;bt().Composite.add(this.m_engine.world,xt.setupTableBody(bt().Bodies.fromVertices(e,i,t,{isStatic:!0},!0))),this.addMultipleVertices(0,0,t)}))}addTableReflectors(){return Nt(this,void 0,void 0,(function*(){for(const t of this.m_table.reflectors){const e=yield Vt.loadVertices(t.source),i=t.left+t.width/2,n=t.top+t.height/2;bt().Composite.add(this.m_engine.world,bt().Bodies.fromVertices(i,n,e,{isStatic:!0,restitution:1},!0)),this.addMultipleVertices(t.left-this.m_table.body.left,t.top-.25*t.height,e)}}))}addRectangleBody(t,e){const{left:i,top:n,width:o,height:s}=t.bounds,r=bt().Bodies.rectangle(i,n,o,s,{label:e,isSensor:t.sensor,angle:t.angle,isStatic:t.fixed});return bt().World.add(this.m_engine.world,r),r}addCircularBody(t,e){const{left:i,top:n,width:o,height:s}=t.bounds,r=e!==ot.Ball,a=bt().Bodies.circle(i+t.radius/2,n+t.radius/2,t.radius,{label:e,isSensor:t.sensor,isStatic:t.fixed,collisionFilter:{group:r?void 0:this.m_ignoreGroup}});return bt().World.add(this.m_engine.world,a),a}plugin(t,e,i){return{attractors:[(o,s)=>{if(s.id!==e)return;const r=i?this.m_leftFlipperUp:this.m_rightFlipperUp;return t===Et.Up&&r||t===Et.Down&&!r?{x:(o.position.x-s.position.x)*n.FLIPPER_FORCE,y:(o.position.y-s.position.y)*n.FLIPPER_FORCE}:void 0}]}}addFlipperBody(t,e){const{left:i,top:n,width:o,height:s}=t.bounds,r=t.type===Q.LeftFlipper,a=bt().Bodies.rectangle(i,n,o,s,{label:e,frictionAir:0,chamfer:{}}),{id:l}=a,h=r?i-o/2:i+o/2,c=n,u=bt().Bodies.circle(h,c,5,{isStatic:!0}),d=bt().Constraint.create({pointA:{x:h,y:c},bodyB:a,pointB:{x:r?-o/2:o/2,y:0},stiffness:0}),p=r?h+30:h-20,m=r?.8:.7,g=this.createIgnorable(p,c-.9*o,1.5*s,this.plugin(Et.Up,l,r)),f=this.createIgnorable(p,c+o*m,s,this.plugin(Et.Down,l,r));bt().World.add(this.m_engine.world,[g,f]);const y=bt().Composite.add(bt().Composite.create(),[a,u,d,g,f]);return bt().Composite.rotate(y,t.angle,{x:h,y:c}),bt().World.add(this.m_engine.world,y),a}}function Gt(t,e){if(t===Q.LeftFlipper&&e.top<800)return o.LEFT_TOP_FLIPPER;if(t===Q.LeftFlipper)return o.LEFT_BOTTOM_FLIPPER;if(t===Q.RightFlipper&&e.top<800)return o.RIGHT_TOP_FLIPPER;if(t===Q.RightFlipper)return o.RIGHT_BOTTOM_FLIPPER;throw"unknown flipper type"}class Ut extends yt{constructor(t){super(t,{bitmap:Gt(t.type,t.bounds),width:t.bounds.width,height:t.bounds.height})}draw(t,e){if(!e||!this._bitmapReady||!this.actor.isInsideViewport(e))return;const{left:i,top:n,width:o,height:s}=this.actor.bounds,r=this.actor.angle,a=0!==r;if(a){const i=this.actor.pivot;t.save();const n=i.x-e.left,o=i.y-e.top;t.translate(n,o),t.rotate(r),t.translate(-n,-o)}t.drawImage(this._bitmap,0,0,o,s,i-e.left,n-e.top,o,s),a&&t.restore(),this.drawActorOutline(t,e)}}class qt extends wt{constructor(t,e,i,n){super(Object.assign(Object.assign({},t),{width:136,height:52,fixed:!1}),e,i,n),this.body.friction=0,this.m_isUp=!1}trigger(t){return t!==this.m_isUp&&(this.m_isUp=t,this.engine.triggerFlipper(this.type,this.m_isUp),t)}getRenderer(){return new Ut(this)}getLabel(){return ot.Flipper}}class zt extends Z{constructor(t,e,i,n,o,s,r){super({x:t,y:e,width:i,height:n}),this.m_bitmapOff=s,this.m_bitmapOn=o,this.m_state=r}setState(t){this.m_state!=t&&(this.m_state=t,this.invalidate())}draw(t,e){const{left:i,top:n,width:o,height:s}=this.getBounds();e&&pt.isInsideViewport({left:i,top:n,width:o,height:s},e)&&t.drawImage(this.m_state?this.m_bitmapOn:this.m_bitmapOff,0,0,o,s,i-e.left,n-e.top,o,s)}}class $t extends zt{constructor(t){super(566,778,63,75,o.YELLOW_ARROW_ON,o.YELLOW_ARROW_OFF,!0),this.m_mainData=t}update(t,e){const i=1&Math.floor(t/500);this.setState(!!i||this.m_mainData.windmills)}}class jt extends Z{constructor(t){super({width:64,height:96,x:360,y:865}),this.m_mainData=t,this.m_arrows=[new zt(360,865,64,55,o.BLUE_ARROW_ON,o.BLUE_ARROW_OFF,!1),new zt(360,897,64,55,o.BLUE_ARROW_ON,o.BLUE_ARROW_OFF,!1),new zt(360,929,64,55,o.BLUE_ARROW_ON,o.BLUE_ARROW_OFF,!1)],this.m_arrows.forEach((t=>this.addChild(t)))}update(t,e){super.update(t,e);const i=2-Math.floor(t/250)%3;this.m_arrows[i].setState(!0),this.m_arrows[(i+1)%3].setState(!1)}}class Yt extends zt{constructor(t,e,i,n,o,s,r,a,l){super(o,s,r,a,n,i,!1),this.m_onCount=0,this.m_mainData=t,this.m_propertyName=e,this.m_changeListener=()=>this.handlePropertyChange(),this.m_mainData.addPropertyChangeListener(this.m_propertyName,this.m_changeListener),this.m_currentCount=this.m_mainData.getPropertyValue(this.m_propertyName),this.m_frameCount=l}dispose(){super.dispose(),this.m_mainData.removePropertyChangeListener(this.m_propertyName,this.m_changeListener)}update(t,e){super.update(t,e),this.m_onCount>0&&(this.m_onCount--,this.setState(this.m_onCount>0))}handlePropertyChange(){const t=this.m_mainData.getPropertyValue(this.m_propertyName);t!==this.m_currentCount&&(this.m_currentCount=t,this.m_onCount=this.m_frameCount)}}class Xt extends Yt{constructor(t){super(t,h((t=>t.windmillScoreCount)),o.POINTS_300_OFF,o.POINTS_300_ON,620,721,51,51,60)}}class Zt extends Yt{constructor(t){super(t,h((t=>t.batteryScoreCount)),o.POINTS_100_OFF,o.POINTS_100_ON,91,860,51,51,15)}}class Kt extends Yt{constructor(t){super(t,h((t=>t.helmetScoreCount)),o.POINTS_100_OFF,o.POINTS_100_ON,592,863,51,51,15)}}class Qt extends Z{constructor(t,e){const{top:i,left:n,width:o,height:s,path:r}=function(t){let e=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MIN_VALUE,o=Number.MIN_VALUE;t.forEach((t=>{i=Math.min(i,t.x),o=Math.max(o,t.x),e=Math.min(e,t.y),n=Math.max(n,t.y)}));const s=t.map((t=>vt.Vector.create(t.x-i,t.y-e)));return{left:i,top:e,width:o-i,height:n-e,path:s}}(e);super({x:n,y:i,width:o,height:s}),this.m_path=r,this.m_mainData=t}draw(t,e){const{left:i,top:n,width:o,height:s}=this.getBounds();if(e&&pt.isInsideViewport(this.getBounds(),e)&&this.m_mainData.outlines){t.save(),t.translate(-e.left,-e.top),t.strokeStyle="green",t.lineWidth=2,t.beginPath(),t.moveTo(this.m_path[0].x+i,this.m_path[0].y+n);for(let e=1;e<this.m_path.length;e++)t.lineTo(this.m_path[e].x+i,this.m_path[e].y+n);t.closePath(),t.stroke(),t.restore()}}}class Jt extends Yt{constructor(t){super(t,h((t=>t.topLeftBumperScoreCount)),o.TOP_LEFT_BUMPER_OFF,o.TOP_LEFT_BUMPER_ON,140,398,37,133,15)}}class te extends Yt{constructor(t){super(t,h((t=>t.topRightBumperScoreCount)),o.TOP_RIGHT_BUMPER_OFF,o.TOP_RIGHT_BUMPER_ON,599,398,37,133,15)}}class ee extends Yt{constructor(t){super(t,h((t=>t.topLeftBumperScoreCount)),o.POINTS_50_OFF,o.POINTS_50_ON,172,436,51,51,15)}}class ie extends Yt{constructor(t){super(t,h((t=>t.topRightBumperScoreCount)),o.POINTS_50_OFF,o.POINTS_50_ON,549,436,51,51,15)}}class ne extends Z{constructor(){super({x:747,y:1373,width:40,height:204+n.LAUNCHER_SPACE}),this.m_active=!1,this.m_startTime=-1,this.m_percentage=0}start(){this.m_active=!0}stop(){this.m_active=!1,this.m_percentage=0,this.m_startTime=-1,this.invalidate()}update(t,e){if(!this.m_active||this.m_percentage>=1)return;this.m_startTime<0&&(this.m_startTime=t);const i=t-this.m_startTime;this.m_percentage=Math.min(i/n.LAUNCH_PULL_TIME,1),this.invalidate()}draw(t,e){if(!e||!pt.isInsideViewport(this.getBounds(),e))return;const{left:i,top:s,width:r,height:a}=this.getBounds();t.drawImage(o.LAUNCHER,0,0,r,a,i-e.left,s-e.top+Math.floor(n.LAUNCHER_SPACE*this.m_percentage),r,a)}get percentage(){return this.m_percentage}}class oe extends zt{constructor(t){super(334,1383,64,63,o.BOTTOM_LIGHT_ON,o.BOTTOM_LIGHT_OFF,t.freeBall),this.m_mainData=t,this.m_freeBallListener=()=>this.handleFreeBallChange(),this.m_mainData.addPropertyChangeListener(h((t=>t.freeBall)),this.m_freeBallListener)}dispose(){super.dispose(),this.m_mainData.removePropertyChangeListener(h((t=>t.freeBall)),this.m_freeBallListener)}handleFreeBallChange(){this.setState(this.m_mainData.freeBall)}}class se extends Z{constructor(t){super({x:640,y:475,width:87,height:192}),this.m_frame=0,this.m_lastTimeStamp=-1,this.m_start=-1,this.m_mainData=t,this.m_windmillChangeListener=()=>this.handleWindmillChange(),this.m_mainData.addPropertyChangeListener(h((t=>t.windmillScoreCount)),this.m_windmillChangeListener),this.m_scoreCount=this.m_mainData.windmillScoreCount}handleWindmillChange(){this.m_scoreCount!==this.m_mainData.windmillScoreCount&&(this.m_start=window.performance.now(),this.m_scoreCount=this.m_mainData.windmillScoreCount)}dispose(){super.dispose(),this.m_mainData.removePropertyChangeListener(h((t=>t.windmillScoreCount)),this.m_windmillChangeListener)}update(t,e){this.m_start<0||(this.m_lastTimeStamp<0?this.m_lastTimeStamp=t:t-this.m_lastTimeStamp>1e3/15&&(this.m_frame=(this.m_frame+1)%75,this.m_lastTimeStamp=t,this.invalidate(),0==this.m_frame&&(this.m_start=-1)))}draw(t,e){if(!e||!pt.isInsideViewport(this.getBounds(),e))return;const{left:i,top:n,width:s,height:r}=this.getBounds(),a=this.m_frame%3,l=Math.floor(this.m_frame/3);t.drawImage(o.SPRITE_SHEET_15FPS,a*s,l*r,s,r,i-e.left,n-e.top,s,r)}}var re=function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))};const ae=[s.Hit,s.HitAlt];class le{constructor(t,e,i,n,o){this.m_actorMap=new Map,this.m_flippers=[],this.m_triggerGroups=[],this.m_roundStart=0,this.m_bumpCount=0,this.m_tilt=!1,this.m_panOffset=0,this.m_hitIndex=0,this.m_canvas=t,this.m_table=e,this.m_mainController=n,this.m_mainData=o,this.m_roundEndHandler=i}static create(t,e,i,n,o){return re(this,void 0,void 0,(function*(){const s=new le(t,e,i,n,o);return yield s.createEngine(),s.addBackground(),s.addScenery(),s.addActors(),s.addVertices(),s.addTopLayer(),s.startRound(),s}))}destroy(){for(const t of this.m_actorMap.values())t.dispose();for(this.m_actorMap.clear(),this.m_engine.destroy(),this.m_topLayerSprites.forEach((t=>t.dispose())),this.m_scenerySprites.forEach((t=>t.dispose()));this.m_canvas.numChildren()>0;)this.m_canvas.removeChildAt(0)}scaleCanvas(t,e){console.debug({clientWidth:t,clientHeight:e});const i=t>e?Math.min(1,t/this.m_table.width):t/this.m_table.width,o=this.m_table.height+n.LAUNCHER_SPACE,s=o/this.m_table.width,r=t,a=Math.min(e,Math.round(r*s));this.m_canvas.setDimensions(this.m_table.width,o);const l=r/i,h=a/i;return console.debug({width:r,height:a,zoom:i,viewportWidth:l,viewportHeight:h,tableHeight:o}),this.m_canvas.setViewport(l,h),this.m_canvas.scale(i),this.m_panOffset=h/2-n.BALL_SIZE/2,!0}setFlipperState(t,e){if(this.m_tilt)return;let i=!1;for(const n of this.m_flippers)n.type===t&&(i=n.trigger(e));if(i&&this.playSound(s.Flipper),!e)for(const e of this.m_triggerGroups)t===Q.LeftFlipper?e.moveTriggersLeft():e.moveTriggersRight()}bumpTable(){if(this.m_tilt||this.m_mainData.paused||!this.m_ball)return;if(Math.abs(this.m_ball.body.velocity.y)>2)return;const t=this.m_ball.body.velocity.x>0?n.BUMP_IMPULSE:-n.BUMP_IMPULSE;this.m_engine.launchBall(this.m_ball.body,{x:Math.random()*t,y:-n.BUMP_IMPULSE}),this.m_bumpCount++,this.m_bumpCount>=n.MAX_BUMPS?(this.m_tilt=!0,this.removeBall(),this.showMessage(v.Tilt),this.endRound(2e3)):setTimeout((()=>{this.m_bumpCount=Math.max(0,this.m_bumpCount-1)}),n.BUMP_TIMEOUT),this.playSound(s.Bump)}startLauncher(){!this.m_launched&&this.m_canLaunch&&(this.m_launcherActive=!0,this.m_launcherRenderer.start())}releaseLauncher(){if(!this.m_launcherActive)return;const t=n.MIN_LAUNCH_SPEED+this.m_launcherRenderer.percentage*(n.MAX_LAUNCH_SPEED-n.MIN_LAUNCH_SPEED);this.m_engine.launchBall(this.m_ball.body,{x:0,y:-t}),this.m_launcherRenderer.stop(),this.m_launcherActive=!1,this.m_canLaunch=!1,this.playSound(s.Shoot)}update(t,e){if(this.m_mainData.paused)return;const i=1e3/n.FRAME_RATE;this.m_engine.update(i),this.m_actorMap.forEach((e=>e.update(t))),this.m_topLayerSprites.forEach((i=>i.update(t,e))),this.m_scenerySprites.forEach((i=>i.update(t,e))),this.m_mainController.setFreeBall((window.performance.now()-this.m_roundStart<n.RETRY_TIMEOUT||!this.m_launched)&&!this.m_mainData.usedFreeBall),this.updateBall()}panViewport(t){this.m_canvas.panViewport(0,this.m_canvas.getViewport().top+t)}get launched(){return this.m_launched}createEngine(){return re(this,void 0,void 0,(function*(){this.m_engine=yield Wt.create(this.m_table,(()=>this.handleBeforeUpdate()),(t=>this.handleCollision(t)),this.m_mainData)}))}addActorToMap(t,e){return this.m_actorMap.set(null!=e?e:t.body.id,t),t}removeActor(t){this.m_actorMap.delete(t.body.id),t.dispose()}removeBall(){this.m_ball&&(this.removeActor(this.m_ball),this.m_ball=null)}createBall(t,e){return this.m_ball=new Lt({left:t,top:e,width:n.BALL_SIZE,height:n.BALL_SIZE},this.m_engine,this.m_canvas,this.m_mainData),this.addActorToMap(this.m_ball),this.refreshTopLayer(),this.m_ball}addBackground(){const t=new Z({width:this.m_table.width,height:this.m_table.backgroundHeight,bitmap:At.asImage(this.m_table.background)});this.m_canvas.addChild(t)}addVertices(){nt.isProduction()||this.m_engine.vertices.forEach((t=>{this.m_canvas.addChild(new Qt(this.m_mainData,t))}))}addScenery(){this.m_scenerySprites=[new $t(this.m_mainData),new jt(this.m_mainData),new Xt(this.m_mainData),new Zt(this.m_mainData),new Kt(this.m_mainData),new Jt(this.m_mainData),new te(this.m_mainData),new ee(this.m_mainData),new ie(this.m_mainData),new oe(this.m_mainData),this.m_launcherRenderer=new ne],this.m_scenerySprites.forEach((t=>this.m_canvas.addChild(t)))}addPoppers(){this.m_table.poppers.map((t=>this.addActorToMap(new St(t,this.m_engine,this.m_canvas,this.m_mainData))))}addFlippers(){this.m_flippers=this.m_table.flippers.map((t=>this.addActorToMap(new qt(t,this.m_engine,this.m_canvas,this.m_mainData))))}addBumpers(){this.m_table.bumpers.forEach((t=>this.addActorToMap(new Tt(t,this.m_engine,this.m_canvas,this.m_mainData))))}addTriggerGroups(){this.m_triggerGroups=this.m_table.triggerGroups.map((t=>{const e=new It(t,this.m_engine,this.m_canvas,this.m_mainData);return e.triggers.map((t=>this.addActorToMap(e,t.body.id))),e}))}addRectangles(){this.m_table.rectangles.forEach((t=>this.addActorToMap(new wt(t,this.m_engine,this.m_canvas,this.m_mainData))))}addActors(){this.addPoppers(),this.addFlippers(),this.addBumpers(),this.addTriggerGroups(),this.addRectangles()}addTopLayer(){this.m_topLayerSprites=this.m_table.topLayer.map((t=>new Z({x:t.left,y:t.top,width:t.width,height:t.height,bitmap:At.asImage(t.bitmap)}))),this.m_topLayerSprites.push(new se(this.m_mainData))}refreshTopLayer(){this.m_topLayerSprites.forEach((t=>{this.m_canvas.removeChild(t),this.m_canvas.addChild(t)}))}awardPoints(t){this.m_mainController.addScore(t)}playSound(t){this.m_mainController.playSound(t)}showMessage(t){this.m_mainController.showMessage(t)}popperCollision(t,e){const i=this.m_actorMap.get(t.id);this.m_launched||i.popperType!==et.Launcher?(this.m_engine.launchBall(e,i.getImpulse()),i.once&&(this.showMessage(v.GotLucky),this.removeActor(i)),i.scoreType!==m.None&&this.awardPoints(i.scoreType),this.playSound(i.popperType===et.Launcher?s.Shoot:this.getHitSound())):this.m_canLaunch=!0}bumperCollision(t,e){var i;const n=this.m_actorMap.get(t.id);n.collided=!0,this.awardPoints(n.scoreType),this.playSound(null!==(i=n.gameSound)&&void 0!==i?i:this.getHitSound())}completeMultiplier(){this.m_mainData.multiplier=Math.min(2*this.m_mainData.multiplier,32),this.showMessage(v.Multiplier)}completeSequenceCompletion(t){this.showMessage(t.completeMessage)}completeTeleport(t){this.showMessage(v.EscapeBonus),this.removeBall(),setTimeout((()=>{this.createBallAtFirstPopper()}),2e3)}completeWindmills(t){this.m_mainData.windmills||(this.m_mainController.setWindmills(!0),this.awardPoints(m.Windmills),this.removeBall(),this.playSound(s.Windmills),setTimeout((()=>{this.createBall(645,644),this.refreshTopLayer(),this.m_engine.launchBall(this.m_ball.body,{x:-20*n.GRAVITY,y:6*n.GRAVITY})}),n.WINDMILL_DURATION),setTimeout((()=>{this.m_mainController.setWindmills(!1)}),n.WINDMILL_DURATION+500))}completeLaunched(){this.m_launched=!0,this.m_launcherRenderer.stop(),this.m_mainData.ballCount===n.BALLS_PER_GAME&&(this.m_roundStart=window.performance.now())}completeLane(t){this.awardPoints(t.scoreType),this.showMessage(t.completeMessage),this.playSound(s.Lane)}triggerCollision(t,e){const i=this.m_actorMap.get(t.id),n=null==i?void 0:i.trigger(t.id);if(i.triggerType!==tt.Series&&(n||this.playSound(s.Trigger)),n){switch(i.triggerTarget){default:break;case J.Multiplier:this.completeMultiplier();break;case J.SequenceCompletion:this.completeSequenceCompletion(i);break;case J.Teleport:this.completeTeleport(e);break;case J.Windmills:this.completeWindmills(e);break;case J.Launched:this.completeLaunched();break;case J.Lane:this.completeLane(i)}i.unsetTriggers()}}bodyCollision(t,e){if(e.label===ot.Ball)switch(t.label){case ot.Popper:this.popperCollision(t,e);break;case ot.Bumper:this.bumperCollision(t,e);break;case ot.Trigger:this.triggerCollision(t,e)}}createBallAtFirstPopper(){this.createBall(this.m_table.poppers[0].left-n.BALL_SIZE/2+18,this.m_table.poppers[0].top-n.BALL_SIZE-n.BALL_SIZE/2)}updateBall(){if(!this.m_ball)return;const{top:t,left:e}=this.m_ball.bounds,i=t-this.m_panOffset;this.m_canvas.panViewport(0,i),(e<0||e>=this.m_table.width)&&(this.removeBall(),this.createBallAtFirstPopper())}startRound(){this.m_launched=!1,this.m_launcherActive=!1,this.m_canLaunch=!1,this.createBallAtFirstPopper(),this.m_mainData.ballCount===n.BALLS_PER_GAME&&this.m_mainController.setUsedFreeBall(!1),this.m_tilt=!1,this.m_mainData.multiplier=1}endRound(t=1500){this.playSound(s.BallOut),this.m_roundEndHandler((()=>{this.removeBall(),this.m_mainController.decreaseBallCount(),this.m_mainData.ballCount>0?this.startRound():this.m_mainController.gameOver()}),t)}handleCollision(t){t.pairs.forEach((t=>this.bodyCollision(t.bodyA,t.bodyB)))}handleBeforeUpdate(){if(!this.m_ball)return;this.m_engine.capSpeed(this.m_ball.body);const{left:t,top:e}=this.m_ball.bounds;e>this.m_table.playHeight&&(this.removeBall(),this.m_mainData.freeBall&&!this.m_tilt?(this.m_launched=!1,this.createBallAtFirstPopper(),this.showMessage(v.TryAgain)):this.endRound(),this.m_mainController.setUsedFreeBall(!0))}getHitSound(){const t=ae[this.m_hitIndex];return this.m_hitIndex=(this.m_hitIndex+1)%ae.length,t}}class he{static formatScore(t){return Math.floor(t).toString().padStart(6,"0")}}class ce{constructor(t){this.m_yourScore=document.getElementById("status-your-score"),this.m_balls=document.getElementById("status-balls"),this.m_highscore=document.getElementById("status-highscore"),this.m_mainData=t,this.m_mainData.addChangeListener((()=>this.handleMainDataChange())),this.handleMainDataChange()}handleMainDataChange(){this.m_highscore.innerText=he.formatScore(this.m_mainData.highscore),this.m_balls.innerHTML=n.BALLS_PER_GAME-this.m_mainData.ballCount+1+"&nbsp;/&nbsp;"+n.BALLS_PER_GAME,this.m_yourScore.innerText=he.formatScore(this.m_mainData.score)}}const ue="message__text--hide",de="message__text--hidden";class pe{constructor(t,e){this.m_timerHandle=null,this.m_messageText=document.getElementById("message-text"),this.m_mainData=e,this.m_mainController=t,this.m_mainData.addPropertyChangeListener(h((t=>t.message)),(()=>this.handleMessageChange()))}showMessage(t){this.stopTimer(),this.m_messageText.classList.remove(de),setTimeout((()=>{this.m_messageText.innerText=t,this.m_messageText.classList.add(ue),this.startTimer()}),1)}startTimer(){this.m_timerHandle=setTimeout((()=>{this.m_messageText.classList.remove(ue),this.m_messageText.classList.add(de),this.m_mainController.showMessage(v.None),this.m_timerHandle=null}),n.MESSAGE_DURATION)}stopTimer(){this.m_timerHandle&&(clearTimeout(this.m_timerHandle),this.m_messageText.classList.remove(ue),this.m_timerHandle=null)}handleMessageChange(){switch(this.m_mainData.message){case v.Tilt:this.showMessage("Tilt!");break;case v.TryAgain:this.showMessage("Opnieuw")}}}var me=function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))};class ge extends M{constructor(e,i){super(t.Game),this.m_canvasContainer=document.getElementById("canvas-container"),this.m_touchAreaLeft=document.getElementById("touch-area-left"),this.m_touchAreaRight=document.getElementById("touch-area-right"),this.m_touchStart={y:0,time:0},this.m_roundEndTimeout=null,this.m_running=!1,this.m_container=document.getElementById("canvas-container"),this.m_statusContainer=document.getElementById("status-display-container"),this.m_mainController=e,this.m_mainData=i,this.m_statusDisplay=new ce(i),this.m_message=new pe(e,i),this.m_canvas=new N({width:600,height:1200,animate:!0,fps:n.FRAME_RATE,onUpdate:(t,e)=>this.handleCanvasUpdate(t,e)}),this.m_canvas.insertInPage(this.m_canvasContainer),this.m_table=it,this.m_keyboardListener=t=>this.handleKey(t),this.m_resizeListener=()=>this.handleResize(),this.m_touchLeftListener=t=>this.handleTouch(t,!0),this.m_touchRightListener=t=>this.handleTouch(t,!1)}handleCanvasUpdate(t,e){this.m_game&&this.m_running&&this.m_game.update(t,e)}show(){const t=Object.create(null,{show:{get:()=>super.show}});return me(this,void 0,void 0,(function*(){yield t.show.call(this),yield this.initGame(),this.m_running=!0}))}hide(){this.m_running=!1,super.hide(),this.removeListeners(),this.m_game.destroy()}initGame(){return me(this,void 0,void 0,(function*(){this.m_lastBumpTime=window.performance.now(),this.m_game=yield le.create(this.m_canvas,this.m_table,((t,e)=>this.handleRoundEnd(t,e)),this.m_mainController,this.m_mainData),this.addListeners(),yield r.delay(0),this.handleResize()}))}bumpTable(){window.performance.now()-this.m_lastBumpTime<150||(this.m_lastBumpTime=window.performance.now(),this.m_game.bumpTable())}addListeners(){window.addEventListener("keydown",this.m_keyboardListener),window.addEventListener("keyup",this.m_keyboardListener),window.addEventListener("resize",this.m_resizeListener),this.m_touchAreaLeft.addEventListener("touchstart",this.m_touchLeftListener),this.m_touchAreaLeft.addEventListener("touchend",this.m_touchLeftListener),this.m_touchAreaLeft.addEventListener("touchcancel",this.m_touchLeftListener),this.m_touchAreaRight.addEventListener("touchstart",this.m_touchRightListener),this.m_touchAreaRight.addEventListener("touchend",this.m_touchRightListener),this.m_touchAreaRight.addEventListener("touchcancel",this.m_touchRightListener)}removeListeners(){window.removeEventListener("keydown",this.m_keyboardListener),window.removeEventListener("keyup",this.m_keyboardListener),window.removeEventListener("resize",this.handleResize),this.m_touchAreaLeft.removeEventListener("touchstart",this.m_touchLeftListener),this.m_touchAreaLeft.removeEventListener("touchend",this.m_touchLeftListener),this.m_touchAreaLeft.removeEventListener("touchcancel",this.m_touchLeftListener),this.m_touchAreaRight.removeEventListener("touchstart",this.m_touchRightListener),this.m_touchAreaRight.removeEventListener("touchend",this.m_touchRightListener),this.m_touchAreaRight.removeEventListener("touchcancel",this.m_touchRightListener)}handleResize(){const{clientWidth:t,clientHeight:e}=document.documentElement,i=this.m_statusContainer.clientHeight,n=Math.min(this.m_table.height,e)-i;this.m_game.scaleCanvas(t,n)}handleTouch(t,e){var i;if("touchstart"===t.type)if(this.m_game.launched){this.m_game.setFlipperState(e?Q.LeftFlipper:Q.RightFlipper,!0);for(const e of t.touches)this.m_touchStart.y=e.pageY,this.m_touchStart.time=window.performance.now()}else this.m_game.startLauncher();else this.m_game.launched?(this.m_game.setFlipperState(e?Q.LeftFlipper:Q.RightFlipper,!1),"touchend"===t.type&&window.performance.now()-this.m_touchStart.time<400&&(null===(i=t.changedTouches[0])||void 0===i?void 0:i.pageY)-this.m_touchStart.y<-100&&this.bumpTable()):this.m_game.releaseLauncher();t.preventDefault(),t.stopPropagation()}handleKey(t){const{type:e,code:i}=t;switch(i){case"KeyP":nt.isDevelopment()&&"keydown"===e&&(this.m_mainController.setPaused(!this.m_mainData.paused),t.preventDefault());break;case"KeyO":nt.isDevelopment()&&"keydown"===e&&(this.m_mainController.setOutlines(!this.m_mainData.outlines),t.preventDefault());break;case"KeyW":case"ArrowUp":nt.isDevelopment()&&"keydown"===e&&(this.m_game.panViewport(-25),t.preventDefault());break;case"KeyS":case"ArrowDown":nt.isDevelopment()&&this.m_mainData.paused&&"keydown"===e?(this.m_game.panViewport(25),t.preventDefault()):"keydown"===e?this.m_game.startLauncher():"keyup"===e&&this.m_game.releaseLauncher();break;case"Space":"keydown"===e&&this.bumpTable(),t.preventDefault();break;case"ArrowLeft":case"KeyA":case"ShiftLeft":this.m_game.setFlipperState(Q.LeftFlipper,"keydown"===e),t.preventDefault();break;case"ArrowRight":case"KeyD":case"ShiftRight":this.m_game.setFlipperState(Q.RightFlipper,"keydown"===e),t.preventDefault()}}handleRoundEnd(t,e){null===this.m_roundEndTimeout&&(this.m_roundEndTimeout=setTimeout((()=>{t(),this.m_roundEndTimeout=null}),e))}}class fe extends M{constructor(e,i){super(t.Introduction),this.m_startButton=document.getElementById("introduction-start-button"),this.m_highscore=document.getElementById("introduction-highscore"),this.m_mainController=e,this.m_mainData=i,this.m_startButton.addEventListener("click",(()=>this.handleStartClick())),this.m_mainData.addPropertyChangeListener(h("highscore"),(()=>this.handleHighscoreChange())),this.handleHighscoreChange()}handleStartClick(){this.m_mainController.startGame()}handleHighscoreChange(){this.m_highscore.innerText=he.formatScore(this.m_mainData.highscore)}}class ye extends M{constructor(e,i){super(t.Finished),this.m_startButton=document.getElementById("finished-start-button"),this.m_score=document.getElementById("finished-your-score"),this.m_mainController=e,this.m_mainData=i,this.m_startButton.addEventListener("click",(()=>this.handleStartClick())),this.m_mainData.addPropertyChangeListener(h((t=>t.highscore)),(()=>this.handleHighscoreChange())),this.m_mainData.addPropertyChangeListener(h((t=>t.score)),(()=>this.handleScoreChange())),this.handleHighscoreChange(),this.handleScoreChange()}handleStartClick(){this.m_mainController.startGame()}handleHighscoreChange(){}handleScoreChange(){this.m_score.innerText=he.formatScore(this.m_mainData.score)}}var _e=function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))};class ve{constructor(t,e){this.m_pages=new Map,this.m_mainData=e,this.add(new L),this.add(new fe(t,e)),this.add(new ge(t,e)),this.add(new ye(t,e)),this.m_mainData.addPropertyChangeListener(h((t=>t.page)),(()=>_e(this,void 0,void 0,(function*(){return yield this.handlePageChange()}))))}show(t){return _e(this,void 0,void 0,(function*(){this.m_current!==t&&(this.m_pages.get(this.m_current).hide(),this.m_current=t,yield this.m_pages.get(this.m_current).show())}))}add(t){this.m_pages.set(t.id,t),t.visible&&(this.m_current=t.id,this.m_mainData.page=t.id)}handlePageChange(){return _e(this,void 0,void 0,(function*(){yield this.show(this.m_mainData.page)}))}}class be{constructor(t,e){this.m_pages=new ve(t,e),window.addEventListener("resize",(()=>this.handleResize())),this.handleResize()}handleResize(){const{clientWidth:t,clientHeight:e}=document.documentElement;document.documentElement.style.setProperty("--screen-width",`${t}`),document.documentElement.style.setProperty("--screen-height",`${e}`)}}(new class{constructor(){this.m_mainModel=new C,this.m_mainController=new _(this.m_mainModel),this.m_mainView=new be(this.m_mainController,this.m_mainModel)}run(){return t=this,e=void 0,n=function*(){yield this.m_mainController.start()},new((i=void 0)||(i=Promise))((function(o,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}));var t,e,i,n}}).run().then()})()})();